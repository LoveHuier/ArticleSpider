{"url_object_id": "fc531aa1eebe55fcb9eee070c03a6911", "title": ["为提高用户体验，Yelp 是如何无损压缩图片的"], "create_data": "2017/09/12", "url": "http://blog.jobbole.com/112321/", "front_image_url": ["http://wx1.sinaimg.cn/mw690/7cc829d3gy1fjgtf2uq3bj218s0rdwot.jpg"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,Yelp,图片压缩", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/fengzhuang19940106\">iScream</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://engineeringblog.yelp.com/2017/06/making-photos-smaller.html\">Yelp</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>Yelp 拥有超过 1 亿张由用户生成的照片，这些照片从晚餐、理发，到我们最新的功能之一：yelfies。这些图像占据了用户 APP 和网站的大部分带宽，这意味着存储和传输的巨大成本。为了向用户提供最好的体验，我们努力优化这些图片并将其平均大小缩小了 30%。这样节省了用户的时间和带宽，并降低了为这些图像提供服务的成本。哦，我们这样做都没有降低图像的质量呢！</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fjgtf2uq3bj218s0rdwot.jpg\" width=\"690\" height=\"422\"></p>\n<h3>背景</h3>\n<p>Yelp 已经帮用户存储上传的照片超过 12 年了。我们那些将无损格式的图片（PNG，GIF）保存成 PNG 格式，而所有其他的格式的图片则保存成 JPEG 格式。我们保存图片用的是 Python 和 Pillow，并使用如下代码片段，开启了我们照片上传的故事：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79e16ba13e331417400\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# do a typical thumbnail, preserving aspect ratio\r\nnew_photo = photo.copy()\r\nnew_photo.thumbnail(\r\n    (width, height),\r\n    resample=PIL.Image.ANTIALIAS,\r\n)\r\nthumbfile = cStringIO.StringIO()\r\nsave_args = {'format': format}\r\nif format == 'JPEG':\r\n    save_args['quality'] = 85\r\nnew_photo.save(thumbfile, **save_args)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba13e331417400-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba13e331417400-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba13e331417400-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba13e331417400-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba13e331417400-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba13e331417400-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba13e331417400-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba13e331417400-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba13e331417400-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba13e331417400-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba13e331417400-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79e16ba13e331417400-1\"><span class=\"crayon-p\"># do a typical thumbnail, preserving aspect ratio</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba13e331417400-2\"><span class=\"crayon-v\">new_photo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba13e331417400-3\"><span class=\"crayon-v\">new_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">thumbnail</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba13e331417400-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">width</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">height</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba13e331417400-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">resample</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">PIL</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ANTIALIAS</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba13e331417400-6\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba13e331417400-7\"><span class=\"crayon-v\">thumbfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cStringIO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">StringIO</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba13e331417400-8\"><span class=\"crayon-v\">save_args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'format'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">format</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba13e331417400-9\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">format</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'JPEG'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba13e331417400-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">save_args</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'quality'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba13e331417400-11\"><span class=\"crayon-v\">new_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">thumbfile</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">save_args</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>以此作为起点，我们开始研究潜在的文件大小优化方法，可以让我们在不损失质量的前提下使用。</p>\n<h3 id=\"optimizations\">优化</h3>\n<p>首先，我们不得不决定是自己来处理这个问题，还是让 CDN 提供商用他们的魔力来神奇地改变我们的照片。在优先保证高质量的内容前提下，去评估众多选项并使得潜在的尺寸与质量相互抵消是有意义的。我们先行调查了当前照片文件大小缩小的现状 – 可以做出什么改变，以及与每个改变相关联的大小/质量下降。随着这项调查的完成，我们决定从三大类方法来着手。这篇文章剩下的部分解释了我们做了什么，并在每项优化中获得了多少收益。</p>\n<p><strong>1.Pillow中的改变</strong></p>\n<ul>\n<li>优化标志</li>\n<li>渐进的JPEG</li>\n</ul>\n<p><strong>2.应用照片逻辑的更改</strong></p>\n<ul>\n<li>大型 PNG 格式图的检测</li>\n<li>动态 JPEG 质量</li>\n</ul>\n<p><strong>3.JPEG编码器更改</strong></p>\n<ul>\n<li>Mozjpeg（网格量化，自定义量化矩阵）</li>\n</ul>\n<h3 id=\"changes-in-pillow\">Pillow 中的改变</h3>\n<h3 id=\"optimize-flag\">标志位优化</h3>\n<p>这是我们最简单的更改之一：启用 Pillow 中的设置，以 CPU 耗时为代价（optimize = True）来节约更多的文件大小。 由于该权衡的本质，这样做并不会影响图像质量。</p>\n<p>对于 JPEG 格式的图片，该标志位会指示编码器，通过扫描每张图片做一次附加的遍历，来找到最佳霍夫曼编码。对每张图片的第一遍扫描，我们不是写入文件，而是计算每个值的出现统计，这是计算理想编码所需要信息。PNG 内部使用 zlib，因此在这种情况下，标志位优化能有效地指示编码器使用 gzip -9，而不是 gzip -6。</p>\n<p>这是一项简单的改进，但事实证明它并非灵丹妙药，只减少百分之几的文件大小。</p>\n<h3 id=\"progressive-jpeg\">渐进式 JPEG</h3>\n<p>将图像保存为 JPEG 格式时，你可以选择几种不同的类型：</p>\n<ul>\n<li>从上到下加载的 JPEG 标准图像。</li>\n<li>渐进式 JPEG 图像，从较模糊加载到较不模糊。Pillow（progressive = True）可以轻松地启用渐进式选项。 因而，人类肉眼可感知到性能有了提升（也就是说，当图像部分缺失时，更容易注意到它不是完全锐利的）。</li>\n</ul>\n<p>此外，渐进式文件打包方式通常会使得文件尺寸减少。如维基百科文章中所详尽解释的那样，JPEG 格式在 8×8 像素块上使用 Z 字形模式进行熵编码。当这些像素块的值被解包并按顺序排列时，我们通常首先得到的是非零数字，然后是 0 的序列，用该模式对于图像中的每个 8×8 块进行重复和交织。在使用渐进编码时，解开的像素块的顺序发生了改变。每个块值较高的数字会首先出现文件中（它给出了渐进式图像最早扫描到的不同阻塞），并且那些能增加出色细节的小数字（包括更多的 0），它们的跨度将更长，并一直持续到末位。图像数据的这种重新排序不会改变图像本身，而是增加了在一行中的可能存在的 0 的数量（这样可以更容易地压缩）。</p>\n<p>与由用户贡献的美味甜甜圈图像做比较（点击查看大图）：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/7f058d53944b33506d3375138eca77b4.gif\"><img class=\"alignnone wp-image-65555\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/7f058d53944b33506d3375138eca77b4.gif\" alt=\"baseline-tiny\" width=\"299\" height=\"220\"></a></p>\n<p>（1）标准 JPEG 格式图渲染的模拟</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/2f553920cd4b568166bdbbfb5c0a3b40.gif\"><img class=\"alignnone wp-image-65554\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/2f553920cd4b568166bdbbfb5c0a3b40.gif\" alt=\"progressive-tiny\" width=\"299\" height=\"220\"></a></p>\n<p>（2）渐进式 JPEG 格式图渲染的模拟。</p>\n<h3 id=\"changes-to-application-photo-logic\">应用照片逻辑的改变</h3>\n<h3 id=\"large-png-detection\">大型 PNG 格式图片的检测</h3>\n<p>Yelp 为用户生成的内容提供了两种图像格式 –  JPEG 和 PNG。JPEG 是一种很好的照片格式，但通常会与高对比度设计内容（如 logo）相结合。相比之下，PNG 是完全无损的，非常适合图形，但对于那些小失真不可见的照片来说占用的空间太大了。在用户上传实际照片是 PNG 格式的情况下，我们识别这些文件并将其另存为 JPEG 格式，可节省下大量的存储空间。Yelp 上一些常见的 PNG 照片来源于移动设备由和应用程序拍摄的截图，这些照片是通过添加特效或边框修饰了的。</p>\n<p><img src=\"https://engineeringblog.yelp.com/images/posts/2017-05-31-making-images-smaller/example-pngs.png\"></p>\n<p>（左）一个典型的具有 logo 和边框的复合 PNG 格式的上传图。 （右）一个典型的来自于屏幕截图的 PNG 格式的上传图。</p>\n<p>我们想减少这些不必要的 PNG 格式的图片数量，但重要的是要避免矫枉过正或降低了 logo 和图形等的质量。我们应该如何区分出一张图片中属于照片的部分呢？从像素层面可以做到吗？</p>\n<p>使用了 2500 张图片作为实验样本后，我们发现文件大小和独特像素的结合可以很好地区分照片。我们用我们最大的分辨率生成候选缩略图，看看输出PNG文件是否大于 300 KiB。如果是，我们还将检查图像内容，查看是否有超过 2^16 种独特颜色（Yelp 将 RGBA 格式的上传图片转成 RGB 格式，但如果没这样做的话，我们也会检查）。</p>\n<p>在实验数据集中，那些手动调整阈值来定义成“ bigness ”占了有可能缩小的文件大小的 88％（即如果我们要转换所有图像，我们预期的文件大小的缩小），这是在不会导致转换后图形的任何假阳性的前提下进行的。</p>\n<p id=\"dynamic-jpeg-quality\"><strong>动态的 JPEG 质量</strong></p>\n<p>缩小 JPEG 文件大小的第一个也是最为人所知的一种方式是称为质量的设置。许多能保存 JPEG 格式图片的应用程序会将质量指定为一个数字。</p>\n<p>质量这个词有点抽象。事实上，一幅 JPEG 格式的图像的每个颜色通道都有单独的质量。质量等级从 0 到 100 映射到颜色通道的不同量化表，取决于丢失了多少数据（通常是高频成分）。信号域中的量化是 JPEG 编码过程中丢失信息的步骤之一。</p>\n<p>减小文件大小的最简单的方法是降低图像的质量，这会引入更多的噪声。不是每张图片在一个给定的相同质量水平上都会丢失相同的信息量。</p>\n<p>我们可以为每张图片动态地选择一种质量优化设置，找到质量和存储大小之间的理想平衡。有两种方法可以做到这一点：</p>\n<ul>\n<li>自下而上：这些是通过处理 8 x 8 像素块级别的图像生成调谐量化表的算法。它们计算出丢失了多少理论上的质量，以及丢失的数据如何放大或消除，对人眼可见失真的多或少。</li>\n<li>自上而下的：这些算法是将整张图片与其原始无失真版本进行比较，检测丢失了多少信息。通过迭代生成具有不同质量设置的候选图像，我们可以选择其中一张图片，作为满足某种评估算法的最低评估水平的图像。</li>\n</ul>\n<p style=\"text-align: left;\">我们评估了一种自下而上的算法，在实验中，在我们希望使用的质量范围的上限内没有产生合适的结果（尽管它似乎仍然具有中档图像质量的潜力， 这时编码器可以开始更冒险地去丢弃它的字节）。关于这一策略的众多学术论文在90年代初就有发表，该方法对计算能力要求很高，并且走了选项 B 地址这类的捷径，例如不评估块之间的交互。</p>\n<p>所以我们采取了第二种方法：使用对分的算法生成不同质量水平的候选图像，并通过使用 pyssim 函数来计算其结构相似性度量（SSIM），来评估每个候选图像的质量下降，直到该值处于可配置但阈值也还处于静态。这允许我们选择性地降低文件的平均大小（和平均质量），仅仅针对那些已经开始产生肉眼可识别的质量下降的图像。</p>\n<p>在下图中，我们绘制了用3种不同质量方法生成的 2500 张图像的SSIM值的表。</p>\n<p>1、用一种质量为 85 的初始方法作出原始图像，使用蓝线来绘制。</p>\n<p><span style=\"font-weight: normal; text-align: center;\">2、一种能降低文件大小，质量改为 80 的替代方法，用红线来绘制。</span></p>\n<p><span style=\"font-weight: normal; text-align: center;\">3、</span><span style=\"font-weight: normal; text-align: center;\">我们在最后选用了一种方法，使用橙色绘制动态质量的 SSIM 为 80 – 85 的图，即选择质量为 80 到 85（含）的图像，这是基于一种满足或超过的 SSIM 比率：该比率是预先计算的、使转换发生在图像范围中间的某个静态值。这样我们可以降低文件的平均大小，而不会降低那些质量最差的图片的质量。</span><strong style=\"text-align: center;\"><img src=\"https://engineeringblog.yelp.com/images/posts/2017-05-31-making-images-smaller/ssims-strategies.png\"></strong></p>\n<p style=\"text-align: center;\">3 种不同质量策略下 2500 张图片的 SSIM 值图</p>\n<h5 id=\"ssim\">SSIM？</h5>\n<p>有不少图像质量算法试图模仿人类视觉系统。我们已经评估过其中的许多算法，并认为 SSIM 虽然较为古老，但基于以下几个特征是最适合于迭代优化的：</p>\n<p>1、对 JPEG 量化误差敏感<br>\n2、快速，简单的算法<br>\n3、可以直接对 PIL 原生图像对象进行计算，而不是将图像转换为 PNG 格式并将其传递给 CLI 应用程序（参见＃2）</p>\n<p>动态质量的代码示例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79e16ba150375535081\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport cStringIO\r\nimport PIL.Image\r\nfrom ssim import compute_ssim\r\n \r\n \r\ndef get_ssim_at_quality(photo, quality):\r\n    \"\"\"Return the ssim for this JPEG image saved at the specified quality\"\"\"\r\n    ssim_photo = cStringIO.StringIO()\r\n    # optimize is omitted here as it doesn't affect\r\n    # quality but requires additional memory and cpu\r\n    photo.save(ssim_photo, format=\"JPEG\", quality=quality, progressive=True)\r\n    ssim_photo.seek(0)\r\n    ssim_score = compute_ssim(photo, PIL.Image.open(ssim_photo))\r\n    return ssim_score\r\n \r\n \r\ndef _ssim_iteration_count(lo, hi):\r\n    \"\"\"Return the depth of the binary search tree for this range\"\"\"\r\n    if lo &gt;= hi:\r\n        return 0\r\n    else:\r\n        return int(log(hi - lo, 2)) + 1\r\n \r\n \r\ndef jpeg_dynamic_quality(original_photo):\r\n    \"\"\"Return an integer representing the quality that this JPEG image should be\r\n    saved at to attain the quality threshold specified for this photo class.\r\n \r\n    Args:\r\n        original_photo - a prepared PIL JPEG image (only JPEG is supported)\r\n    \"\"\"\r\n    ssim_goal = 0.95\r\n    hi = 85\r\n    lo = 80\r\n \r\n    # working on a smaller size image doesn't give worse results but is faster\r\n    # changing this value requires updating the calculated thresholds\r\n    photo = original_photo.resize((400, 400))\r\n \r\n    if not _should_use_dynamic_quality():\r\n        default_ssim = get_ssim_at_quality(photo, hi)\r\n        return hi, default_ssim\r\n \r\n    # 95 is the highest useful value for JPEG. Higher values cause different behavior\r\n    # Used to establish the image's intrinsic ssim without encoder artifacts\r\n    normalized_ssim = get_ssim_at_quality(photo, 95)\r\n    selected_quality = selected_ssim = None\r\n \r\n    # loop bisection. ssim function increases monotonically so this will converge\r\n    for i in xrange(_ssim_iteration_count(lo, hi)):\r\n        curr_quality = (lo + hi) // 2\r\n        curr_ssim = get_ssim_at_quality(photo, curr_quality)\r\n        ssim_ratio = curr_ssim / normalized_ssim\r\n \r\n        if ssim_ratio &gt;= ssim_goal:\r\n            # continue to check whether a lower quality level also exceeds the goal\r\n            selected_quality = curr_quality\r\n            selected_ssim = curr_ssim\r\n            hi = curr_quality\r\n        else:\r\n            lo = curr_quality\r\n \r\n    if selected_quality:\r\n        return selected_quality, selected_ssim\r\n    else:\r\n        default_ssim = get_ssim_at_quality(photo, hi)\r\n        return hi, default_ssim</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba150375535081-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba150375535081-67\">67</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">cStringIO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">PIL</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Image</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-3\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">ssim </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">compute_ssim</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-4\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-5\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-6\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">quality</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"Return the ssim for this JPEG image saved at the specified quality\"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cStringIO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">StringIO</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># optimize is omitted here as it doesn't affect</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># quality but requires additional memory and cpu</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">format</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"JPEG\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">quality</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">quality</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">progressive</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">seek</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_score</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compute_ssim</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PIL</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ssim_score</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-15\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-16\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-17\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_ssim_iteration_count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"Return the depth of the binary search tree for this range\"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-23\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-24\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-25\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">jpeg_dynamic_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">original_photo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"Return an integer representing the quality that this JPEG image should be</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-27\"><span class=\"crayon-s\">    saved at to attain the quality threshold specified for this photo class.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-28\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-29\"><span class=\"crayon-s\">    Args:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-30\"><span class=\"crayon-s\">        original_photo - a prepared PIL JPEG image (only JPEG is supported)</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-31\"><span class=\"crayon-s\">    \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_goal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.95</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-35\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># working on a smaller size image doesn't give worse results but is faster</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># changing this value requires updating the calculated thresholds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">photo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">original_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">resize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-39\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_should_use_dynamic_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">default_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">default_ssim</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-43\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 95 is the highest useful value for JPEG. Higher values cause different behavior</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Used to establish the image's intrinsic ssim without encoder artifacts</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">normalized_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">95</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selected_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-48\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># loop bisection. ssim function increases monotonically so this will converge</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">_ssim_iteration_count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">curr_quality</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">curr_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curr_quality</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ssim_ratio</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curr_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">normalized_ssim</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-54\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-55\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ssim_ratio</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ssim_goal</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-56\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># continue to check whether a lower quality level also exceeds the goal</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-57\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_quality</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-58\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">selected_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_ssim</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-59\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">hi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_quality</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-60\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-61\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_quality</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-62\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-63\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-64\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">selected_ssim</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-65\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba150375535081-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">default_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba150375535081-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">default_ssim</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0076 seconds] -->\r\n<p>还有一些关于这种技术的其他博客文章，这里是柯尔特·麦卡尼斯（Colt Mcanlis）的一篇博文。当我们发布这篇博客的时候，Etsy 已经发表了一篇了！击掌吧，更快的网络！</p>\n<h3 id=\"changes-to-jpeg-encoder\">JPEG 编码器的更改</h3>\n<h3 id=\"mozjpeg\">Mozjpeg 是 libjpeg-turbo 的一个开源分支，它采取以时间换空间的方法，通过更长时间的运算换取更加优化的文件尺寸。这种方法很好地与离线批处理方法结合以重新生成图像。一些更昂贵的算法用了比 libjpeg-turbo 多出 3 – 5 倍的时间，使得图像更小了一些！</h3>\n<p>mozjpeg 的区别之一是使用一种替代量化表。如上所述，质量是用于每个颜色通道的量化表的抽象。所有符号都指向默认的 JPEG 量化表，因而它很容易被击败。用这个词来说，</p>\n<p><a href=\"https://www.w3.org/Graphics/JPEG/itu-t81.pdf\">JPEG spec</a>:</p>\n<blockquote><p>这些表仅作为示例，并不一定适用于任何特定应用。</p></blockquote>\n<p>那么自然地，不要惊讶于你知道这些表是大多数编码器使用的默认值…</p>\n<p>Mozjpeg 经历了为我们的替代表做基准测试的麻烦时期，并在之后成为了它所创建的图像中，能用到的性能最好的通用替代品。</p>\n<h3 id=\"mozjpeg--pillow\">Mozjpeg + Pillow</h3>\n<p>大多数的 Linux 发行版都默认安装了 libjpeg。所以在 Pillow 下使用 mozjpeg 在默认情况下不起作用，但配置起来也不是很困难。当您构建 mozjpeg 时，请使用–with-jpeg8 标志位，并确保可以通过 Pillow 链接到它。如果您使用Docker，您可能会有一个 Dockerfile，如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79e16ba15b042022065\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFROM ubuntu:xenial\r\n \r\nRUN apt-get update \r\n\t&amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get -y --no-install-recommends install \r\n\t# build tools\r\n\tnasm \r\n\tbuild-essential \r\n\tautoconf \r\n\tautomake \r\n\tlibtool \r\n\tpkg-config \r\n\t# python tools\r\n\tpython \r\n\tpython-dev \r\n\tpython-pip \r\n\tpython-setuptools \r\n\t# cleanup\r\n\t&amp;&amp; apt-get clean \r\n\t&amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\r\n \r\n# Download and compile mozjpeg\r\nADD https://github.com/mozilla/mozjpeg/archive/v3.2-pre.tar.gz /mozjpeg-src/v3.2-pre.tar.gz\r\nRUN tar -xzf /mozjpeg-src/v3.2-pre.tar.gz -C /mozjpeg-src/\r\nWORKDIR /mozjpeg-src/mozjpeg-3.2-pre\r\nRUN autoreconf -fiv \r\n\t&amp;&amp; ./configure --with-jpeg8 \r\n\t&amp;&amp; make install prefix=/usr libdir=/usr/lib64\r\nRUN echo \"/usr/lib64n\" &gt; /etc/ld.so.conf.d/mozjpeg.conf\r\nRUN ldconfig\r\n \r\n# Build Pillow\r\nRUN pip install virtualenv \r\n\t&amp;&amp; virtualenv /virtualenv_run \r\n\t&amp;&amp; /virtualenv_run/bin/pip install --upgrade pip \r\n\t&amp;&amp; /virtualenv_run/bin/pip install --no-binary=:all: Pillow==4.0.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79e16ba15b042022065-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b79e16ba15b042022065-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-1\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">ubuntu</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">xenial</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-2\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-3\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">update</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBIAN_FRONTEND</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">noninteractive </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">get</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">install</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">recommends </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\"># build tools</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">nasm </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-7\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">build</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">essential </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-8\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">autoconf </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-9\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">automake </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-10\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">libtool </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-11\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">pkg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">config</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\"># python tools</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-13\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">python </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-14\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dev </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-15\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">pip </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-16\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">setuptools</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\"># cleanup</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-18\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">clean</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-19\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lists</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-20\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-21\"><span class=\"crayon-p\"># Download and compile mozjpeg</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-22\"><span class=\"crayon-e\">ADD </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/mozilla/mozjpeg/archive/v3.2-pre.tar.gz /mozjpeg-src/v3.2-pre.tar.gz</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-23\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">tar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xzf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">v3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pre</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">gz</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-24\"><span class=\"crayon-v\">WORKDIR</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3.2</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">pre</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-25\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">autoreconf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fiv</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-26\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">configure</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">with</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">jpeg8</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-27\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">prefix</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">usr </span><span class=\"crayon-v\">libdir</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">lib64</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-28\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/usr/lib64n\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conf</span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-29\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">ldconfig</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-30\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-31\"><span class=\"crayon-p\"># Build Pillow</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-32\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">virtualenv</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-33\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">virtualenv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">virtualenv_run</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79e16ba15b042022065-34\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">virtualenv_run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">pip </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">upgrade </span><span class=\"crayon-v\">pip</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b79e16ba15b042022065-35\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">virtualenv_run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">pip </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">binary</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">all</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Pillow</span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">4.0.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0052 seconds] -->\r\n<p>以上！使用它，您将可以在正常图片工作流程中，使用由 mozjpeg 支持的 Pillow。</p>\n<h3 id=\"impact\">影响</h3>\n<p>这些改进中的每一项对我们的提升分别是多少呢？我们随机抽取 2,500 张 Yelp 上的商业照片开始了此项研究，测试照片大小在经过我们的处理流程后有怎样的变化。</p>\n<p>1、通过改变 Pillow 的设置，可以将图片大小减小 4.5%<br>\n2、大型 PNG 格式图片检测可以将图片大小减小 6.2%<br>\n3、动态质量可以将图片大小减小 4.5%<br>\n4、切换到 mozjpeg 编码器可以将图片大小减小 13.8%</p>\n<p>这些改进使得图像文件的平均大小减少了约 30％，并被我们应用到我们最大和最常见的图像分辨率上，使网站能为用户提供更快速的服务，并且每天在数据传输上节省了 TB 级别的容量。按照 CDN 来衡量：</p>\n<p><img src=\"https://engineeringblog.yelp.com/images/posts/2017-05-31-making-images-smaller/Filesize-over-time.png\"></p>\n<p style=\"text-align: center;\">从 CDN（结合非图像静态内容）测量的平均文件大小。</p>\n<h3 id=\"what-we-didnt-do\">我们还没做的</h3>\n<p>本节旨在向您介绍可能能够做出的一些常见改进，有的是因为它们和 Yelp 使用的工具并无关系，有些是因为我们权衡后决定不做。</p>\n<h3 id=\"subsampling\">子采样</h3>\n<p>子采样是决定网页图像的质量和文件大小的主要因素。对于子抽样的更详尽的描述可以在网上找到，但在这个博客文章我们只要说以 4：1：1（这是 Pillow 的默认值，没有指定任何其他内容）进行子采样就够了，所以我们无法了解能进一步缩小多少。</p>\n<h3 id=\"lossy-png-encoding\">有损的 PNG 编码</h3>\n<p>在了解我们对 PNG 格式图片做了什么之后，用例如 pngmini 这样的有损编码器，选择将这些图片中一部分保留为 PNG 格式，可能是有意义的，但是我们选择将其重新保存成 JPEG 格式。这是一个结果看来合理的替代选项，根据作者的说法，未修改的 PNG 格式图片的文件大小缩小了 72-85 ％。</p>\n<h3 id=\"dynamic-content-types\">动态内容类型</h3>\n<p>为更多的现代化内容类型提供支持，如 WebP 或 JPEG2k 肯定是我们的未来要做的。而一旦这个假设的项目实行了，就会有大量的用户要求为现有已优化的 JPEG / PNG 图像做这些，这将继续使该项工作非常值得做。</p>\n<h3 id=\"svg\">SVG</h3>\n<p>我们在网站上的许多地方使用 SVG，就像我们设计师创建的静态资产，这已成为我们的指导风格。虽然这种格式和优化工具（如 svgo）有助于减少网站页面的开销，但它与我们在这里所做的工作无关。</p>\n<h3 id=\"vendor-magic\">供应商的魔术</h3>\n<p>能提供图像传送/调整大小/裁剪/转码服务的供应商太多，包括开源的 thumbor。也许这是支持响应式图像，动态内容类型的最简单方法，并且在将来仍然能让我们保持在技术前沿。而现在我们的解决方案仍然是独立的。</p>\n<h3 id=\"further-reading\">拓展阅读</h3>\n<p>这里列出的两本书在这个领域历史上是绝对能站稳脚跟的，强烈建议您进一步阅读这些书籍。</p>\n<ul>\n<li><a href=\"https://content.akamai.com/pg6293-high-performance-images-ebook.html\">High Performance Images</a></li>\n<li><a href=\"http://designingforperformance.com/\">Designing for Performance</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112321\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112321votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112321\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/fengzhuang19940106\">iScream</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/fengzhuang19940106\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/91B5C8EB0B449C2B9F52CCED48C6B4CD/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            一个大的学生        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/fengzhuang19940106\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/fengzhuang19940106/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/fengzhuang19940106/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a> · <a title=\"QQ：295039571\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/b0c88078f0ce26552ba79f72b93aa170e681bc91.jpg"}
{"url_object_id": "96e68d41a1e51a9614a929fce93c1d53", "title": ["100:10:1方法 : 我是这样参与开源的"], "create_data": "2017/09/08", "url": "http://blog.jobbole.com/112320/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/f1a3d556b79a7fae23ad3ecc6f972164.jpg"], "praise_nums": "2", "comment_nums": 1, "fav_nums": 3, "tags": "IT技术,开源", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/q1857502771\">暖日生烟</a> 翻译，<a href=\"http://www.jobbole.com/members/young605867996\">Lada</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://blog.fogus.me/2015/11/04/the-100101-method-my-approach-to-open-source/\">Michael Fogus</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：据本文作者 Michael Fogus 博客上的简介，他是一位 Clojure 开发者和狂热用户，并且是 Clojure 的贡献者（Clojure 本身也是一个开源项目）。平常在 Clojure 和 ClojureScript 花费时间很多。他喜欢棒球、象棋、哲学、恐怖电影、阅读和写作。出过两本书《Functional JavaScript》和《The joy of Clojure》。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fjbxewni6rj206y06ymx6.jpg\" width=\"250\" height=\"250\"></p>\n<hr>\n<p>许多年里我一直全心投入于开源运动，不过那时候我很少在空闲时写代码，在 Sourceforge、GoogleCode、GitHub 之类的代码托管平台，也找不到我的项目（repo）。<sup>【1】</sup>然而随着时间流逝，我逐渐意识到向全球公开代码的责任，毫不夸张的说，这吸引住了我。</p>\n<p>除了很多“已发布”的代码是低水准的这一事实之外，无论<a href=\"https://en.wikipedia.org/wiki/Authorial_intent\">有意</a>与<a href=\"https://en.wikipedia.org/wiki/Reader-response_criticism\">否</a>，将代码公布于众的行为意味着与某些人签订契约<sup>【2】</sup>，这些人可以为自己的目的使用公开的代码。当然，我并不一定反对这种社会契约，相反，在发布代码的时候我最终改变了主意，以致于我在我的方法中变得更保守了。这个我现在正在使用的方法叫做“100:10:1 方法”，此术语是由开发者 Nick Bentley 创造。<sup>【3】</sup></p>\n<h3>100:10:1 方法究竟是什么？</h3>\n<p>我不会重复赘述此方法的细节，你可以通过阅读 《<a href=\"https://nickbentleygames.wordpress.com/2014/05/12/the-100-10-1-method-for-game-design/\" target=\"_blank\">The 100:10:1 method – the heart of my game design process</a>》来了解。但我会试着从我的开源软件开发方法这一背景下来概括它。</p>\n<p>具体操作分三部分，步骤如下：</p>\n<h3>写下 100 种疯狂的想法</h3>\n<p>首先，准备一本笔记本和一支笔，为开发有意思的开源项目写下 100 种想法即可。这些有关项目的想法可以涉及各种主题，深度和质量。我想过的有，野生语言的创意、已有项目的新功能、系统设计、协议、缺损文件、有趣的 forks、代码简化、游戏、原型、论文想法的实现、第二个系统等等。</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/a17d6bb7gy1fisza9ufvoj208c03b3yl.jpg\"></p>\n<p>在使用 100:10:1 方法之前，我总是会用疯狂的想法填满我的笔记本。它们通常是东一点西一点，从不会聚集在一个地方。在几页纸上写下这 100个想法后，我的注意力立马集中在它们身上。这样我就可以好好筛选比较为第二步做准备。</p>\n<h3><span id=\"pos_placeholder\" style=\"width: 0px; height: 0px; margin: 0px; padding: 0px;\"></span>为这 10 个想法创造最小可行性产品（MVP）</h3>\n<p>我面前的这 100 个想法，让我了解到我不止当时对追求它们充满兴趣，并且我感觉它们可以使我和他人同时获益。<sup>【4】</sup>从原始的 100 个想法里，我挑出了确定想探索和专研下去的 10 个。在这 10 个项目里，我挑不出一个更好的了，因此我想同时为它们各自编写一个最小可行“项目”。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/a17d6bb7gy1fisza9oxcdj208c04pjrl.jpg\" width=\"300\" height=\"169\"></p>\n<p>你可能马上会想到同时开发 10 个项目这件事本身就是一个负担。这不能说是一个错误的评估。然而，我意识到对于我选择的大多数项目，要找到最可行的实现方式是非常难的，如果有也得耗费几个月甚至数年时间。你看，我曾一度认为发布开源软件是把潜在可用的工具给予他人的一种方法。很遗憾的是，随着时间推移，这个观点已经退化到能做到将代码公开就不错了。我现在的想法是，在业余时间写代码仅仅是一个探索，有没有结果也无所谓了。</p>\n<p>同时开发 10 个项目有个好处就是，当我在一个上遇到了瓶颈可以轻易的转移到另一个更有灵感的项目去。作为一个除编程外拥有丰富爱好、社区和家庭生活的人，用一堆选择来对抗我的三分钟热度无疑是非常有用的。拥有 10 个并行的项目意味着总有一个能让我在短时间内感兴趣。我知道当所有兴趣集中在一个任务上时，工作会变的更有效率。无论怎样最后总有一个项目会见到希望<sup>【5】</sup>，当它到来时我已经准备好了进入最后一个阶段。</p>\n<h3>全力开发选中的项目，使其成为一个可以合法发布的软件</h3>\n<p>在开发 10 个项目的过程中，其中一个不可避免会成为有价值的东西。<sup>【6】</sup>万事俱备后，我会将其变为一个高质量的软件产品。<sup>【7】</sup>这意味着要完成所有内容，确保一个健壮的系统，有可靠的例子、测试、文档、稳定的API、博客文章或演讲，甚至可能有网络。<sup>【8】</sup></p>\n<p><img class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/a17d6bb7gy1fiszaa656cj206004c3yj.jpg\" width=\"216\" height=\"156\"></p>\n<p>在此之前为了我自己而开发的项目，可能要经历大量的工作才能使其成为值得与他人分享的东西。这当然取决于软件本身的复杂度，很可能最后一步要花最长的时间来完成。同样最后阶段也是我最容易彻底放弃的时候。因为我发现了一个大麻烦，如果我不愿为我的代码写文档、例子和测试的话，在未来的数十年想要维护它是根本不可能的。</p>\n<h3>总结</h3>\n<p>这个方法我已经用了一段时间，在此之前，使用类似的方法同样取得了不错的成果。Zeder 和 Patagonia 也是用 100:10:1 方法或类似方法进行开发的。我现在有的一个叫 Tathata 的 Clojure 库，即将进入最后阶段。或许 10 个项目<sup>【9】</sup>里会有一个成功，不过即使失败了，我还会再挑选更多的 10 个去尝试。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/a17d6bb7gy1fiszaaj4n9j208c04rt9y.jpg\" width=\"300\" height=\"171\"></p>\n<p>我有足够的时间，准确的说是一辈子。:F</p>\n<p>感谢 Carin Meier、Rich Hickey、Justin Gehtland 和 Paul deGrandis 阅读，并为这篇文章提供修改意见。</p>\n<hr>\n<p>1.事实证明，我的其他爱好(游戏设计、Sabremetrics、写作等)在过去也有类似的趋势，但就像开源编码一样，它们也已经达到100:10:1的理想状态。</p>\n<p>2.不幸的是，人们似乎也倾向于将开源视为一种道德声明。</p>\n<p>3.“100:10:1 方法”这个名字来自尼克·本特利在他的一篇文章中所描述的游戏设计方法。虽然我自己对开源代码的看法已经有点类似于尼克的观点，但他的文章让我的方法有了一个名字和基本结构。无论你在哪儿，Mr. Bentley，谢谢你!</p>\n<p>4.如果我们不创建开源代码来造福他人，那又有什么意义呢？</p>\n<p>5.有时候一个项目会从根上就腐烂，在这种情况下，我会毫不犹豫的废弃它，并将其他替代品放进 100 的列表中。100 的链表是一个动态链表，所有东西可以随存随取。</p>\n<p>6.或者不一定？我担心个啥！</p>\n<p>7.当那一个已经浮出水面了，我仍然不会放弃其他 9 个，不过仅仅是在更表层，MVP 式的水平上开发。如果某个想法失败了，我还会从 100 个中挑选其他的代替。这个方法当然是没有任何硬性规定的。</p>\n<p>8.当然还有最终的名字和标志:p。</p>\n<p>9.如你所见，我将100:10:1 方法应用于其他的创造性的爱好。从编码、音乐、写作到游戏设计，它适用于任何创造性事情。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112320\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112320votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112320\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/q1857502771\">暖日生烟</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/q1857502771\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/06EB1B2C5C7835017E628CFB8E25D68F/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/q1857502771\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/q1857502771/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/q1857502771/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"QQ：826672619\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：xzs826672619\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/NinoMiao\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/70c7b887c37d9154dc2b5636ed919464c716d375.jpg"}
{"url_object_id": "7070d04f4a541626ef95b5e9985670fc", "title": ["C# 最佳工具集合： IDE 、分析、自动化工具等"], "create_data": "2017/09/11", "url": "http://blog.jobbole.com/112411/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/08/297e7ca127d2eef674c119331fe30dff1.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "工具与资源,开发,C sharp", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/tdfblog/p/best-csharp-tools.html\">Sweet-Tang</a>   </div><p>C#是企业中广泛使用的编程语言，特别是那些依赖微软的程序语言。如果您使用C#构建应用程序，则最有可能使用Visual Studio，并且已经寻找了一些扩展来对您的开发进行管理。但是，这个工具列表可能会改变您编写C#代码的方式。</p>\n<h1 id=\"c编程的最佳工具有以下几类\">C#编程的最佳工具有以下几类：</h1>\n<ul>\n<li><a href=\"#IDEs\">IDE</a></li>\n<li><a href=\"#Extensions\">VS扩展</a></li>\n<li><a href=\"#Compilers\">编译器、编辑器和序列化</a></li>\n<li><a href=\"#Decompilers\">反编译和代码转换工具</a></li>\n<li><a href=\"#Automation\">构建自动化和合并工具</a></li>\n<li><a href=\"#VersionControl\">版本控制</a></li>\n<li><a href=\"#Testing\">测试工具和VS扩展</a></li>\n<li><a href=\"#Profilers\">性能分析</a></li>\n<li><a href=\"#APM\">APM</a></li>\n<li><a href=\"#Deployment\">部署自动化</a></li>\n<li><a href=\"#Containerization\">容器</a></li>\n</ul>\n<p>使用上面的链接直接跳转到特定工具，或继续阅读以浏览完整列表。</p>\n<h1>IDE</h1>\n<h2 id=\"visual-studio-code\">1. <a href=\"https://code.visualstudio.com/\">Visual Studio Code</a></h2>\n<h2><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/ab7cd9d2dc2e1643611ad6d6dc17a94b.jpg\"><img class=\"aligncenter size-full wp-image-112412\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/ab7cd9d2dc2e1643611ad6d6dc17a94b.jpg\" alt=\"162090-20170910205052272-559220882\"></a></h2>\n<p>Visual Studio Code是C#开发人员最受欢迎的代码编辑器。您可以使用Visual Studio Code与C#扩展功能实现强大的编辑功能，并完全支持C# IntelliSense和调试。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>优秀的自动完成与上下文感知提示</li>\n<li>内置Git集成，实现更好的版本控制</li>\n<li>大量的扩展进一步增强平台</li>\n</ul>\n<h2 id=\"monodevelop\">2. <a href=\"http://www.monodevelop.com/\">MonoDevelop</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/cdbf06f5a31bed35d6e8e99501364c76.jpg\"><img class=\"aligncenter size-full wp-image-112413\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/cdbf06f5a31bed35d6e8e99501364c76.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>由Xamarin开发，MonoDevelop具有许多与VS Code相似的功能，也是跨平台的。使用MonoDevelop，您可以在Windows，Linux和Mac OS X上快速编写桌面和Web应用程序。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>标准功能，如代码提示和调试</li>\n<li>还配有<a href=\"https://unity3d.com/\">Unity</a>，一个游戏引擎，可以为视频游戏等应用程序实现高级C#编程</li>\n<li>支持C#代码提示</li>\n<li>代码模板和代码折叠</li>\n<li>多语言支持</li>\n</ul>\n<h2 id=\"sharpdevelop\">3. <a href=\"http://www.icsharpcode.net/\">SharpDevelop</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/56e59653b98d56cb5a410d98cb7bedf7.jpg\"><img class=\"aligncenter size-full wp-image-112414\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/56e59653b98d56cb5a410d98cb7bedf7.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个用于C#、VB.net和Boo项目的免费开源IDE，#develop（SharpDevelop）是VS Code的轻量级替代品。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>Visual Studio提供的通常功能，包括代码编辑，编译和调试</li>\n<li>一些高级功能包括上下文操作和后台语法检查</li>\n</ul>\n<h2 id=\"rider\">4. <a href=\"https://www.jetbrains.com/rider/\">Rider</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/9d3f920744876bd8d1a24134838ba714.jpg\"><img class=\"aligncenter size-full wp-image-112415\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/9d3f920744876bd8d1a24134838ba714.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Jet Brains产品套件中一个成员，Rider是基于IntelliJ平台和ReSharper的跨平台.NET IDE。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>与其他JetBrains产品无缝集成</li>\n<li>2000多种代码检查</li>\n<li>上下文操作</li>\n<li>支持Unity游戏引擎</li>\n<li>支持.NET Framework和.NET Core</li>\n</ul>\n<h1 id=\"visual-studio-扩展\">Visual Studio 扩展</h1>\n<h2 id=\"productivity-power-tools-2017\">5. <a href=\"https://marketplace.visualstudio.com/items?itemName=VisualStudioProductTeam.ProductivityPowerPack2017\">Productivity Power Tools 2017</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/b6ea07eb5999a3e0136e07a09f122f49.jpg\"><img class=\"aligncenter size-full wp-image-112416\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/b6ea07eb5999a3e0136e07a09f122f49.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>由Microsoft提供，这是一个很好的扩展，以加快Visual Studio的开发。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>中间点击滚动</li>\n<li>快速查找</li>\n<li>解决方案错误可视化</li>\n<li>直观的界面</li>\n<li>其它版本可用于旧版Visual Studio版本</li>\n</ul>\n<h2 id=\"jquery-code-snippets\">6. <a href=\"https://github.com/kspearrin/Visual-Studio-jQuery-Code-Snippets\">jQuery Code Snippets</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/3e8c0688d1b43afcb054ae41872c6ed4.jpg\"><img class=\"aligncenter size-full wp-image-112417\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/3e8c0688d1b43afcb054ae41872c6ed4.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>简化jQuery框架编码，jQuery Code Snippets为Visual Studio 2012，2013，2015和2017提供了超过130个代码段。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>130多种jQuery代码片段</li>\n<li>支持所有版本的Visual Studio</li>\n<li>对于那些刚入门jQuery开发人员来说非常棒，可以使用这个扩展来学习jQuery的门道</li>\n</ul>\n<h2 id=\"codemaid\">7. <a href=\"http://www.codemaid.net/\">CodeMaid</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/2864e73047c391392c93c64b6f0e91cd.jpg\"><img class=\"aligncenter size-full wp-image-112418\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/2864e73047c391392c93c64b6f0e91cd.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>CodeMaid是一个开源的VS扩展，可以帮助您清理和简化除C#之外各种支持语言的代码。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>从代码中删除不必要的字符，如空格</li>\n<li>代码整理</li>\n<li>使用树型结构视图轻松浏览代码</li>\n<li>支持多种语言</li>\n<li>注释格式</li>\n</ul>\n<h2 id=\"refactoring-essentials\">8. <a href=\"http://vsrefactoringessentials.com/\">Refactoring Essentials</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/9c0f0877240c4e938221ed3b681237e4.jpg\"><img class=\"aligncenter size-full wp-image-112419\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/9c0f0877240c4e938221ed3b681237e4.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>使用Refactoring Essentials，一个具有内置的C#和VB代码转换器的VS扩展，使您的C#代码更容易阅读和修复常见错误。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>修复常见的错字和编码错误</li>\n<li>在代码库中找到每种不匹配的样式</li>\n<li>开源代码，您可以扩展或改进它</li>\n</ul>\n<h1 id=\"编译器编辑器和序列化\">编译器、编辑器和序列化</h1>\n<h3 id=\"slickedit\">9. <a href=\"https://www.slickedit.com/\">SlickEdit</a></h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/a1333c638778be745f8795863f76f2b9.jpg\"><img class=\"aligncenter size-full wp-image-112420\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a1333c638778be745f8795863f76f2b9.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>SlickEdit是一个代码编辑工具，可以提高生产力并提高代码质量。它是一个跨平台的代码编辑器，可在九个平台上支持超过60种语言（包括C#）。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>编译并调试您的代码，显示所有错误以便行快速访问</li>\n<li>可以处理非常大的代码文件，大到2TB</li>\n<li>语法扩展和缩进</li>\n<li>按键模拟</li>\n<li>备份历史记录</li>\n<li>多个光标和选择</li>\n<li>标准和专业版可用于满足您的需求</li>\n</ul>\n<h2 id=\"rextester\">10. <a href=\"http://rextester.com/\">Rextester</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/aa72d6d1d2d6d850b8bc04e757da51dc.jpg\"><img class=\"aligncenter size-full wp-image-112421\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/aa72d6d1d2d6d850b8bc04e757da51dc.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Rextester（代表正则表达式测试器）是C#的简单在线编译器。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>每段代码运行CPU时间最多为5秒</li>\n<li>每段代码最多可以占用150MB内存</li>\n<li>代码在应用程序域中运行，具有基本的执行、反射、线程控制和web权限</li>\n</ul>\n<h2 id=\"c-pad\">11. <a href=\"https://csharppad.com/\">C# Pad</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/4fac2d2f11390ea2e6dd24c61717f926.jpg\"><img class=\"aligncenter size-full wp-image-112422\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/4fac2d2f11390ea2e6dd24c61717f926.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>C# Pad是C#的一个方便的REPL工具。使用起来很简单：输入代码，点击“Go”执行。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>在线快速测试C#代码</li>\n<li>包括代码自动完成</li>\n<li>可嵌入其它网站</li>\n</ul>\n<h2 id=\"jdoodle\">12. <a href=\"https://www.jdoodle.com/\">Jdoodle</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/085e042ba82da71329d3f2acc3a697b8.jpg\"><img class=\"aligncenter size-full wp-image-112423\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/085e042ba82da71329d3f2acc3a697b8.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>另一个轻量级代码编译器，Jdoodle支持63种语言（包括C#），并允许您保存程序并与其他人共享URL。您可以将Jdoodle中创建的代码嵌入到您的网站，用于协作，在线访问等。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>在线快速测试一小段代码，而无需打开IDE</li>\n<li>轻松地与他人分享您的代码</li>\n<li>API即将推出</li>\n</ul>\n<h2 id=\"net-fiddle\">13. <a href=\"https://dotnetfiddle.net/\">.NET Fiddle</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/c1c4f3caf8dc79a543e7fc07eb0431b9.jpg\"><img class=\"aligncenter size-full wp-image-112424\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/c1c4f3caf8dc79a543e7fc07eb0431b9.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>C#的一个流行的调试工具，.NET Fiddle的灵感来自于JSFiddle.net，旨在快速，简单的代码测试，而无需打开Visual Studio并创建一个新的项目。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>让您编写，保存和协作C#代码</li>\n<li>支持4种项目类型：控制台，Script，MVC，Nancy</li>\n<li>还支持VB.NET和F＃</li>\n</ul>\n<h2 id=\"telerik-fiddler\">14. <a href=\"http://www.telerik.com/fiddler\">Telerik Fiddler</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/1ba1c74d48a3197be5ea9a54663bf102.jpg\"><img class=\"aligncenter size-full wp-image-112425\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/1ba1c74d48a3197be5ea9a54663bf102.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Telerik Fiddler允许您在线执行代码。它提供了一系列功能，包括Web调试、Web会话操作、性能测试、安全测试等。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>运行一系列测试，如性能测试、Web调试和安全测试</li>\n<li>FiddlerCore可让您将Fiddler应用程序嵌入到您自己的应用程序中，以便您可以避免整个Fiddler UI，还可以获得Fiddler的所有功能</li>\n</ul>\n<h2 id=\"json.net\">15. <a href=\"http://www.newtonsoft.com/json\">Json.NET</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/00105e5bd3b3bcdbfe502aaacf9526dc.jpg\"><img class=\"aligncenter size-full wp-image-112426\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/00105e5bd3b3bcdbfe502aaacf9526dc.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Json.NET是一个流行的JSON框架。使用它，您可以在任何地方（Windows，Windows Store，Windows Phone，Mono和Xamarin）运行它时，创建、解析、查询和修改JSON，在XML和JSON之间进行转换。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>对.NET对象进行序列化和反序列化</li>\n<li>查询JSON数据库</li>\n<li>使用JObject，JArray和JValue对象创建、解析、查询和修改JSON</li>\n<li>开源</li>\n</ul>\n<h2 id=\"scriptcs\">16. <a href=\"http://scriptcs.net/\">Scriptcs</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/fb23c062ff12d10ad60fb4e3e65407be.jpg\"><img class=\"aligncenter size-full wp-image-112427\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fb23c062ff12d10ad60fb4e3e65407be.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个简单的在线编辑器，编写和执行C#代码，Scriptcs被设计为非常简单，以避免使用过于复杂的工具和解决方案阻碍您的工作效率。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>避免完整IDE的臃肿</li>\n<li>为您提供简单的C#编码任务的灵活性和速度</li>\n<li>管理与NuGet的依赖关系</li>\n<li>优雅的C#脚本语法</li>\n</ul>\n<h1 id=\"反编译和代码转换工具\">反编译和代码转换工具</h1>\n<h2 id=\"dotpeek\">17. <a href=\"https://www.jetbrains.com/decompiler/\">dotPeek</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/5d1169da0b608f78a20702bff1909a77.jpg\"><img class=\"aligncenter size-full wp-image-112428\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/5d1169da0b608f78a20702bff1909a77.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>dotPeek允许您将.NET程序集反编译为C#。dotBeek是JetBrains提供的免费独立工具，基于ReSharper捆绑的反编译器。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>强大的搜索和导航功能</li>\n<li>将任何.NET程序集解码为等效的C#或IL代码</li>\n<li>支持多种格式（.dll、.exe、.winmd）</li>\n<li>将反编译的程序集保存为Visual Studio项目</li>\n</ul>\n<h2 id=\"ilspy\">18. <a href=\"http://ilspy.net/\">ILspy</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/b14c6254b53a1eef405a965f7e857a35.jpg\"><img class=\"aligncenter size-full wp-image-112429\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/b14c6254b53a1eef405a965f7e857a35.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>基于Red Gate的.NET Reflector开源反编译器，在2011年停止维护，ILspy需要.NET Framework 4.0。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>浏览程序集并将其反编译为C#</li>\n<li>将程序集保存为C#项目</li>\n<li>直观的搜索和导航功能</li>\n<li>导航历史</li>\n<li>支持C#5.0 “async”</li>\n<li>反编译为VB和C#</li>\n</ul>\n<h2 id=\"justdecompile\">19. <a href=\"http://www.telerik.com/products/decompiler.aspx\">JustDecompile</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/d93095d5cb7fe7a91e8e683a757068d8.jpg\"><img class=\"aligncenter size-full wp-image-112430\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d93095d5cb7fe7a91e8e683a757068d8.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个来自Telerik的反编译器，JustDecompile是一个免费的开源反编译引擎。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>可扩展的开放API</li>\n<li>快速代码导航</li>\n<li>轻松地在标签页中切换方法和程序集</li>\n<li>在加载程序集中使用书签</li>\n<li>从反编译的程序集创建一个Visual Studio项目</li>\n<li>Visual Studio扩展在VS项目中进行反编译</li>\n</ul>\n<h2 id=\"telerik-code-converter\">20. <a href=\"http://converter.telerik.com/\">Telerik Code Converter</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/55f1c5759c01a823a8cd152e67e9fa28.jpg\"><img class=\"aligncenter size-full wp-image-112431\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/55f1c5759c01a823a8cd152e67e9fa28.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Telerik代码转换器将VB代码转换为C#，反之亦然。一个简单而强大的工具，Telerik代码转换器易于使用，具有直观的界面。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>基于云的转换，快速和轻松的</li>\n<li>使用NRefactory库进行复杂的代码转换</li>\n<li>使用ASP.NET AJAX的Telerik UI</li>\n</ul>\n<h1 id=\"构建自动化和合并工具\">构建自动化和合并工具</h1>\n<h3 id=\"cake-build\">21. <a href=\"http://cakebuild.net/\">Cake Build</a></h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/710b109b667b0a2a4c754815d85c73b8.jpg\"><img class=\"aligncenter size-full wp-image-112432\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/710b109b667b0a2a4c754815d85c73b8.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Cake（C#Make）是C#版的开源Make Build自动化工具。一个跨平台构建自动化系统，Cake使用C# DSL来编写代码，运行单元测试，复制文件和文件夹，压缩文件和构建NuGet软件包等任务。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>在Windows，Linux和OS X上可用</li>\n<li>建立与其他CI系统相同的方式</li>\n<li>支持构建工具，包括MSBuild，MSTest，xUnit，NUnit，NuGet，ILMerge，WiX和SignTool</li>\n<li>高可扩展</li>\n</ul>\n<h2 id=\"msbuild\">22. <a href=\"https://www.visualstudio.com/en-us/docs/build/steps/build/msbuild\">MSBuild</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/dc18c33a85da75cdb5e9e497dfc15020.jpg\"><img class=\"aligncenter size-full wp-image-112433\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/dc18c33a85da75cdb5e9e497dfc15020.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>MSBuild是由Microsoft于2008年推出的。它不是Visual Studio平台的一部分，但它是您的C#开发工具包的一个很好的资源，例如在您构建代码项目时，除了解决方案之外。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>来自微软，它被许多MS商店广泛使用</li>\n<li>微软把它放到了Visual Studio中确保它不会成单独存</li>\n<li>构建多个项目</li>\n<li>构建Win32，x86，x64或任何cpu平台</li>\n<li>为多个平台构建多个配置</li>\n</ul>\n<h2 id=\"finalbuilder\">23. <a href=\"https://www.finalbuilder.com/finalbuilder\">FinalBuilder</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/76cc136d56bf28d5f660a00e8dd0f20c.jpg\"><img class=\"aligncenter size-full wp-image-112434\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/76cc136d56bf28d5f660a00e8dd0f20c.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>FinalBuilder是构建自动化工具的一个很好的商业选择。使用FinalBuilder，您不需要编辑XML或编写脚本来自动完成构建过程。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>通过包括可视化调试，使构建变得容易</li>\n<li>可视地定义和调试构建脚本</li>\n<li>使用Windows调度程序安排脚本</li>\n<li>与Continua CI，Jenkins或任何其它CI服务器集成</li>\n</ul>\n<h2 id=\"semanticmerge\">24. <a href=\"http://www.semanticmerge.com/\">SemanticMerge</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/27c5f88a28199621439e8d5f121cf978.jpg\"><img class=\"aligncenter size-full wp-image-112435\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/27c5f88a28199621439e8d5f121cf978.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>SemanticMerge分析您的代码，旨在处理已被移动或修改的代码，使其成为团队协作的强大工具。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>实现协作和分布式开发</li>\n<li>从结构合并开始，然后在发生冲突时移动到更具体的基于文本的合并</li>\n<li>基于结构而不是位置合并</li>\n<li>处理特定于语言的冲突</li>\n<li>避免错误地识别自动合并</li>\n<li>保持清洁的代码并分析更改</li>\n</ul>\n<h1 id=\"版本控制\">版本控制</h1>\n<h2 id=\"git\">25. <a href=\"https://git-scm.com/\">Git</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/2ebd63d78a68b858493da22210f0a2bb.jpg\"><img class=\"aligncenter size-full wp-image-112436\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/2ebd63d78a68b858493da22210f0a2bb.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Git就不需要介绍了。这是一个免费的开源版本控制系统，也是当今最流行的版本控制系统。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>现代版本控制工具，适用于当今地理位置分布的团队</li>\n<li>包括强大的默认值，用于解决冲突，自动恢复等</li>\n<li>便宜的本地分支</li>\n<li>方便的暂存区</li>\n<li>多个工作流程</li>\n</ul>\n<h2 id=\"team-foundation-version-control\">26. <a href=\"https://www.visualstudio.com/team-services/tfvc/\">Team Foundation Version Control</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/328f6f58124bcf89625bc7bc2aa43639.jpg\"><img class=\"aligncenter size-full wp-image-112437\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/328f6f58124bcf89625bc7bc2aa43639.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>TFS版本控制是Microsoft替代Git的一种，它集成到Visual Studio中。它是企业准备的，所以对于使用VS项目的任何规模的团队来说，这是一个不错的选择。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>利用Visual Studio功能提供本地体验</li>\n<li>跟踪分支机构的代码更改</li>\n<li>在代码签入之前提供反馈</li>\n<li>集成最流行的CI和自动化构建工具</li>\n</ul>\n<h2 id=\"bitbucket\">27. <a href=\"https://bitbucket.org/\">BitBucket</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/83bb4073ba4ba43ec8f09f7221898316.jpg\"><img class=\"aligncenter size-full wp-image-112438\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/83bb4073ba4ba43ec8f09f7221898316.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>BitBucket是Jira的Git替代品，也是一个有能力的版本控制工具——“唯一一个大规模的协作的Git解决方案。”</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>使用内联注释选项更快地协作</li>\n<li>由于代码是开源的，还是让Jira为您管理代码</li>\n<li>拉请求允许更有效的代码审查批准</li>\n<li>使用BitBucket数据中心进行不间断的访问</li>\n<li>无限私有存储库</li>\n</ul>\n<h2 id=\"sourcetree\">28. <a href=\"https://www.sourcetreeapp.com/\">SourceTree</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/6dbc13b3a314cec4fe0c7366d37abb2c.jpg\"><img class=\"aligncenter size-full wp-image-112439\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/6dbc13b3a314cec4fe0c7366d37abb2c.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>SourceTree是另一个Jira产品，一个用于Windows和Mac的免费Git客户端，具有简单的Git GUI来管理您的仓库。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>支持Windows和Mac</li>\n<li>与您的存储库进行视觉交互</li>\n<li>简化分布式版本控制</li>\n<li>对初学者来说足够简单 足够强大的专家</li>\n</ul>\n<h1 id=\"测试工具和vs扩展\">测试工具和VS扩展</h1>\n<h3 id=\"linqpad\">29. <a href=\"http://www.linqpad.net/\">LINQPad</a></h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/8b84ef5c25005a19e0d25f7e19706ac6.jpg\"><img class=\"aligncenter size-full wp-image-112440\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/8b84ef5c25005a19e0d25f7e19706ac6.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个用于即时测试C#，F#和VB中的代码片段的工具，LINQPad可以让您以交互方式查询数据库。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>有自己的查询语言 – LINQ，这是一个强大的查询数据库的方法</li>\n<li>非常适合学习C#，因为它为您提供了IDE的许多功能，而不臃肿</li>\n<li>在LINQ（或SQL） – SQL/CE/Azure、Oracle、SQLite和MySQL中查询数据库</li>\n<li>丰富的输出格式</li>\n<li>脚本并以您首选的.NET语言自动化</li>\n</ul>\n<h2 id=\"selenium\">30. <a href=\"http://www.seleniumhq.org/\">Selenium</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/30d2148445af4f7ae6568772fc5ccae8.jpg\"><img class=\"aligncenter size-full wp-image-112441\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/30d2148445af4f7ae6568772fc5ccae8.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Selenium是目前最流行的测试工具之一。它可以自动化Web浏览器，以便您可以在规模和精度上运行测试。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>自动化的基于Web的管理任务</li>\n<li>创建强大的回归自动化套件和测试</li>\n<li>跨环境和脚本分发</li>\n<li>构建您自己的Selenium服务器或使用供应商提供的托管选项</li>\n</ul>\n<h2 id=\"resharper\">31. <a href=\"https://www.jetbrains.com/resharper/\">ReSharper</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/e0d310155483608ebc407ab9a28c6fda.jpg\"><img class=\"aligncenter size-full wp-image-112442\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/e0d310155483608ebc407ab9a28c6fda.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>由JetBrains创建的，ReSharper是.NET开发人员的Visual Studio扩展。使用它来即时分析代码质量，消除错误，安全地更改代码库等。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>提供即时代码分析</li>\n<li>快速修复错误</li>\n<li>帮助复杂重构</li>\n<li>多个代码编辑助手</li>\n</ul>\n<h2 id=\"ozcode\">32. <a href=\"https://oz-code.com/\">OzCode</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/5aad95b7d82740b30d92429af2aa9bcb.jpg\"><img class=\"aligncenter size-full wp-image-112443\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/5aad95b7d82740b30d92429af2aa9bcb.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>OzCode是C#的Visual Studio扩展，提供强大的调试工具，因此您可以花更多的时间开发和更少的时间调试。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>使Visual Studio中更容易找到并修复错误</li>\n<li>与ReSharper合作</li>\n<li>用Magic Glance来绘制出复杂的表达式</li>\n<li>强大的搜索，显示和比较功能</li>\n</ul>\n<h2 id=\"coderush\">33. <a href=\"https://www.devexpress.com/products/coderush/\">CodeRush</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/afb8749eb07de32dd5886f8121b86baf.jpg\"><img class=\"aligncenter size-full wp-image-112444\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/afb8749eb07de32dd5886f8121b86baf.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>CodeRush可以帮助您轻松找到并修复问题，像本节中的其它测试工具一样，是一个VS扩展。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>视觉突出显示代码库中的问题，并帮助您快速发现问题</li>\n<li>快速创建新的测试和测试套件与快捷方式</li>\n<li>容易重构</li>\n</ul>\n<h1 id=\"性能分析\">性能分析</h1>\n<h3 id=\"prefix\">34. <a href=\"https://stackify.com/prefix/\">Prefix</a></h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/03b06f5d1cb589306d5795789ad8d54d.png\"><img class=\"aligncenter size-full wp-image-112445\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/03b06f5d1cb589306d5795789ad8d54d.png\" alt=\"162090-20170910211007866-1263253556\"></a></p>\n<p>一个用于.NET和Java的轻量级开发工具，Prefix会实时显示日志、错误、查询等。它可以在您现有的工作站内使用 – 它是免费的。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>提供每个Web请求的详细跟踪</li>\n<li>没有凌乱的配置或代码更改</li>\n<li>立即下载; 立即获得代码分析结果</li>\n<li>按要求查看日志</li>\n<li>查找隐藏的异常</li>\n<li>查看SQL查询</li>\n<li>快速找出可疑行为</li>\n</ul>\n<h2 id=\"dottrace\">35. <a href=\"https://www.jetbrains.com/profiler/\">dotTrace</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/d305e83fd3ff97da47bbcbd688abb102.jpg\"><img class=\"aligncenter size-full wp-image-112446\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d305e83fd3ff97da47bbcbd688abb102.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>来自JetBrains，dotTrace是一个分析器，可帮助排除性能问题并加快应用程序的速度。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>了解SQL查询和HTTP请求如何影响应用程序性能</li>\n<li>查看逐行剖析数据并获取特定的绩效指标</li>\n<li>获取调用执行时间的数据</li>\n<li>配置文件SQL查询和HTTP请求</li>\n<li>简介静态方法和单元测试</li>\n<li>在Visual Studio中配置和可视化结果</li>\n</ul>\n<h2 id=\"ants-performance-profiler\">36. <a href=\"https://www.red-gate.com/products/dotnet-development/ants-performance-profiler/\">ANTS Performance Profiler</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/421d2c22e18956d4c7d759d2189ddb2a.jpg\"><img class=\"aligncenter size-full wp-image-112447\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/421d2c22e18956d4c7d759d2189ddb2a.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>ANTS性能分析器是.NET代码的分析工具，包括提供逐行分析统计信息。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>查看SQL查询和HTTP请求的性能数据</li>\n<li>提供逐行结果</li>\n<li>显示历史性的表现</li>\n<li>深入了解长期分析结果</li>\n</ul>\n<h2 id=\"n-profiler\">37.<a href=\"https://www.nprofiler.com/\">N Profiler</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/193d29df37f2c0a6de25bb5f83b8c30c.jpg\"><img class=\"aligncenter size-full wp-image-112448\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/193d29df37f2c0a6de25bb5f83b8c30c.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个分析工具声称比任何其培训分析器更快，N Profiler提供丰富的.NET性能数据，可以节省90%的优化时间。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>了解性能问题的真实原因 – 数据库查询或I/O时间</li>\n<li>性能指标组织在调用树中，可以在概述或细节级别查看</li>\n</ul>\n<h1 id=\"apm\">APM</h1>\n<h2 id=\"retrace\">38. <a href=\"https://stackify.com/retrace/\">Retrace</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/54b4463f786af4d51a64b9624ce703e3.png\"><img class=\"aligncenter size-full wp-image-112450\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/54b4463f786af4d51a64b9624ce703e3.png\" alt=\"162090-20170910211007866-1263253556\"></a></p>\n<p>Retrace是唯一将APM、日志、错误、指标和监控结合在一个平台上的开发者工具，可帮助您更好地构建。它专为生产和预生产服务器而设计，每月只需10美元。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>在代码级收集性能数据</li>\n<li>应用程序和服务器记录</li>\n<li>各种来源的应用指标</li>\n<li>错误跟踪和监控</li>\n<li>与现有堆栈一起工作</li>\n<li>免费试用</li>\n</ul>\n<h1 id=\"部署自动化\">部署自动化</h1>\n<h2 id=\"octopus\">39. <a href=\"https://octopus.com/\">Octopus</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/1143dc56d334c82c08d0e6e076190eb0.jpg\"><img class=\"aligncenter size-full wp-image-112451\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/1143dc56d334c82c08d0e6e076190eb0.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>C#主要部署自动化工具，这使得自动化复杂的应用程序部署成为可能。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>提供和配置新机器来部署您的应用程序</li>\n<li>与CI服务器集成，将构建自动化和CI进程扩展到部署中</li>\n<li>精简各环境之间的版本</li>\n<li>可重复，可靠的部署</li>\n</ul>\n<h2 id=\"appveyor\">40. <a href=\"https://www.appveyor.com/\">Appveyor</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/541566723eb5308d235dcfc63e057987.jpg\"><img class=\"aligncenter size-full wp-image-112452\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/541566723eb5308d235dcfc63e057987.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个CI构建服务器，不仅可以处理构建，而且还可以进行部署，Appveyor非常强大，安全，并且无需设置即可开始使用。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>用于构建，测试和部署端到端解决方案</li>\n<li>易于使用，无需设置</li>\n<li>隔离构建环境</li>\n<li>使用UI或YAML的开发人员友好的构建配置</li>\n<li>内置部署和NuGet服务器</li>\n<li>多分支构建</li>\n</ul>\n<h2 id=\"appharbor\">41.<a href=\"https://appharbor.com/\">AppHarbor</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/38343a06fc098841a183e68f8dc5c71e.jpg\"><img class=\"aligncenter size-full wp-image-112453\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/38343a06fc098841a183e68f8dc5c71e.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>AppHarbor不仅仅是部署：它是一个完全托管的.NET 平台服务。它用于托管从个人博客到高流量网络应用程序的所有内容。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>从源代码存储库获取代码，并将其部署在自己的托管平台上</li>\n<li>使用您最喜欢的版本控制工具即时部署和扩展.NET应用程序</li>\n<li>不用担心扩展您的基础架构来跟上负载，AppHarbor会为您处理这一切</li>\n</ul>\n<h2 id=\"jenkins\">42. <a href=\"https://jenkins.io/\">Jenkins</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/74f7d0aa59c2d8ac0aad93e8ef7cfe4a.jpg\"><img class=\"aligncenter size-full wp-image-112454\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/74f7d0aa59c2d8ac0aad93e8ef7cfe4a.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Jenkins不仅仅是部署自动化工具，也是最受欢迎的CI服务器，它将其覆盖面扩展到部署和交付阶段。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>丰富的收集扩展，以适应每个堆栈</li>\n<li>从构建到部署的端到端解决方案</li>\n<li>数以百计的插件来支持构建，部署和自动化</li>\n</ul>\n<h1 id=\"容器\">容器</h1>\n<h2 id=\"docker.dotnet\">43. <a href=\"https://www.nuget.org/packages/Docker.DotNet/\">Docker.DotNet</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/15f470b4e14bc30557d58f71c8372b3f.jpg\"><img class=\"aligncenter size-full wp-image-112458\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/15f470b4e14bc30557d58f71c8372b3f.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Docker.DotNet是Docker API的C#客户端库。通过它，您可以通过编程方式与Docker Remote API进行交互。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>可以通过Visual Studio的NuGet库管理器进行安装</li>\n<li>在.NET中启用完全异步，非阻塞，面向对象的代码</li>\n</ul>\n<h2 id=\"distelli\">44. <a href=\"https://www.distelli.com/\">Distelli</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/34cc483c247ca99f52ba7cb37d0c2f07.jpg\"><img class=\"aligncenter size-full wp-image-112459\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/34cc483c247ca99f52ba7cb37d0c2f07.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个强大的工具来集中化C#应用程序，Distelli帮助您从头到尾自动化您的容器工作流程。有关如何使用Distelli构建和部署C#应用程序，请参阅<a href=\"https://www.distelli.com/docs/tutorials/build-and-deploy-c-sharp-application/\">此有用的教程</a> 。本教程提供了构建和部署Docker C#应用程序的分步说明。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>使用Distelli自动化您的容器工作流端到端</li>\n<li>部署到Kubernetes，用于最先进的容器编排</li>\n</ul>\n<p>C#和.NET Core 将在2018年及以后的得到巨大的发展，磨练C#技能将在未来几年内为您服务。我们希望您已经找到了一两种可以使用的工具，并提高了C#开发的质量和生产力。如果有什么工具我们遗漏了，请告诉我们，这个工具应该在这个工具包中有一席之地。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112411\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112411votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112411\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/3a56199c6566a8aab31f53637473d3ac298f003f.jpg"}
{"url_object_id": "f51b3da1c08181a6b90377ff717b844a", "title": ["Linux 系统开机启动项清理"], "create_data": "2017/09/07", "url": "http://blog.jobbole.com/112384/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 3, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linux.com/learn/cleaning-your-linux-startup-process\">David Both</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8835-1.html\">Linux中国/penghuster</a>   </div><p>一般情况下，常规用途的 Linux 发行版在开机启动时拉起各种相关服务进程，包括许多你可能无需使用的服务，例如蓝牙bluetooth、Avahi、 调制解调管理器ModemManager、ppp-dns（LCTT 译注：此处作者笔误 ppp-dns 应该为 pppd-dns) 等服务进程，这些都是什么东西？用于哪里，有何功能？</p>\n<p>Systemd 提供了许多很好的工具用于查看系统启动情况，也可以控制在系统启动时运行什么。在这篇文章中，我将说明在 Systemd 类发行版中如何关闭一些令人讨厌的进程。</p>\n<h3 id=\"toc_1\">查看开机启动项</h3>\n<p>在过去，你能很容易通过查看 <code>/etc/init.d</code> 了解到哪些服务进程会在引导时启动。Systemd 以不同的方式展现，你可以使用如下命令罗列允许开机启动的服务进程。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79b1f40001407550584\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemctl list-unit-files --type=service | grep enabled\r\naccounts-daemon.service                    enabled\r\nanacron-resume.service                     enabled\r\nanacron.service                            enabled\r\nbluetooth.service                          enabled\r\nbrltty.service                             enabled\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40001407550584-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40001407550584-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40001407550584-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40001407550584-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40001407550584-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40001407550584-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40001407550584-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40001407550584-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79b1f40001407550584-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-v\">list</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">unit</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">files</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">service</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grep </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40001407550584-2\"><span class=\"crayon-v\">accounts</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">daemon</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                    </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40001407550584-3\"><span class=\"crayon-v\">anacron</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">resume</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                     </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40001407550584-4\"><span class=\"crayon-v\">anacron</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                            </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40001407550584-5\"><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                          </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40001407550584-6\"><span class=\"crayon-v\">brltty</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                             </span><span class=\"crayon-i\">enabled</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40001407550584-7\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40001407550584-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>在此列表顶部，对我来说，蓝牙服务是冗余项，因为在该电脑上我不需要使用蓝牙功能，故无需运行此服务。下面的命令将停止该服务进程，并且使其开机不启动。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79b1f4000a176586502\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo systemctl stop bluetooth.service\r\n$ sudo systemctl disable bluetooth.service\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79b1f4000a176586502-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f4000a176586502-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f4000a176586502-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79b1f4000a176586502-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">stop </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f4000a176586502-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">disable </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f4000a176586502-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>你可以通过下面命令确定是否操作成功。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79b1f4000e152574716\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemctl status bluetooth.service\r\n bluetooth.service - Bluetooth service\r\n  Loaded: loaded (/lib/systemd/system/bluetooth.service; disabled; vendor preset: enabled)\r\n  Active: inactive (dead)\r\n    Docs: man:bluetoothd(8)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79b1f4000e152574716-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f4000e152574716-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f4000e152574716-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f4000e152574716-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f4000e152574716-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f4000e152574716-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79b1f4000e152574716-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">status </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f4000e152574716-2\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">service</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bluetooth </span><span class=\"crayon-e\">service</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f4000e152574716-3\"><span class=\"crayon-e\">  </span><span class=\"crayon-v\">Loaded</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">loaded</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">system</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">service</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">disabled</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">vendor </span><span class=\"crayon-v\">preset</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">enabled</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f4000e152574716-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">Active</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">inactive</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dead</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f4000e152574716-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Docs</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">man</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">bluetoothd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f4000e152574716-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>停用的服务进程仍然能够被另外一个服务进程启动。如果你真的想在任何情况下系统启动时都不启动该进程，无需卸载该它，只需要把它掩盖起来就可以阻止该进程在任何情况下开机启动。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79b1f40012730908631\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo systemctl mask bluetooth.service\r\n Created symlink from /etc/systemd/system/bluetooth.service to /dev/null.\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40012730908631-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40012730908631-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40012730908631-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79b1f40012730908631-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">mask </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40012730908631-2\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">Created </span><span class=\"crayon-e\">symlink </span><span class=\"crayon-v\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">system</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40012730908631-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>一旦你对禁用该进程启动而没有出现负面作用感到满意，你也可以选择卸载该程序。</p>\n<p>通过执行命令可以获得如下服务列表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79b1f40015919960459\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemctl list-unit-files --type=service                       \r\nUNIT FILE                                  STATE   \r\naccounts-daemon.service                    enabled\r\nacpid.service                              disabled\r\nalsa-restore.service                       static    \r\nalsa-utils.service                         masked\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40015919960459-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40015919960459-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40015919960459-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40015919960459-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40015919960459-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40015919960459-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40015919960459-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79b1f40015919960459-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-v\">list</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">unit</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">files</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">service                       </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40015919960459-2\"><span class=\"crayon-e\">UNIT </span><span class=\"crayon-e\">FILE                                  </span><span class=\"crayon-e\">STATE   </span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40015919960459-3\"><span class=\"crayon-v\">accounts</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">daemon</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                    </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40015919960459-4\"><span class=\"crayon-v\">acpid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                              </span><span class=\"crayon-e\">disabled</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40015919960459-5\"><span class=\"crayon-v\">alsa</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">restore</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                       </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40015919960459-6\"><span class=\"crayon-v\">alsa</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">utils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                         </span><span class=\"crayon-i\">masked</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40015919960459-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>你不能启用或禁用静态服务，因为静态服务被其他的进程所依赖，并不意味着它们自己运行。</p>\n<h3 id=\"toc_2\">哪些服务能够禁止？</h3>\n<p>如何知道你需要哪些服务，而哪些又是可以安全地禁用的呢？它总是依赖于你的个性化需求。</p>\n<p>这里举例了几个服务进程的作用。许多服务进程都是发行版特定的，所以你应该看看你的发行版文档（比如通过 google 或 StackOverflow）。</p>\n<ul>\n<li><strong>accounts-daemon.service</strong> 是一个潜在的安全风险。它是 AccountsService 的一部分，AccountsService 允许程序获得或操作用户账户信息。我不认为有好的理由能使我允许这样的后台操作，所以我选择掩盖mask该服务进程。</li>\n<li><strong>avahi-daemon.service</strong> 用于零配置网络发现，使电脑超容易发现网络中打印机或其他的主机，我总是禁用它，别漏掉它。</li>\n<li><strong>brltty.service</strong> 提供布莱叶盲文设备支持，例如布莱叶盲文显示器。</li>\n<li><strong>debug-shell.service</strong> 开放了一个巨大的安全漏洞（该服务提供了一个无密码的 root shell ，用于帮助 调试 systemd 问题），除非你正在使用该服务，否则永远不要启动服务。</li>\n<li><strong>ModemManager.service</strong> 该服务是一个被 dbus 激活的守护进程，用于提供移动宽频broadband（2G/3G/4G）接口，如果你没有该接口，无论是内置接口，还是通过如蓝牙配对的电话，以及 USB 适配器，那么你也无需该服务。</li>\n<li><strong>pppd-dns.service</strong> 是一个计算机发展的遗物，如果你使用拨号接入互联网的话，保留它，否则你不需要它。</li>\n<li><strong>rtkit-daemon.service</strong> 听起来很可怕，听起来像是 rootkit。 但是你需要该服务，因为它是一个实时内核调度器real-time kernel scheduler。</li>\n<li><strong>whoopsie.service</strong> 是 Ubuntu 错误报告服务。它用于收集 Ubuntu 系统崩溃报告，并发送报告到 <a href=\"https://daisy.ubuntu.com\">https://daisy.ubuntu.com</a> 。 你可以放心地禁止其启动，或者永久的卸载它。</li>\n<li><strong>wpa_supplicant.service</strong> 仅在你使用 Wi-Fi 连接时需要。</li>\n</ul>\n<h3 id=\"toc_3\">系统启动时发生了什么？</h3>\n<p>Systemd 提供了一些命令帮助调试系统开机启动问题。该命令会重演你的系统启动的所有消息。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79b1f40019262251847\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ journalctl -b\r\n\r\n-- Logs begin at Mon 2016-05-09 06:18:11 PDT,\r\nend at Mon 2016-05-09 10:17:01 PDT. --\r\nMay 16 06:18:11 studio systemd-journal[289]:\r\nRuntime journal (/run/log/journal/) is currently using 8.0M.\r\nMaximum allowed usage is set to 157.2M.\r\nLeaving at least 235.9M free (of currently available 1.5G of space).\r\nEnforced usage limit is thus 157.2M.\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40019262251847-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40019262251847-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40019262251847-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40019262251847-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40019262251847-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40019262251847-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40019262251847-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40019262251847-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40019262251847-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40019262251847-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40019262251847-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79b1f40019262251847-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">journalctl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">b</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40019262251847-2\"> </div><div class=\"crayon-line\" id=\"crayon-59b79b1f40019262251847-3\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Logs </span><span class=\"crayon-e\">begin </span><span class=\"crayon-e\">at </span><span class=\"crayon-i\">Mon</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">09</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PDT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40019262251847-4\"><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">at </span><span class=\"crayon-i\">Mon</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">09</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PDT</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40019262251847-5\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">journal</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">289</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40019262251847-6\"><span class=\"crayon-e\">Runtime </span><span class=\"crayon-e\">journal</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">journal</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">currently </span><span class=\"crayon-i\">using</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8.0M.</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40019262251847-7\"><span class=\"crayon-e\">Maximum </span><span class=\"crayon-e\">allowed </span><span class=\"crayon-e\">usage </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">157.2M.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40019262251847-8\"><span class=\"crayon-e\">Leaving </span><span class=\"crayon-e\">at </span><span class=\"crayon-i\">least</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">235.9M</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">currently </span><span class=\"crayon-i\">available</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.5G</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">space</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40019262251847-9\"><span class=\"crayon-e\">Enforced </span><span class=\"crayon-e\">usage </span><span class=\"crayon-e\">limit </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">thus</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">157.2M.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40019262251847-10\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40019262251847-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>通过命令 <code>journalctl -b -1</code> 可以复审前一次启动，<code>journalctl -b -2</code> 可以复审倒数第 2 次启动，以此类推。</p>\n<p>该命令会打印出大量的信息，你可能并不关注所有信息，只是关注其中问题相关部分。为此，系统提供了几个过滤器，用于帮助你锁定目标。让我们以进程号为 1 的进程为例，该进程是所有其它进程的父进程。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79b1f4001d248791681\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ journalctl _PID=1\r\n\r\nMay 08 06:18:17 studio systemd[1]: Starting LSB: Raise network interfaces....\r\nMay 08 06:18:17 studio systemd[1]: Started LSB: Raise network interfaces..\r\nMay 08 06:18:17 studio systemd[1]: Reached target System Initialization.\r\nMay 08 06:18:17 studio systemd[1]: Started CUPS Scheduler.\r\nMay 08 06:18:17 studio systemd[1]: Listening on D-Bus System Message Bus Socket\r\nMay 08 06:18:17 studio systemd[1]: Listening on CUPS Scheduler.\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79b1f4001d248791681-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f4001d248791681-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f4001d248791681-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f4001d248791681-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f4001d248791681-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f4001d248791681-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f4001d248791681-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f4001d248791681-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f4001d248791681-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f4001d248791681-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79b1f4001d248791681-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">journalctl </span><span class=\"crayon-v\">_PID</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f4001d248791681-2\"> </div><div class=\"crayon-line\" id=\"crayon-59b79b1f4001d248791681-3\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Starting </span><span class=\"crayon-v\">LSB</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Raise </span><span class=\"crayon-e\">network </span><span class=\"crayon-v\">interfaces</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f4001d248791681-4\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-v\">LSB</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Raise </span><span class=\"crayon-e\">network </span><span class=\"crayon-v\">interfaces</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f4001d248791681-5\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Reached </span><span class=\"crayon-e\">target </span><span class=\"crayon-e\">System </span><span class=\"crayon-v\">Initialization</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f4001d248791681-6\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-e\">CUPS </span><span class=\"crayon-v\">Scheduler</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f4001d248791681-7\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Listening </span><span class=\"crayon-i\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">D</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Bus </span><span class=\"crayon-e\">System </span><span class=\"crayon-e\">Message </span><span class=\"crayon-e\">Bus </span><span class=\"crayon-e\">Socket</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f4001d248791681-8\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Listening </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">CUPS </span><span class=\"crayon-v\">Scheduler</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f4001d248791681-9\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f4001d248791681-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>这些打印消息显示了什么被启动，或者是正在尝试启动。</p>\n<p>一个最有用的命令工具之一 <code>systemd-analyze blame</code>，用于帮助查看哪个服务进程启动耗时最长。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79b1f40021132552812\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemd-analyze blame\r\n         8.708s gpu-manager.service\r\n         8.002s NetworkManager-wait-online.service\r\n         5.791s mysql.service\r\n         2.975s dev-sda3.device\r\n         1.810s alsa-restore.service\r\n         1.806s systemd-logind.service\r\n         1.803s irqbalance.service\r\n         1.800s lm-sensors.service\r\n         1.800s grub-common.service\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40021132552812-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40021132552812-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40021132552812-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40021132552812-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40021132552812-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40021132552812-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40021132552812-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40021132552812-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40021132552812-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b1f40021132552812-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b79b1f40021132552812-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79b1f40021132552812-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">analyze </span><span class=\"crayon-i\">blame</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40021132552812-2\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">8.708s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gpu</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">manager</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40021132552812-3\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">8.002s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NetworkManager</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">wait</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">online</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40021132552812-4\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">5.791s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mysql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40021132552812-5\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">2.975s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sda3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">device</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40021132552812-6\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.810s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alsa</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">restore</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40021132552812-7\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.806s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">logind</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40021132552812-8\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.803s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">irqbalance</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40021132552812-9\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.800s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lm</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sensors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b1f40021132552812-10\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.800s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">common</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59b79b1f40021132552812-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>这个特定的例子没有出现任何异常，但是如果存在系统启动瓶颈，则该命令将能发现它。</p>\n<p>你也能通过如下资源了解 Systemd 如何工作：</p>\n<ul>\n<li><a href=\"https://www.linux.com/learn/understanding-and-using-systemd\">理解和使用 Systemd</a></li>\n<li><a href=\"https://www.linux.com/learn/intro-systemd-runlevels-and-service-management-commands\">介绍 Systemd 运行级别和服务管理命令</a></li>\n<li><a href=\"https://www.linux.com/learn/here-we-go-again-another-linux-init-intro-systemd\">再次前行，另一个 Linux 初始化系统：Systemd 介绍</a></li>\n</ul>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112384\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112384votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112384\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg"}
{"url_object_id": "7ece3c421e6d88d9a3f6f10d0d7c8a34", "title": ["MySQL 进行 Replace 操作时造成数据丢失——那些坑你踩了吗？"], "create_data": "2017/09/05", "url": "http://blog.jobbole.com/112368/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,MySQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/feicuigu/blog/1512275\">o翡翠谷o</a>   </div><h2>一、问题说明</h2>\n<p>公司开发人员在更新数据时使用了 replace into 语句，由于使用不当导致了数据的大量丢失，到底是如何导致的数据丢失？现分析如下。</p>\n<h2>二、问题分析</h2>\n<h3>a. REPLACE 原理</h3>\n<p>REPLACE INTO 原理的官方解释为：</p>\n<blockquote><p>REPLACE works exactly like INSERT, except that if an old row in the table has the same value as a new row for a PRIMARY KEY or a UNIQUE index, the old row is deleted before the new row is inserted.</p></blockquote>\n<blockquote><p>如果新插入行的主键或唯一键在表中已经存在，则会删除原有记录并插入新行；如果在表中不存在，则直接插入</p></blockquote>\n<p>地址：https://dev.mysql.com/doc/refman/5.6/en/replace.html</p>\n<h3>b. 问题现象</h3>\n<p>丢失数据的表结构如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79b2088474927905248\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE `active_items` (\r\n  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',\r\n  `ad_id` char(32) NOT NULL DEFAULT '' COMMENT 'XXX',\r\n  `ap_id` tinyint(4) NOT NULL DEFAULT '1' COMMENT 'XXX',\r\n  `price` bigint(20) NOT NULL DEFAULT '0' COMMENT 'xxx',\r\n  `rate` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `cc_price` bigint(20) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `sale_count` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `prom_count` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `c1` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `status` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `order_num` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `score` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `audit_time` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `prom_modify_time` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `sales_modify_time` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `create_time` int(11) NOT NULL DEFAULT '0' COMMENT '创建时间',\r\n  `modify_time` int(11) NOT NULL DEFAULT '0' COMMENT '最后修改时间',\r\n  `score_modify_time` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `brand_id` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `freight_status` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `flag` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `idx_ad_id` (`ad_id`) USING BTREE,\r\n  ...\r\n) ENGINE=InnoDB AUTO_INCREMENT=2699 DEFAULT CHARSET=utf8 COMMENT='XXXXX'\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79b2088474927905248-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088474927905248-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088474927905248-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088474927905248-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088474927905248-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088474927905248-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088474927905248-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088474927905248-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088474927905248-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088474927905248-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088474927905248-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088474927905248-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088474927905248-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088474927905248-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088474927905248-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088474927905248-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088474927905248-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088474927905248-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088474927905248-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088474927905248-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088474927905248-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088474927905248-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088474927905248-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088474927905248-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088474927905248-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088474927905248-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088474927905248-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79b2088474927905248-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">active_items</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088474927905248-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bigint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AUTO_INCREMENT </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'主键'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088474927905248-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ad_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088474927905248-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ap_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tinyint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088474927905248-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">price</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bigint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'xxx'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088474927905248-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">rate</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088474927905248-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">cc_price</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bigint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088474927905248-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">sale_count</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088474927905248-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">prom_count</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088474927905248-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">c1</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088474927905248-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tinyint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088474927905248-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">order_num</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088474927905248-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">score</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088474927905248-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">audit_time</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088474927905248-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">prom_modify_time</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088474927905248-16\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">sales_modify_time</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088474927905248-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">create_time</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'创建时间'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088474927905248-18\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">modify_time</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'最后修改时间'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088474927905248-19\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">score_modify_time</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088474927905248-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">brand_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088474927905248-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">freight_status</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tinyint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088474927905248-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">flag</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tinyint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088474927905248-23\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088474927905248-24\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">UNIQUE </span><span class=\"crayon-i\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">idx_ad_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ad_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">USING </span><span class=\"crayon-v\">BTREE</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088474927905248-25\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088474927905248-26\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2699</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">utf8 </span><span class=\"crayon-v\">COMMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'XXXXX'</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088474927905248-27\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0099 seconds] -->\r\n<p>执行的replace语句如下（多条）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79b208847e129094779\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nREPLACE INTO active_items(ad_id,score) VALUES('XXXXXXX', 1800);\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79b208847e129094779-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208847e129094779-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79b208847e129094779-1\"><span class=\"crayon-e\">REPLACE </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">active_items</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ad_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">score</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'XXXXXXX'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1800</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208847e129094779-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>通过查询binlog找到执行记录，部分如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79b2088482346027177\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n### UPDATE `items`.`active_items`\r\n### WHERE\r\n###   @1=21926 /* LONGINT meta=0 nullable=0 is_null=0 */\r\n###   @2='XXXXXXX' /* STRING(96) meta=65120 nullable=0 is_null=0 */\r\n###   @3=1 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n###   @4=3900 /* LONGINT meta=0 nullable=0 is_null=0 */\r\n###   @5=315 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @6=1228 /* LONGINT meta=0 nullable=0 is_null=0 */\r\n###   @7=19 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @8=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @9=-6 (4294967290) /* INT meta=0 nullable=0 is_null=0 */\r\n###   @10=0 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n###   @11=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @12=8 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @13=1489997272 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @14=1495765800 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @15=1495728000 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @16=1489996426 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @17=1489997272 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @18=1495728725 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @19=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @20=1 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n###   @21=0 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n### SET\r\n###   @1=35313 /* LONGINT meta=0 nullable=0 is_null=0 */\r\n###   @2='XXXXXXX' /* STRING(96) meta=65120 nullable=0 is_null=0 */\r\n###   @3=1 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n###   @4=0 /* LONGINT meta=0 nullable=0 is_null=0 */\r\n###   @5=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @6=0 /* LONGINT meta=0 nullable=0 is_null=0 */\r\n###   @7=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @8=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @9=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @10=0 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n###   @11=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @12=3150 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @13=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @14=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @15=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @16=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @17=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @18=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @19=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @20=0 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n###   @21=0 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088482346027177-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088482346027177-46\">46</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-1\"><span class=\"crayon-p\">### UPDATE `items`.`active_items`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-2\"><span class=\"crayon-p\">### WHERE</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-3\"><span class=\"crayon-p\">###   @1=21926 /* LONGINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-4\"><span class=\"crayon-p\">###   @2='XXXXXXX' /* STRING(96) meta=65120 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-5\"><span class=\"crayon-p\">###   @3=1 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-6\"><span class=\"crayon-p\">###   @4=3900 /* LONGINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-7\"><span class=\"crayon-p\">###   @5=315 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-8\"><span class=\"crayon-p\">###   @6=1228 /* LONGINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-9\"><span class=\"crayon-p\">###   @7=19 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-10\"><span class=\"crayon-p\">###   @8=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-11\"><span class=\"crayon-p\">###   @9=-6 (4294967290) /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-12\"><span class=\"crayon-p\">###   @10=0 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-13\"><span class=\"crayon-p\">###   @11=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-14\"><span class=\"crayon-p\">###   @12=8 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-15\"><span class=\"crayon-p\">###   @13=1489997272 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-16\"><span class=\"crayon-p\">###   @14=1495765800 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-17\"><span class=\"crayon-p\">###   @15=1495728000 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-18\"><span class=\"crayon-p\">###   @16=1489996426 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-19\"><span class=\"crayon-p\">###   @17=1489997272 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-20\"><span class=\"crayon-p\">###   @18=1495728725 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-21\"><span class=\"crayon-p\">###   @19=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-22\"><span class=\"crayon-p\">###   @20=1 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-23\"><span class=\"crayon-p\">###   @21=0 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-24\"><span class=\"crayon-p\">### SET</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-25\"><span class=\"crayon-p\">###   @1=35313 /* LONGINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-26\"><span class=\"crayon-p\">###   @2='XXXXXXX' /* STRING(96) meta=65120 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-27\"><span class=\"crayon-p\">###   @3=1 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-28\"><span class=\"crayon-p\">###   @4=0 /* LONGINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-29\"><span class=\"crayon-p\">###   @5=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-30\"><span class=\"crayon-p\">###   @6=0 /* LONGINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-31\"><span class=\"crayon-p\">###   @7=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-32\"><span class=\"crayon-p\">###   @8=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-33\"><span class=\"crayon-p\">###   @9=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-34\"><span class=\"crayon-p\">###   @10=0 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-35\"><span class=\"crayon-p\">###   @11=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-36\"><span class=\"crayon-p\">###   @12=3150 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-37\"><span class=\"crayon-p\">###   @13=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-38\"><span class=\"crayon-p\">###   @14=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-39\"><span class=\"crayon-p\">###   @15=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-40\"><span class=\"crayon-p\">###   @16=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-41\"><span class=\"crayon-p\">###   @17=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-42\"><span class=\"crayon-p\">###   @18=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-43\"><span class=\"crayon-p\">###   @19=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-44\"><span class=\"crayon-p\">###   @20=0 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088482346027177-45\"><span class=\"crayon-p\">###   @21=0 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088482346027177-46\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p>\n<ul>\n<li>操作的ad_id已经存在，因此先删除后插入，可以看到除了指定的 ad_id,score，其他字段都变为默认值，导致原有数据丢失（虽然在日志中转为了update）</li>\n</ul>\n<h3>c. 对比测试</h3>\n<p>接下来我进行了如下测试：</p>\n<p><img title=\"test_duibi\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/bc1c5405e9f04bdf942d13b7e34928ef.png\" alt=\"测试对比\"></p>\n<ul>\n<li>左侧使用 <code>REPLACE</code> 语句，右侧使用 <code>DELETE</code> + <code>INSERT</code> 语句，最后结果完全相同</li>\n<li>原主键id为1的行被删除，新插入行主键id更新为4，<strong>没有指定内容的字段c则插入了默认值</strong></li>\n<li>使用 <code>REPLACE</code> 更新了一行数据，MySQL提示受影响行数为2行</li>\n<li>综上所述，说明确实是删除一行，插入一行</li>\n</ul>\n<h2>三、数据恢复</h2>\n<p>数据丢失或数据错误后，可以有如下几种方式恢复：</p>\n<ol>\n<li>业务方自己写脚本恢复</li>\n<li>通过MySQL的binlog查出误操作sql，生成反向sql进行数据恢复（适合sql数据量较小的情况）</li>\n<li>通过历史备份文件+增量binlog将数据状态恢复到误操作的前一刻</li>\n</ol>\n<h2>四、问题扩展</h2>\n<p>通过上述分析可以发现，<code>REPLACE</code> 会删除旧行并插入新行，但是binlog中是以update形式记录，这样就带来另一个问题：</p>\n<blockquote><p><strong>从库自增长值小于主库</strong></p></blockquote>\n<h3>1. 测试</h3>\n<p><strong>a. 主从一致：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79b2088488285424486\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n主库：\r\nmysql&gt; show create table t\\G\r\n*************************** 1. row ***************************\r\n       Table: t\r\nCreate Table: CREATE TABLE `t` (\r\n  `id` int(11) NOT NULL AUTO_INCREMENT,\r\n  `a` int(11) DEFAULT '0',\r\n  `b` int(11) DEFAULT '0',\r\n  `c` int(11) DEFAULT '0',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `a` (`a`)\r\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8\r\n1 row in set (0.00 sec)\r\n\r\n从库：\r\nmysql&gt; show create table t\\G\r\n*************************** 1. row ***************************\r\n       Table: t\r\nCreate Table: CREATE TABLE `t` (\r\n  `id` int(11) NOT NULL AUTO_INCREMENT,\r\n  `a` int(11) DEFAULT '0',\r\n  `b` int(11) DEFAULT '0',\r\n  `c` int(11) DEFAULT '0',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `a` (`a`)\r\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8\r\n1 row in set (0.00 sec)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79b2088488285424486-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088488285424486-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088488285424486-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088488285424486-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088488285424486-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088488285424486-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088488285424486-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088488285424486-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088488285424486-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088488285424486-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088488285424486-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088488285424486-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088488285424486-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088488285424486-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088488285424486-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088488285424486-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088488285424486-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088488285424486-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088488285424486-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088488285424486-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088488285424486-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088488285424486-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088488285424486-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088488285424486-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088488285424486-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088488285424486-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088488285424486-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088488285424486-28\">28</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79b2088488285424486-1\">主库：</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088488285424486-2\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">show </span><span class=\"crayon-e\">create </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e \">G</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088488285424486-3\"><span class=\"crayon-e \">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">row *</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088488285424486-4\"><span class=\"crayon-h\">       </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088488285424486-5\"><span class=\"crayon-e\">Create </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088488285424486-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088488285424486-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088488285424486-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088488285424486-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088488285424486-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088488285424486-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">UNIQUE </span><span class=\"crayon-i\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088488285424486-12\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">utf8</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088488285424486-13\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088488285424486-14\"> </div><div class=\"crayon-line\" id=\"crayon-59b79b2088488285424486-15\">从库：</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088488285424486-16\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">show </span><span class=\"crayon-e\">create </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e \">G</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088488285424486-17\"><span class=\"crayon-e \">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">row *</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088488285424486-18\"><span class=\"crayon-h\">       </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088488285424486-19\"><span class=\"crayon-e\">Create </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088488285424486-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088488285424486-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088488285424486-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088488285424486-23\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088488285424486-24\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088488285424486-25\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">UNIQUE </span><span class=\"crayon-i\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088488285424486-26\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">utf8</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088488285424486-27\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088488285424486-28\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0072 seconds] -->\r\n<p><strong>b. 主库REPLACE：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79b208848c262665011\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n主库：\r\nmysql&gt; replace into t (a,b)values(1,7);\r\nQuery OK, 2 rows affected (0.01 sec)\r\n\r\nmysql&gt; show create table t\\G           \r\n*************************** 1. row ***************************\r\n       Table: t\r\nCreate Table: CREATE TABLE `t` (\r\n  `id` int(11) NOT NULL AUTO_INCREMENT,\r\n  `a` int(11) DEFAULT '0',\r\n  `b` int(11) DEFAULT '0',\r\n  `c` int(11) DEFAULT '0',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `a` (`a`)\r\n) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8\r\n1 row in set (0.00 sec)\r\n\r\n从库：\r\nmysql&gt; show create table t\\G\r\n*************************** 1. row ***************************\r\n       Table: t\r\nCreate Table: CREATE TABLE `t` (\r\n  `id` int(11) NOT NULL AUTO_INCREMENT,\r\n  `a` int(11) DEFAULT '0',\r\n  `b` int(11) DEFAULT '0',\r\n  `c` int(11) DEFAULT '0',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `a` (`a`)\r\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8\r\n1 row in set (0.00 sec)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208848c262665011-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208848c262665011-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208848c262665011-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208848c262665011-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208848c262665011-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208848c262665011-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208848c262665011-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208848c262665011-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208848c262665011-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208848c262665011-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208848c262665011-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208848c262665011-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208848c262665011-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208848c262665011-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b208848c262665011-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b79b208848c262665011-31\">31</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-1\">主库：</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208848c262665011-2\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">replace </span><span class=\"crayon-i\">into</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-3\"><span class=\"crayon-e\">Query </span><span class=\"crayon-v\">OK</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rows </span><span class=\"crayon-e\">affected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.01</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208848c262665011-4\"> </div><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-5\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">show </span><span class=\"crayon-e\">create </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e \">G           </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208848c262665011-6\"><span class=\"crayon-e \">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">row *</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-7\"><span class=\"crayon-h\">       </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208848c262665011-8\"><span class=\"crayon-e\">Create </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208848c262665011-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208848c262665011-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208848c262665011-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">UNIQUE </span><span class=\"crayon-i\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-15\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">utf8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208848c262665011-16\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208848c262665011-18\">从库：</div><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-19\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">show </span><span class=\"crayon-e\">create </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e \">G</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208848c262665011-20\"><span class=\"crayon-e \">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">row *</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-21\"><span class=\"crayon-h\">       </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208848c262665011-22\"><span class=\"crayon-e\">Create </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-23\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208848c262665011-24\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-25\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208848c262665011-26\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-27\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208848c262665011-28\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">UNIQUE </span><span class=\"crayon-i\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-29\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">utf8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b208848c262665011-30\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b79b208848c262665011-31\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0079 seconds] -->\r\n<p></p>\n<ul>\n<li>注意此时主从两个表的AUTO_INCREMENT值已经不同了</li>\n</ul>\n<p><strong>c. 模拟从升主，在从库进行INSERT：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79b2088496044575433\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmysql&gt; insert into t (a,b,c)values(4,4,4);\r\nERROR 1062 (23000): Duplicate entry '4' for key 'PRIMARY'\r\nmysql&gt; show create table t\\G\r\n*************************** 1. row ***************************\r\n       Table: t\r\nCreate Table: CREATE TABLE `t` (\r\n  `id` int(11) NOT NULL AUTO_INCREMENT,\r\n  `a` int(11) DEFAULT '0',\r\n  `b` int(11) DEFAULT '0',\r\n  `c` int(11) DEFAULT '0',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `a` (`a`)\r\n) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8\r\n1 row in set (0.00 sec)\r\n\r\nmysql&gt; insert into t (a,b,c)values(4,4,4);\r\nQuery OK, 1 row affected (0.00 sec)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79b2088496044575433-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088496044575433-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088496044575433-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088496044575433-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088496044575433-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088496044575433-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088496044575433-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088496044575433-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088496044575433-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088496044575433-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088496044575433-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088496044575433-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088496044575433-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088496044575433-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088496044575433-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088496044575433-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b79b2088496044575433-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79b2088496044575433-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79b2088496044575433-1\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert </span><span class=\"crayon-i\">into</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088496044575433-2\"><span class=\"crayon-i\">ERROR</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1062</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">23000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Duplicate </span><span class=\"crayon-i\">entry</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'4'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'PRIMARY'</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088496044575433-3\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">show </span><span class=\"crayon-e\">create </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e \">G</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088496044575433-4\"><span class=\"crayon-e \">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">row *</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088496044575433-5\"><span class=\"crayon-h\">       </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088496044575433-6\"><span class=\"crayon-e\">Create </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088496044575433-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088496044575433-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088496044575433-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088496044575433-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088496044575433-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088496044575433-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">UNIQUE </span><span class=\"crayon-i\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088496044575433-13\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">utf8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088496044575433-14\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088496044575433-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088496044575433-16\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert </span><span class=\"crayon-i\">into</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b79b2088496044575433-17\"><span class=\"crayon-e\">Query </span><span class=\"crayon-v\">OK</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-e\">affected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79b2088496044575433-18\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0052 seconds] -->\r\n<p></p>\n<ul>\n<li>从库插入时会报错，主键重复，报错后AUTO_INCREMENT会 +1，因此再次执行就可以成功插入</li>\n</ul>\n<h3>2. 结论</h3>\n<p>这个问题在平时不会有丝毫影响，但是：</p>\n<blockquote><p><strong>如果主库平时大量使用 <code>REPLACE</code> 语句，造成从库 <code>AUTO_INCREMENT</code> 值落后主库太大，当主从发生切换后，再次插入数据时新的主库就会出现大量主键重复报错，导致数据无法插入。</strong></p></blockquote>\n<h3>3. 参考文章</h3>\n<p>http://www.cnblogs.com/monian/archive/2014/10/09/4013784.html</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112368\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112368votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112368\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/35011d6168be00e949624c665041dc724e3ad786.jpg"}
{"url_object_id": "0f20efaab05e871972b90f5ccd637e96", "title": ["MySQL 8.0.3 RC 版即将发布，看看有哪些变化"], "create_data": "2017/09/11", "url": "http://blog.jobbole.com/112407/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,MySQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dev.mysql.com/doc/relnotes/mysql/8.0/en/\">MySQL</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/news/88499/mysql-8-0-3-rc-coming-soon\">老叶茶馆 微信公众号</a>   </div><p>MySQL 8.0.3 即将发布，一起看看有什么新变化吧</p>\n<p>MySQL 8.0.3 即将发布 RC 版本，这预示着 8.0 版本离 GA 越来越近了。</p>\n<p>下面分享一下 8.0.3 版本的一些重要新特性、新变化：</p>\n<ol class=\" list-paddingleft-2\">\n<li>直接<strong>废除 query cache</strong>（应该只是关闭入口，自行编译源码的话，还能再次启用）</li>\n<li>查询优化器支持直接在 SQL 中利用 <strong>SET_VAR</strong> 这个 HINT 语法修改某些会话级的选项，比如：- SELECT /*+ SET_VAR(sort_buffer_size = 16M) */ name FROM people ORDER BY name;- INSERT /*+ SET_VAR(foreign_key_checks=OFF) */ INTO t2 VALUES(2);\n<p>（这个功能超级实用啊，直接在 SQL 内可以修改了，都不用再写一个 SQL，而且还担心会影响别人）</p></li>\n<li>查询优化器现在支持将各个列统计结果直方图存储在 <strong>column_statistics</strong> 数据字典中，以便构造执行计划。有了这个直方图，就可用于该列和常量的比较判断</li>\n<li>查询优化器中新增标记位 <strong>use_invisible_indexes</strong>，用于控制在构造执行计划时是否考虑不可见索引（invisible indexes）因素</li>\n<li>InnoDB 新增<strong>备份专用锁</strong>，以前 InnoDB 表在线热备时若同时进行 DML 可能导致 InnoDB 文件的快照不一致，有了这个备份锁就不用担心了。备份锁用法是 <strong>LOCK INSTANCE FOR BACKUP、UNLOCK INSTANCE</strong>，需要有 <strong>BACKUP_ADMIN</strong> 权限</li>\n<li>InnoDB 现在支持<strong>表 DDL 的原子性</strong>，也就是 InnoDB 表上的 DDL 也可以实现事务完整性了，要么失败回滚，要么成功提交，不至于出现 DDL 时部分成功的问题，此外还<strong>支持 crash-safe 特性</strong>（这个功能大赞啊）</li>\n<li>若是延迟初始化组复制（GR，Group Replication），也就是在 single-primary 模式下，辅助节点上可以通过异步复制通道写入数据，这在正常初始化组复制插件时是不允许的（Bug #26314756，这是个内部 BUG ID，我们看不到的，别费劲了。不过还有万能的 github 啊，也能看到相关描述，参见：<a title=\"https://github.com/mysql/mysql-server/commit/acbf1d13ecd1d89557f8ca62116f06e8633dc90d\" href=\"https://github.com/mysql/mysql-server/commit/acbf1d13ecd1d89557f8ca62116f06e8633dc90d\" target=\"_blank\">https://github.com/mysql/mysql-server/commit/acbf1d13ecd1d89557f8ca62116f06e8633dc90d</a>）</li>\n<li>系统库 INFORMATION_SCHEMA 中的 <strong>FILES、PARTITIONS、REFERENTIAL_CONSTRAINTS </strong>等几个视图被重新实现了一番（这个没说太具体，可能和所有的 DDL 都放入 InnoDB 有关系，不再使用 FRM 文件存储 DDL 信息）</li>\n<li>由于外键约束锁功能改造，涉及到外键约束的父表上的列改名功能将暂时被禁用一段时间（估计过几个小版本就能正常用了）</li>\n<li>InnoDB 通用表空间新增改名语法：<strong>ALTER TABLESPACE … RENAME TO</strong>（作为 MySQL DBA，貌似没什么人玩通用表空间，可能从 Oracle DBA 转过来更习惯使用吧）</li>\n<li>MySQL 复制的 slave 节点上，<strong>log_slave_updates </strong>选项默认值改为 ON（这个也是比较实用，方便将该 slave 直接作为中继节点使用）</li>\n<li>选项 <strong>sql_log_bin </strong>的全局作用域被改成回话级作用域，也就是修改本选项只影响本会话，不再影响全局（这个选项一般也是在会话级使用）</li>\n<li>选项 <strong>max_allowed_packet </strong>的默认值从 4M 提高到 64M（这个貌似比较实在）</li>\n<li>选项 <strong>event_scheduler </strong>的默认值由 OFF 改成 ON，使得默认启用 event scheduler 功能（我觉得 event 功能挺好的呀，不过貌似没几个人使用 event）</li>\n<li>选项 <strong>max_error_count </strong>的默认值从 64 提高到 1024（没感觉的说）</li>\n<li>最后一个，utf8mb4 字符集增加俄语的校验集（新增 utf8mb4_ru_0900_ai_ci、utf8mb4_ru_0900_as_cs 两种 collations set）</li>\n</ol>\n<p>一起期待 8.0.3 的发布吧！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112407\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112407votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112407\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/35011d6168be00e949624c665041dc724e3ad786.jpg"}
{"url_object_id": "3020491df0f8c0be11c80716e2019c4c", "title": ["技术面试中常被问到是否参与开源，那如何清晰展示 GitHub 项目呢？"], "create_data": "2017/09/10", "url": "http://blog.jobbole.com/112322/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/03/124.jpg"], "praise_nums": "1", "comment_nums": 2, "fav_nums": 1, "tags": "IT技术,Github,开源", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/buntamarui\">小米云豆粥</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://thehftguy.com/2016/10/24/heres-how-to-make-a-good-github-project-for-your-resume/\">thehftguy</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>你面试的公司找你要 GitHub 链接，猎头找你要 GitHub 链接。“你参与过开源项目么？”是目前 IT 技术面试中的常见问题之一。</p>\n<p>既然他们要 GitHub，你就得给。本文将阐述如何在面试中展示你在 GitHub 上的项目。</p>\n<p>以下的建议有两个用途：应聘者可以学习怎么写软件的简介（不一定非要是GitHub）；招聘者（程序员）可以学习可以从哪些关键点来评价一个程序员的水平和软件的质量。</p>\n<figure id=\"attachment_3948\" class=\"wp-caption aligncenter\"><img class=\"aligncenter size-medium wp-image-3948\" src=\"https://thehftguy.files.wordpress.com/2016/10/github-submit-application1.png?w=300&amp;h=239\" alt=\"submit application form with a GitHub link\" width=\"300\" height=\"239\"><br>\n<figcaption class=\"wp-caption-text\">When having a GitHub is mandatory, just like having a name.</figcaption>\n</figure>\n<h3>链接一个特定的项目</h3>\n<p>在你的简历和每一份申请里面都放上你的GitHub链接。</p>\n<p>该链接要直链到一个项目。不要给你GitHub的主页地址，那个页面没有有用信息，很难让人继续浏览。</p>\n<p>你必须只展示一个项目。一个就够了，不需要更多。</p>\n<p>这个项目将是你的“登录页面”，是招聘者看到的第一个页面。他们很少去看其他页面（也没有这个必要）所以该页面本身就应该展示一切信息。如果他们去看了其他页面，说明这个主页成功引起了他们的兴趣，他们想知道更多项目细节。</p>\n<p>我们要写一个可以充分展示你的能力，并能给人留下好的第一印象的项目页面。</p>\n<h3>项目结构</h3>\n<p>用5秒时间看软件的架构就可以知道项目优劣。</p>\n<p>你一眼就能看出来一个程序员没有经验，他们的项目往往没有结构。项目文件要么在随便一个地方或者都在根目录。</p>\n<p><strong>一个好的项目结构必须将源代码，测试，库文件，可执行文件分开放在不同的文件夹中</strong>。</p>\n<p>命名的细节，例如是用‘doc’还是用‘docs’并不重要。这里是GitHub项目的<a href=\"https://GitHub.com/kriasoft/Folder-Structure-Conventions\">文件夹结构</a>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75ed5b14dd367716479\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n.\r\n├── build                   # Compiled files (alternatively `dist`)\r\n├── docs                    # Documentation files (alternatively `doc`)\r\n├── src                     # Source files (alternatively `lib` or `app`)\r\n├── test                    # Automated tests (alternatively `spec` or `tests`)\r\n├── tools                   # Tools and utilities\r\n├── LICENSE\r\n└── README.md\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75ed5b14dd367716479-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75ed5b14dd367716479-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b75ed5b14dd367716479-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75ed5b14dd367716479-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b75ed5b14dd367716479-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75ed5b14dd367716479-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b75ed5b14dd367716479-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75ed5b14dd367716479-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b75ed5b14dd367716479-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75ed5b14dd367716479-1\"><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75ed5b14dd367716479-2\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">build</span><span class=\"crayon-h\">                   </span><span class=\"crayon-p\"># Compiled files (alternatively `dist`)</span></div><div class=\"crayon-line\" id=\"crayon-59b75ed5b14dd367716479-3\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">docs</span><span class=\"crayon-h\">                    </span><span class=\"crayon-p\"># Documentation files (alternatively `doc`)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75ed5b14dd367716479-4\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">src</span><span class=\"crayon-h\">                     </span><span class=\"crayon-p\"># Source files (alternatively `lib` or `app`)</span></div><div class=\"crayon-line\" id=\"crayon-59b75ed5b14dd367716479-5\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">test</span><span class=\"crayon-h\">                    </span><span class=\"crayon-p\"># Automated tests (alternatively `spec` or `tests`)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75ed5b14dd367716479-6\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">tools</span><span class=\"crayon-h\">                   </span><span class=\"crayon-p\"># Tools and utilities</span></div><div class=\"crayon-line\" id=\"crayon-59b75ed5b14dd367716479-7\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-i\">LICENSE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75ed5b14dd367716479-8\">└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">README</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">md</span></div><div class=\"crayon-line\" id=\"crayon-59b75ed5b14dd367716479-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<figure id=\"attachment_4111\" class=\"wp-caption alignnone\"><img class=\"alignnone size-full wp-image-4111\" src=\"https://thehftguy.files.wordpress.com/2016/10/github-project-structure.png?w=809\" alt=\"software project structure\"><br>\n<figcaption class=\"wp-caption-text\">A well-organized project</figcaption>\n</figure>\n<h3>有一个项目简介文件</h3>\n<p>项目简介文件可以提供：</p>\n<ul>\n<li>项目目标</li>\n<li>截屏或视频</li>\n<li>使用说明</li>\n<li>软件下载页面</li>\n</ul>\n<h3>在简介文件里面放软件界面截屏</h3>\n<p>一张图比一千个字更能说明问题。</p>\n<p>人们不会因为要看软件界面就去安装软件。请提供软件界面截图。</p>\n<h3>在简介中放视频</h3>\n<p>一张图能抵一千个字，那么一个视频顶一千张图。</p>\n<figure id=\"attachment_3846\" class=\"wp-caption alignnone\"><img class=\"alignnone size-full wp-image-3846\" src=\"https://thehftguy.files.wordpress.com/2016/10/github-snake-gif.gif?w=809\" alt=\"snake game preview animated gif\" width=\"600\" height=\"370\"><br>\n<figcaption class=\"wp-caption-text\">Great demo from <a href=\"https://GitHub.com/DyegoCosta/snake-game\" target=\"_blank\" rel=\"noopener\">a random snake project on GitHub</a></figcaption>\n</figure>\n<p><strong>注意</strong>：GitHub不允许插入视频，你可以使用动态图。</p>\n<h3>网页链接或安装文件链接</h3>\n<p>如果该项目是网络应用，请提供网页地址。当然，所有人都应该能访问该地址。</p>\n<p>如果该项目是单机程序，请提供安装文件下载地址。如果安装文件看上去不专业，用户是不会安装它的。很多时候，是否专业跟发布方式有关。</p>\n<h3>整合GitHub工具</h3>\n<p>GitHub提供了一整套免费工具用于编连，打包，测试和其他功能。这些工具在专业软件开发中都是必须的。</p>\n<p>以前想要实现这些功能非常困难，但如今通过GitHub一切都非常简单。你没有理由不用它们。</p>\n<p><img class=\" size-full wp-image-3871 aligncenter\" style=\"height: auto; max-width: 100%; clear: both; margin: 0.8em auto;\" src=\"https://thehftguy.files.wordpress.com/2016/10/github-integration-icons.png?w=809\" alt=\"GitHub-integration-icons\"></p>\n<p>这是一个由C++实现的四子棋的例子。按钮从左到右代表：</p>\n<ol>\n<li>在Linux上编连（<a href=\"https://travis-ci.org/\" target=\"_blank\" rel=\"noopener\">Travis CI</a>）</li>\n<li>在Windows上编连（<a href=\"https://www.appveyor.com/\" target=\"_blank\" rel=\"noopener\">AppVeyor</a>）</li>\n<li>单元测试和测试覆盖分析（<a href=\"https://coveralls.io/\" target=\"_blank\" rel=\"noopener\">Coveralls</a>）</li>\n</ol>\n<h3>如何处理源代码？</h3>\n<p>“没人在乎你的源代码——得知这个事实的时候我也很吃惊。我在整理代码上花了不少时间，但发现没人在乎。重要的不是代码，而是产品” （<a href=\"https://mortoray.com/2015/04/20/nobody-cares-about-your-code/\">出处</a>）</p>\n<p>比起猜，读一段软件功能描述要快10倍。比起自己弄明白软件用法，观看一个介绍基本用法的视频可以快100倍。比起逆向工程，读设计图表要快1000倍。你可以通过读源代码来搞清楚一切，但这个过程要费事得多。读源代码（解码源代码）是非常耗时的。只有在走投无路的时候才应该用。</p>\n<p>经验教训1：没人在乎你的代码，也不会有人去读你的代码。</p>\n<p>经验教训2：别指望别人会去读你的代码，也别强迫别人去读代码。</p>\n<h3>如果我没有像样的大项目要怎么办？</h3>\n<p>挺好的。简单的项目更容易展示，更容易解释，面试官也更容易理解。比如大家都知道四子棋是怎么回事。</p>\n<p>即使第一眼看上去很简单，但每一个项目都包含了很多工作量：写一个好的用户界面，调整颜色，允许两个人一起游戏，加上对下一步棋的走子建议，加上 AI 选手等等。</p>\n<p>这个游戏规则很简单但是要把它做成好的软件要做很多工作。这些都是你在面对面的面试中可以跟面试官深入探讨的地方。</p>\n<p>你知道玩四子棋的时候先走的选手一定会赢么？【如果他不犯错的话】你知道如果第一个选手第一步棋不走中间的话，第二个选手一定可以将棋走成平局么？</p>\n<p>来源：<a href=\"http://www.informatik.uni-trier.de/~fernau/DSL0607/Masterthesis-Viergewinnt.pdf\" target=\"_blank\" rel=\"noopener\">A Knowledge-based Approach of Connect-Four</a>, <em>The Game is Solved: White Wins</em>, Victor Allis</p>\n<h3>面试官真的会去看GitHub么？</h3>\n<p>事实上<strong>他们不会</strong>。</p>\n<figure id=\"attachment_4010\" class=\"wp-caption aligncenter\"><img class=\" size-full wp-image-4010 aligncenter\" src=\"https://thehftguy.files.wordpress.com/2016/10/github-traffic.png?w=809\" alt=\"GitHub traffic statistics\"><br>\n<figcaption class=\"wp-caption-text\">GitHub Traffic Statistics</figcaption>\n</figure>\n<p>我们测试过了。这个图是我们发出一堆简历之后的数据统计。这三个点击是我自己点的。在写这篇文章的时候我没有登录就去点了GitHub。我的错。</p>\n<p>从我上次找工作的经验来说，经过十几个电话面试（每次电话有一个技术人员）和几个现场面试（4到7个技术人员），只有一个人去看了我的Giuhub页面。</p>\n<p>结论：没人关心GitHub，没人会看GitHub。每人都会问，是因为别人也在这样做。</p>\n<p>好处：既然没有人真的去看，你也可以拒绝参加这场GitHub的假面舞会。你可以用这个<a href=\"https://GitHub.com/leachim6/hello-world\"> hello world 终极版本库</a> 去回应所有的GitHub要求。这个版本库包含用一百种语言实现的“Hello world”。</p>\n<h3>小抄</h3>\n<ol>\n<li>项目要有结构</li>\n<li>要有项目简介文件</li>\n<li>写一段说明软件功能的介绍</li>\n<li>放上软件界面截图和使用说明视频</li>\n<li>提供安装文件下载地址或者网络应用的网址</li>\n<li>整合发开工具（CI，单元测试，打包工具等等）</li>\n</ol>\n<p>这世上还有其他软件工程的好范例，不仅仅局限于GitHub。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/2ec965670e006b5d53c221a7cdcf0108.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/a5e36df34a1aea088f06fb503c7ce93d.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112322\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112322votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112322\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/buntamarui\">小米云豆粥</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/buntamarui\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/5bfa690c5bc8a2dc2344cffdebf5f50b.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            数据科学进修中，Python小码农。不用QQ，有事站内信联系。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/buntamarui\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/buntamarui/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/buntamarui/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 29</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/ammie/\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/bchen4\"><i class=\"fa fa-github\"></i></a> <a title=\"Linked主页\" target=\"_blank\" href=\"https://www.linkedin.com/\"><i class=\"fa fa-linkedin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/4ccab0a38c3c13879135519b200e0c60ce7498bb.jpg"}
{"url_object_id": "883f88d012ee53f414b39b6c2be2e158", "title": ["MySQL 创始人：写代码比打游戏还爽，程序员应该多泡开源社区"], "create_data": "2017/09/05", "url": "http://blog.jobbole.com/112366/", "front_image_url": ["https://pic.36krcnd.com/avatar/201708/31082811/du4b3zkobsgzg70e.jpeg!1200"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 1, "tags": "职场,MySQL", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://blog.openocean.vc/founder-stories-a-hackers-hacker-6d5054c90564\">OpenOcean</a>   译文出处：<a target=\"_blank\" href=\"http://36kr.com/p/5090841.html\">36氪</a>   </div><p>编者按：根据StackOverflow的最新调查，MySQL仍然是全世界最流行的数据库，受访的开发者中有44.3%的人在使用，超过了第二位的SQL Server 10多个百分点。可是你知道MySQL是怎么诞生的吗？openocean 的一篇有关MySQL开发者Michael “Monty” Widenius的传记为我们揭秘。</p>\n<p><span class=\"load-html-img loaded\"><img class=\"aligncenter\" src=\"https://pic.36krcnd.com/avatar/201708/31082811/du4b3zkobsgzg70e.jpeg!1200\" alt=\"MySQL创始人：写代码比打游戏还爽，程序员应该多泡开源社区\"></span></p>\n<p>大学计算机专业的数量总是会随着技术公司的兴衰而起伏，而现在，计算机科学正处在全盛时期。这意味着，不管怎样，计算机科学专业的毕业生绝大部分可能都会去敲2年的代码，再转到产品管理，然后过渡到企业、创业或者商学院，接着再转为既有公司的中层管理，32岁的时候结婚，有了2个孩子，一个儿子，一个女儿，一条狗，还有一栋2层的漂亮房子。对于大多数人来说，成为程序员就是一份朝九晚五的工作，一份有保障的6位数薪水来偿还高昂的学费，一种达到目的的手段，没人应该为此受到责备。但对于千千万万无论好坏的程序员来说，只有一个Monty Widenius。</p>\n<p>Monty是一位编程天才。19岁的时候，他从赫尔辛基理工大学辍学开始全职工作，因为大学已经没有什么东西可以教他了。在独自一人写完除了一个库以外的全部代码之后，33岁时，他发布了MySQL，后来后者成为了全世界最流行的开源数据库。55岁时，他藐视着对老年人的歧视，仍然是自己公司最好的程序员。</p>\n<p>Monty1962年出生于赫尔辛基，1978年他用暑假铺沥青挣来的钱买下自己的第一台个人计算机的。Monty迅速意识到自己相当擅长写代码——对于别人来说很复杂的事情他却觉得很简单，而且他对工作非常投入。Monty用一种在讲瑞典语的芬兰人中常见的浓厚口音说：“基本上这就像是在阅读一本真的非常非常好的书。或者像在玩视频游戏。你知道开始玩游戏然后嘣一声3小时的时间就过去了的那种感觉吗？写代码对我来说就是这种感觉。”</p>\n<p>当别人跑去聚会的时候，Monty却呆在家里编程。他把计算机从里到外都摸透了。他把BASIC的能力推到了极限。Monty说：“学校并不理解编程不是像语言或者历史这样的东西，它不是靠学就能学来的。所以学校是不够的。拔尖的黑客是万里挑一。他们奉献了所有能用的时间，10小时，16小时，每一天，年复一年周而复始。大多数人都不愿意做这样的事情。大多数人宁愿好好生活。”在Monty眼里，好的代码是写过一次就永远不需要再碰的那种。从性能角度来看它已经是最优化了，你可以不断增强，但永远都不需要重写。</p>\n<p>到1980年，17岁的Monty痴迷编程已经无法自拔，他需要把自己计算机的内存从8KB扩到16KB。由于芬兰没有商店卖他想要的东西，于是他弄了一条船去到瑞典Allan Larsson的计算机商店。通过Allan，Monty结识了David Axmark，三人沟通交流了多年，就各自项目互相帮忙，偶尔也会一起协作。1995年，他们一起成立了MySQL AB。Monty负责编程，David和Allan负责干完其他的事情。自1981年以来，Monty就一直以芬兰公司Tapio Laakso Oy程序员的身份在写MySQL前身的代码，他和Allan一起创办的数据仓库公司也要用到那个东西。然而，知道1995年，在Allan和David的游说之后Monty才决定在他写的东西之上增加一个SQL层。1996年10月，MySQL终于发布了，它得到了广泛的欢迎。MySQL快速、可靠并且易学，这主要是因为在多年的开发中Monty总是不断把正是客户的反馈整合进来。</p>\n<p>MySQL的初衷是存储和管理大数据。如果有人想要跟踪不同的数据点，他们互使用数据库，也就是有点像微软Excel那样的东西。然而，随着数据变得越来越大，查找Excel这样的数据库就会变得慢多了，也不再可靠。MySQL有能力存储大量数据，并且返回搜索结果极其迅速。“My”来自Monty女儿的名字，而“SQL”就是结构化查询语言（Structured Query Language）的意思，是一种跟数据库沟通的语言。</p>\n<p>对MySQL开源的决定出自1985年的另一次芬兰到瑞典的乘船旅行，这一次是在一场开源大会上。Monty说：“讨论没花多少分钟。我们都希望回馈给开源社区一点东西。哪怕有人想拷贝或者偷盗我们的代码，我们认为自己能挣的钱也不会比现在少。”开源项目使得开发者社区帮助把软件做得更好，但从商业角度来看不好的是货币化就要困难多了。为了避免这一点，Monty补充了一个条款，那就是如果任何企业用MySQL来赚钱的话，就需要付费授权。对此MySQL的代码里面并没有进行任何限制，但就靠这一荣誉制度MySQL实现了扩张并开始赚钱。Monty说：“我认为开源是开发软件的更好方式。但你仍然需要赚够钱来招聘员工，成立公司去跟闭源社区竞争。MySQL是第一款做到这一点的产品。”</p>\n<p>Monty在MySQL AB的职位是CTO，对于大多数成熟的公司来说，CTO其实已经很少再编程的了。然而，Monty从未停下来过，他的绝大部分时间都是在写代码。这种（很少管理的）做法会导致很多晚期阶段初创企业内爆，但哪怕公司人数已经达到550人，Monty在MySQL AB建立的独特文化也使得他可以避免天天开会的烦扰（事实上，Monty甚至都不接受议事日程邀请）。Monty说：“我总是招会自我驱动的人进来。所以我不需要告诉他们太多东西。而开源意味着你有开源社区，大家会给你提供代码，你可以看看那些代码的质量，看看他们是怎么跟社区互动的，跟你是怎么沟通的，他们会问什么问题，在这些情况下很容易就能看出一个人是好是坏。在一次面试里面是很难了解清楚编码者有多好的。”</p>\n<p>MySQL的成功是CTO Monty与CEO Mårten Mickos通力协作的结果。两人能力都很强且对公司非常重要，但方式不一样。Monty是技术专家，专注于员工生产出尽量完美的代码。Mårten是公司建设者，专注于交付东西并帮助团队发展。正是两人的联合愿景制造出了MySQL。但在一家没有免费洗衣、免费午餐、站立办公桌的公司里，是Monty的个人魅力吸引住了变成人才。Monty不是好交际的筹资人，讨好别人的人，博弈论大师，或者职业沟通者。他会写代码，而且写得很好。在Monty看来赢得开发者尊重是很简单的事情：“你干的是跟他们一样的事，而且干得更好。”</p>\n<p><strong>Monty给程序员的建议是，参与到开源社区去，花些时间到个人项目里面</strong>（“这些年来我开发了成百上千个程序：MySQL是其中被用得最多的一个，但其他的都只有我自己用。”）。他警告说，改变环境和代码库将意味着哪怕是最好的程序员也要去了解一堆的东西。在Sun被Oracle收购之后，Monty成立了MariaDB，这是MySQL的一个社区版的分支，开发的团队成员很多都是MySQL团队里面的，使用的也是一样的官方语言：“蹩脚的英语”。MySQL的许多热心的开源信徒跟着Monty去到了MariaDB。MariaDB更加面向开发者，允许由外人打补丁这样的事情发生，在很多Linux发行版中它都是默认的数据库。</p>\n<p>Monty对开源和开发者的承诺是坚定的——OpenOcean原先是Monty用自己在MySQL的所得成立的，使命是投身于开发者驱动、有技术深度的产品。他仍然在赫尔辛基自己家中主持开发者午餐，很快OpenOcean就将推出一个Slack频道让开发者可以直接向Monty提问。在几十年的时间里，Monty对塑造开源社区无私的形象做出的贡献无可争议的。但这里面大部分的功劳都应该归到成千上万无名的程序员和黑客身上，是他们投入的时间和能力造就了开源的繁荣，也是这批人才能确保开源革命的继续。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112366\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112366votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112366\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/0c3f9ba3f4a5ba0b302eafe8fdee79036cb5f3b1.jpg"}
{"url_object_id": "cfaf090cb48b0f211a6912344d6ea9b9", "title": ["基于 Redis 实现分布式应用限流"], "create_data": "2017/09/07", "url": "http://blog.jobbole.com/112381/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术,Redis,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/giegie/blog/1525931\">冷冷gg</a>   </div><p>限流的目的是通过对并发访问/请求进行限速或者一个时间窗口内的的请求进行限速来保护系统，一旦达到限制速率则可以拒绝服务。</p>\n<p>前几天在DD的公众号，看了一篇关于使用 瓜娃 实现单应用限流的方案，参考《redis in action》 实现了一个jedis版本的，都属于业务层次限制。 实际场景中常用的限流策略：</p>\n<ul>\n<li>Nginx接入层限流<br>\n按照一定的规则如帐号、IP、系统调用逻辑等在Nginx层面做限流</li>\n<li>业务应用系统限流<br>\n通过业务代码控制流量这个流量可以被称为信号量，可以理解成是一种锁，它可以限制一项资源最多能同时被多少进程访问。</li>\n</ul>\n<h3>代码实现</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b74515682f0705256538\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport redis.clients.jedis.Jedis;\r\nimport redis.clients.jedis.Transaction;\r\nimport redis.clients.jedis.ZParams;\r\n\r\nimport java.util.List;\r\nimport java.util.UUID;\r\n\r\n/**\r\n * email wangiegie@gmail.com\r\n * @data 2017-08\r\n */\r\npublic class RedisRateLimiter {\r\n    private static final String BUCKET = \"BUCKET\";\r\n    private static final String BUCKET_COUNT = \"BUCKET_COUNT\";\r\n    private static final String BUCKET_MONITOR = \"BUCKET_MONITOR\";\r\n\r\n    static String acquireTokenFromBucket(\r\n            Jedis jedis, int limit, long timeout) {\r\n        String identifier = UUID.randomUUID().toString();\r\n        long now = System.currentTimeMillis();\r\n        Transaction transaction = jedis.multi();\r\n\r\n        //删除信号量\r\n        transaction.zremrangeByScore(BUCKET_MONITOR.getBytes(), \"-inf\".getBytes(), String.valueOf(now - timeout).getBytes());\r\n        ZParams params = new ZParams();\r\n        params.weightsByDouble(1.0,0.0);\r\n        transaction.zinterstore(BUCKET, params, BUCKET, BUCKET_MONITOR);\r\n\r\n        //计数器自增\r\n        transaction.incr(BUCKET_COUNT);\r\n        List&lt;Object&gt; results = transaction.exec();\r\n        long counter = (Long) results.get(results.size() - 1);\r\n\r\n        transaction = jedis.multi();\r\n        transaction.zadd(BUCKET_MONITOR, now, identifier);\r\n        transaction.zadd(BUCKET, counter, identifier);\r\n        transaction.zrank(BUCKET, identifier);\r\n        results = transaction.exec();\r\n        //获取排名，判断请求是否取得了信号量\r\n        long rank = (Long) results.get(results.size() - 1);\r\n        if (rank &lt; limit) {\r\n            return identifier;\r\n        } else {//没有获取到信号量，清理之前放入redis 中垃圾数据\r\n            transaction = jedis.multi();\r\n            transaction.zrem(BUCKET_MONITOR, identifier);\r\n            transaction.zrem(BUCKET, identifier);\r\n            transaction.exec();\r\n        }\r\n        return null;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682f0705256538-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682f0705256538-51\">51</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Jedis</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Transaction</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ZParams</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-4\"> </div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">List</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UUID</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-8\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-9\"><span class=\"crayon-c\"> * email wangiegie@gmail.com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-10\"><span class=\"crayon-c\"> * @data 2017-08</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-11\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-12\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisRateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"BUCKET\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET_COUNT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"BUCKET_COUNT\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"BUCKET_MONITOR\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-16\"> </div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">acquireTokenFromBucket</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UUID</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">randomUUID</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Transaction </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">multi</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-22\"> </div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//删除信号量</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zremrangeByScore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-inf\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valueOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">now</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">ZParams </span><span class=\"crayon-v\">params</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZParams</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">weightsByDouble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zinterstore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-28\"> </div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//计数器自增</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">incr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_COUNT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Object</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">multi</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zadd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zadd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrank</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//获取排名，判断请求是否取得了信号量</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-c\">//没有获取到信号量，清理之前放入redis 中垃圾数据</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-44\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">multi</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682f0705256538-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682f0705256538-51\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0094 seconds] -->\r\n<p></p>\n<h3>调用</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b74515682fa750798454\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n测试接口调用\r\n@GetMapping(\"/\")\r\npublic void index(HttpServletResponse response) throws IOException {\r\n    Jedis jedis = jedisPool.getResource();\r\n    String token = RedisRateLimiter.acquireTokenFromBucket(jedis, LIMIT, TIMEOUT);\r\n    if (token == null) {\r\n        response.sendError(500);\r\n    }else{\r\n        //TODO 你的业务逻辑\r\n    }\r\n    jedisPool.returnResource(jedis);\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b74515682fa750798454-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fa750798454-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fa750798454-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fa750798454-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fa750798454-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fa750798454-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fa750798454-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fa750798454-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fa750798454-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fa750798454-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fa750798454-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fa750798454-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fa750798454-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b74515682fa750798454-1\">测试接口调用</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fa750798454-2\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">GetMapping</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fa750798454-3\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">HttpServletResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fa750798454-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fa750798454-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisRateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquireTokenFromBucket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LIMIT</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TIMEOUT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fa750798454-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fa750798454-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fa750798454-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fa750798454-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//TODO 你的业务逻辑</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fa750798454-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fa750798454-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">returnResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fa750798454-12\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fa750798454-13\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<h2>优化</h2>\n<p>使用拦截器 + 注解优化代码</p>\n<h3>拦截器</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b74515682fe830462788\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@Configuration\r\nstatic class WebMvcConfigurer extends WebMvcConfigurerAdapter {\r\n    private Logger logger = LoggerFactory.getLogger(WebMvcConfigurer.class);\r\n    @Autowired\r\n    private JedisPool jedisPool;\r\n\r\n    public void addInterceptors(InterceptorRegistry registry) {\r\n        registry.addInterceptor(new HandlerInterceptorAdapter() {\r\n            public boolean preHandle(HttpServletRequest request, HttpServletResponse response,\r\n                                     Object handler) throws Exception {\r\n                HandlerMethod handlerMethod = (HandlerMethod) handler;\r\n                Method method = handlerMethod.getMethod();\r\n                RateLimiter rateLimiter = method.getAnnotation(RateLimiter.class);\r\n\r\n                if (rateLimiter != null){\r\n                    int limit = rateLimiter.limit();\r\n                    int timeout = rateLimiter.timeout();\r\n                    Jedis jedis = jedisPool.getResource();\r\n                    String token = RedisRateLimiter.acquireTokenFromBucket(jedis, limit, timeout);\r\n                    if (token == null) {\r\n                        response.sendError(500);\r\n                        return false;\r\n                    }\r\n                    logger.debug(\"token -&gt; {}\",token);\r\n                    jedis.close();\r\n                }\r\n                return true;\r\n            }\r\n        }).addPathPatterns(\"/*\");\r\n    }\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b74515682fe830462788-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b74515682fe830462788-32\">32</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Configuration</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-2\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WebMvcConfigurer</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WebMvcConfigurerAdapter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Logger </span><span class=\"crayon-v\">logger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LoggerFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getLogger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">WebMvcConfigurer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Autowired</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-5\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPool </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-6\"> </div><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addInterceptors</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">InterceptorRegistry </span><span class=\"crayon-v\">registry</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">registry</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addInterceptor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HandlerInterceptorAdapter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preHandle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">HttpServletRequest </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpServletResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-10\"><span class=\"crayon-h\">                                     </span><span class=\"crayon-t\">Object</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">HandlerMethod </span><span class=\"crayon-v\">handlerMethod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HandlerMethod</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-12\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">Method </span><span class=\"crayon-v\">method</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handlerMethod</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getMethod</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">RateLimiter </span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">method</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getAnnotation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-14\"> </div><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-15\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-16\"><span class=\"crayon-h\">                    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">limit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-17\"><span class=\"crayon-h\">                    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">timeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-18\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-19\"><span class=\"crayon-h\">                    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisRateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquireTokenFromBucket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-20\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-21\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-22\"><span class=\"crayon-h\">                        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-23\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-24\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">debug</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"token -&gt; {}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-25\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-26\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-27\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addPathPatterns</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/*\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b74515682fe830462788-31\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b74515682fe830462788-32\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0055 seconds] -->\r\n<p></p>\n<h3>定义注解</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b7451568302752080099\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/**\r\n * email wangiegie@gmail.com\r\n * @data 2017-08\r\n * 限流注解\r\n */\r\n\r\n@Target(ElementType.METHOD)\r\n@Retention(RetentionPolicy.RUNTIME)\r\n@Documented\r\npublic @interface RateLimiter {\r\n    int limit() default 5;\r\n    int timeout() default 1000;\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b7451568302752080099-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7451568302752080099-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b7451568302752080099-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7451568302752080099-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b7451568302752080099-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7451568302752080099-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b7451568302752080099-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7451568302752080099-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b7451568302752080099-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7451568302752080099-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b7451568302752080099-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7451568302752080099-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b7451568302752080099-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7451568302752080099-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b7451568302752080099-1\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7451568302752080099-2\"><span class=\"crayon-c\"> * email wangiegie@gmail.com</span></div><div class=\"crayon-line\" id=\"crayon-59b7451568302752080099-3\"><span class=\"crayon-c\"> * @data 2017-08</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7451568302752080099-4\"><span class=\"crayon-c\"> * 限流注解</span></div><div class=\"crayon-line\" id=\"crayon-59b7451568302752080099-5\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7451568302752080099-6\"> </div><div class=\"crayon-line\" id=\"crayon-59b7451568302752080099-7\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Target</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ElementType</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">METHOD</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7451568302752080099-8\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Retention</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RetentionPolicy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RUNTIME</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7451568302752080099-9\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Documented</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7451568302752080099-10\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b7451568302752080099-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">limit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7451568302752080099-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">timeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b7451568302752080099-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7451568302752080099-14\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h3>使用</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b7451568305849111814\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@RateLimiter(limit = 2, timeout = 5000)\r\n@GetMapping(\"/test\")\r\npublic void test() {\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b7451568305849111814-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7451568305849111814-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b7451568305849111814-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7451568305849111814-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b7451568305849111814-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b7451568305849111814-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">RateLimiter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">limit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5000</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7451568305849111814-2\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">GetMapping</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/test\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7451568305849111814-3\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7451568305849111814-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b7451568305849111814-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h2>并发测试</h2>\n<p>工具：apache-jmeter-3.2<br>\n说明： 没有获取到信号量的接口返回500，status是红色，获取到信号量的接口返回200，status是绿色。<br>\n当限制请求信号量为2，并发5个线程： <img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/88fe4ce72def9cd9bcb4ddcc1185200e.png\" alt=\"image\"><br>\n当限制请求信号量为5，并发10个线程：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d92c4624c99f43a7093aa4fe92b7a112.png\" alt=\"image\"></p>\n<h2>资料</h2>\n<p><a href=\"https://github.com/tangaiyun/RedisRateLimiter\">基于reids + lua的实现</a></p>\n<h2>总结</h2>\n<ol>\n<li>对于信号量的操作，使用事务操作。</li>\n<li>不要使用时间戳作为信号量的排序分数，因为在分布式环境中，各个节点的时间差的原因，会出现不公平信号量的现象。</li>\n<li>可以使用把这块代码抽成@rateLimiter注解，然后再方法上使用就会很方便啦</li>\n<li>不同接口的流控，可以参考源码的里面RedisRateLimiterPlus,无非是每个接口生成一个监控参数</li>\n<li>源码<a href=\"http://git.oschina.net/boding1/pig-cloud\">http://git.oschina.net/boding1/pig-cloud</a></li>\n</ol>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112381\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112381votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112381\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/c766feed221138f7946130756cddfc7e86e388b4.jpg"}
{"url_object_id": "858cdc33a650f25a8a2a59f7c919b4b8", "title": ["完美主义对新手程序员的影响"], "create_data": "2017/09/06", "url": "http://blog.jobbole.com/112372/", "front_image_url": ["http://wx1.sinaimg.cn/large/7cc829d3gy1fj9xymo8v2j20h70b3dj7.jpg"], "praise_nums": "3", "comment_nums": 2, "fav_nums": 3, "tags": "职场,程序员,职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://medium.freecodecamp.org/why-striving-for-perfection-might-be-holding-you-back-as-a-newbie-web-developer-6e8ae257751f\">Rick West</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>我是一个完美主义者，或者，至少我喜欢这样自居。不管怎样，我绝对离完美主义者不远了。</p>\n<p>这样本来挺好的。然而，我最近意识到，它实际上阻碍我成为一个更出色的开发者。至少，它阻碍了我的进步，并妨碍了我的学习。</p>\n<p>像很多初级开发者和普通开发者，我有一个不完成副项目（side projects）的习惯。不是因为我懒或没时间，出于某种原因，我似乎从来不会把事情做完。</p>\n<p>然后就是受打击的地方了。</p>\n<p>在进行项目时，我一直努力追求完美，</p>\n<p>这就是问题的所在。</p>\n<p><em>怎么定义完美？完美是什么意思？完美真的是一个可以实现的目标吗？</em></p>\n<p>对我来说，我想交出一些了不起的东西，尽自己所能做出一些东西。</p>\n<p>想法是好的，但作为一个初级开发者，我面对的困境是，因为我每天都在学习，我的能力在不断增强。</p>\n<p>这样的话，我如何才能尽自己最大（且不断提高的）能力，将一个项目做到最好？！</p>\n<p>作为开发者，这是阻碍我进步的关键因素。我不知道要在哪里确定一条底线。我觉得很难对自己说“够了，可以继续前进了”。</p>\n<p><strong>而有时候，情况甚至会变得有些愚蠢…</strong></p>\n<p>6 个月前，我写了一个简单的 URL 缩短器，以熟悉 Symfony 框架。我花了几个晚上的时间，做出了一个基本的工作产品（Working Product），以及一个大的框架介绍。做得很开心？好吧，不尽然。</p>\n<p>信不信由你，3 个月后，我仍在对这个小项目修修补补：修改样式，用 Ajax 改进表单提交，我甚至考虑过用 Vue 或 React 来实现。</p>\n<p>随着我的能力和知识的不断增加，<strong>我完全无法继续前进</strong>。我不断看到能够改进的地方，并有了更好的改进方法。</p>\n<p>这在商业环境中是好事。在产品或项目上不断进行改进和迭代非常赞。</p>\n<p>但是，作为一个小小的学习项目，我明显用力过猛了，正在努力解决一个并不存在的问题。这不是尝试给 Bitly（知名短网址服务）造一个竞争对手，我只是利用这个小项目来加强自身的学习。事实上，根本没有人会看到这个项目！</p>\n<p>我并不是唯一会这么做的人，即使最有经验的开发者，也会在某个时候遇到类似的情况。当他们回顾几年前写的代码，他们可能会羞愧难当，甚至可能会对自己几个月前写的代码感到震惊。</p>\n<p><em><img id=\"pic\" class=\"M_cur_zoom_out aligncenter\" src=\"http://wx1.sinaimg.cn/large/7cc829d3gy1fj5iolq237j20je0j6nav.jpg\" width=\"572\" height=\"565\"></em></p>\n<p style=\"text-align: center;\"><em>（伯乐在线补充配图，Via：程序员的那些事）</em></p>\n<p>作为开发者，无论处于什么水平，你都在不断学习，这是野兽的天性。而经验告诉我们，你只有学会放手，才能继续前进。</p>\n<p>但说起来容易做起来难。作为一个初级的，或有抱负的开发者，“单单”继续前进就显得难得多了。在现实中，除非你的代码接受他人的审查，否则你完全不知道好与坏的标准。</p>\n<p>我的建议是，在你学习时，要创建一些东西，直到它看起来很得体，并能正常工作，此时你需要忘掉它继续前进。不要寻求完美，这是不存在的~ 你应该将时间花在学习并钻研更大、更好的事情上，而不是花在类似调整无关要紧的内边距这一类事情上。请务必相信我这个过来人的经验之谈！</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx1.sinaimg.cn/large/7cc829d3gy1fj9xymo8v2j20h70b3dj7.jpg\"></p>\n<p>我最终明白了“<strong>完成比完美更好</strong>”这句话，这也是二八定律告诉我们的道理。（原因与结果、投入与产出、努力与报酬之间的关系往往是不平衡的，结果、产出或报酬的 80％ 取决于 20％ 的原因、投入或努力。）</p>\n<p>当你处于学习阶段时，所有的项目都不需要做到“完美”。它们本身就是用于学习的项目，做完尽管放手让它们去。</p>\n<p>瞎搞瞎弄、缝缝补补、或者试图压缩最后 10％ 的时间，这些都不是对有限时间的合理使用方式。</p>\n<p>在 Web 开发中，完美是不存在的。</p>\n<p>只有一种情况除外，那就是…完成，因为“完成即完美（done === perfect）”。</p>\n<p>随着时间的推移，你能做出更大、更好的东西！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112372\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112372votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112372\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            我见青山多妩媚，料青山见我应如是        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 36</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/b906ccd28196f4dac2561cbd4120d442b442de87.jpg"}
{"url_object_id": "8e71395dfec60b991d278a434c35a1da", "title": ["使用 Redis 解决“树”形数据的复杂查询"], "create_data": "2017/09/04", "url": "http://blog.jobbole.com/112358/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,Redis,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/u/1469495/blog/1504818\">qiujiayu</a>   </div><p>最近因业务需要，研究了一下树数据结果的存储及查询解决方案。 最初的想法是使用neo4j,可是在网上看了一下开源的不支持集群，感觉用的人不多。</p>\n<p>网上也查了一些 <a href=\"http://blog.jobbole.com/112309/\">树形结构数据存储方案</a> 但每种实现方案都有它的一定局限性。</p>\n<p>想了一短时间后，想出了下面的方案：</p>\n<p>一、 因为复杂的查询都由Redis来处理，所以数据库表的设计就变得非常简单：tree 表</p>\n<p>| 字段名称 | 数据类型 | 备注说明 | | —- | —- | —- | | id | int | 主键 | | parent_id | int | 上级节点ID |</p>\n<p>二、Redis的数据存储方案：</p>\n<p>把表的数据存储到一个Hash表中，使用表中的id值做为此hash表的key, value值为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b7a21648f2f301062598\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n   id: 10,\r\n   parentId: 9,\r\n   childIds: [11]\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f2f301062598-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f2f301062598-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f2f301062598-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f2f301062598-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f2f301062598-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f2f301062598-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b7a21648f2f301062598-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f2f301062598-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f2f301062598-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">parentId</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f2f301062598-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">childIds</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f2f301062598-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f2f301062598-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h3>代码实现</h3>\n<p>为了简化测试，这里只演示Redis相关的操作</p>\n<ol>\n<li>Tree 类定义<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b7a21648f38088893749\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n public class Tree {\r\n     private Integer id;\r\n     private String name;\r\n     private Integer parentId;\r\n     private List&lt;Integer&gt; childIds;\r\n }\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f38088893749-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f38088893749-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f38088893749-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f38088893749-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f38088893749-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f38088893749-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f38088893749-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b7a21648f38088893749-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f38088893749-2\"><span class=\"crayon-h\">     </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Integer</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f38088893749-3\"><span class=\"crayon-h\">     </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f38088893749-4\"><span class=\"crayon-h\">     </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Integer</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parentId</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f38088893749-5\"><span class=\"crayon-h\">     </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f38088893749-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f38088893749-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</li>\n<li>往Redis中添加测试数据：<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b7a21648f3e116631170\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n [@Test](https://my.oschina.net/azibug)\r\n public void addTestData() throws Exception {\r\n     String key = \"tree-test-key\";\r\n     Tree tree = new Tree();\r\n     List&lt;Integer&gt; childIds = new ArrayList&lt;&gt;();\r\n     int max = 100000\r\n     tree.setChildIds(childIds);\r\n     for (int i = 0; i &lt; max; i++) {\r\n         tree.setId(i);\r\n         tree.setName(\"tree\" + i);\r\n         if (i &gt; 0) {\r\n             tree.setParentId(i - 1);\r\n         }\r\n         childIds.clear();\r\n         if(i &lt; (max - 1)){\r\n             childIds.add(i + 1);\r\n         }\r\n         redis.setHash(key, \"\" + i, JsonUtil.toJson(tree));\r\n     }\r\n }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f3e116631170-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f3e116631170-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f3e116631170-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f3e116631170-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f3e116631170-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f3e116631170-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f3e116631170-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f3e116631170-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f3e116631170-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f3e116631170-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f3e116631170-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f3e116631170-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f3e116631170-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f3e116631170-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f3e116631170-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f3e116631170-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f3e116631170-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f3e116631170-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f3e116631170-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f3e116631170-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b7a21648f3e116631170-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//my.oschina.net/azibug)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f3e116631170-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addTestData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f3e116631170-3\"><span class=\"crayon-h\">     </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"tree-test-key\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f3e116631170-4\"><span class=\"crayon-h\">     </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-v\">tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Tree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f3e116631170-5\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">childIds</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ArrayList</span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f3e116631170-6\"><span class=\"crayon-h\">     </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100000</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f3e116631170-7\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setChildIds</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f3e116631170-8\"><span class=\"crayon-h\">     </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f3e116631170-9\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setId</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f3e116631170-10\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"tree\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f3e116631170-11\"><span class=\"crayon-h\">         </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f3e116631170-12\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setParentId</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f3e116631170-13\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f3e116631170-14\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clear</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f3e116631170-15\"><span class=\"crayon-h\">         </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">max</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f3e116631170-16\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f3e116631170-17\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f3e116631170-18\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setHash</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">JsonUtil</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toJson</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f3e116631170-19\"><span class=\"crayon-h\">     </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f3e116631170-20\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n\n</li>\n<li>Lua 代码的实现</li>\n</ol>\n<p>在Lua中使用递归时，需要使用“尾调用”来优化代码。关于尾调用的知识，大家可以上网去搜索。</p>\n<h4>获取所有子节点 get-tree-childs.lua</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b7a21648f42688789037\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocal treeKey = KEYS[1]\r\nlocal fnodeId  = ARGV[1]\r\n\r\nlocal function getTreeChild(currentnode, t, res)\r\n  if currentnode == nil or t == nil  then\r\n    return res\r\n  end\r\n\r\n  local nextNode = nil\r\n  local nextType = nil\r\n  if t == \"id\" and (type(currentnode) == \"number\" or type(currentnode) == \"string\") then\r\n    local treeNode = redis.call(\"HGET\", treeKey, currentnode)\r\n    if treeNode then\r\n      local node = cjson.decode(treeNode)\r\n      table.insert(res, treeNode)\r\n      if node and node.childIds then\r\n        nextNode = node.childIds\r\n        nextType = \"childIds\"\r\n      end\r\n    end\r\n  elseif t == \"childIds\" then\r\n    nextNode = {}\r\n    nextType = \"childIds\"\r\n    local treeNode  = nil\r\n    local node = nil\r\n    local cnt = 0\r\n    for _, val in ipairs(currentnode) do\r\n      treeNode = redis.call(\"HGET\", treeKey, tostring(val))\r\n      if treeNode then\r\n        node = cjson.decode(treeNode)\r\n        table.insert(res, treeNode)\r\n        if node and node.childIds then\r\n          for _, val2 in ipairs(node.childIds) do\r\n            table.insert(nextNode, val2)\r\n            cnt = cnt + 1\r\n          end\r\n        end\r\n      end\r\n    end\r\n    if cnt == 0 then\r\n      nextNode = nil\r\n      nextType = nil\r\n    end\r\n  end\r\n  return getTreeChild(nextNode, nextType, res)\r\nend\r\n\r\n\r\nif treeKey and fnodeId then\r\n  return getTreeChild(fnodeId, \"id\", {})\r\nend\r\n\r\nreturn {}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f42688789037-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f42688789037-54\">54</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-1\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KEYS</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-2\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">fnodeId</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ARGV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-4\"><span class=\"crayon-e\">local </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil  </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">res</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-7\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-8\"> </div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-10\"><span class=\"crayon-e\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-11\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-15\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-18\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-19\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">elseif</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-25\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-26\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ipairs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-28\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tostring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-29\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-33\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val2 </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ipairs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-36\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-38\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-41\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-42\"><span class=\"crayon-e\">      </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-43\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-44\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-45\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-46\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-47\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-48\"> </div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-49\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeKey </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fnodeId </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-50\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fnodeId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-51\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-52\"> </div><div class=\"crayon-line\" id=\"crayon-59b7a21648f42688789037-53\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f42688789037-54\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0075 seconds] -->\r\n<p></p>\n<h4>获取所有子节点数目 get-tree-childs-cnt.lua</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b7a21648f47550464855\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocal treeKey = KEYS[1]\r\nlocal fnodeId  = ARGV[1]\r\n\r\nlocal function getTreeChildCnt(currentnode, t, res)\r\n  if currentnode == nil or t == nil  then\r\n    return res\r\n  end\r\n\r\n  local nextNode = nil\r\n  local nextType = nil\r\n  if t == \"id\" and (type(currentnode) == \"number\" or type(currentnode) == \"string\") then\r\n    local treeNode = redis.call(\"HGET\", treeKey, currentnode)\r\n    if treeNode then\r\n      local node = cjson.decode(treeNode)\r\n      res = res + 1\r\n      if node and node.childIds then\r\n        nextNode = node.childIds\r\n        nextType = \"childIds\"\r\n      end\r\n    end\r\n  elseif t == \"childIds\" then\r\n    nextNode = {}\r\n    nextType = \"childIds\"\r\n    local treeNode  = nil\r\n    local cnt = 0\r\n    for _, val in ipairs(currentnode) do\r\n      treeNode = redis.call(\"HGET\", treeKey, tostring(val))\r\n      if treeNode then\r\n        local node = cjson.decode(treeNode)\r\n        res = res + 1\r\n        if node and node.childIds then\r\n          for _, val2 in ipairs(node.childIds) do\r\n            table.insert(nextNode, val2)\r\n            cnt = cnt + 1\r\n          end\r\n        end\r\n      end\r\n    end\r\n    if cnt == 0 then\r\n      nextNode = nil\r\n      nextType = nil\r\n    end\r\n  end\r\n  return getTreeChildCnt(nextNode, nextType, res)\r\nend\r\n\r\n\r\nif treeKey and fnodeId then\r\n  return getTreeChildCnt(fnodeId, \"id\", 0)\r\nend\r\n\r\nreturn 0\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f47550464855-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f47550464855-53\">53</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-1\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KEYS</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-2\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">fnodeId</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ARGV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-4\"><span class=\"crayon-e\">local </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChildCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil  </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">res</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-7\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-8\"> </div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-10\"><span class=\"crayon-e\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-11\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-15\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-18\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-19\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">elseif</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-25\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ipairs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-27\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tostring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-28\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-32\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val2 </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ipairs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-35\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-37\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-40\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-41\"><span class=\"crayon-e\">      </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-42\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-43\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-44\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChildCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-45\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-46\"> </div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-47\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-48\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeKey </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fnodeId </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-49\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChildCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fnodeId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-50\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f47550464855-52\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f47550464855-53\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0075 seconds] -->\r\n<p></p>\n<h4>获取所有子节点数目 get-tree-parent.lua</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b7a21648f4b186051781\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocal treeKey = KEYS[1]\r\nlocal nodeId  = ARGV[1]\r\n\r\nlocal function getTreeParent(treeKey, res, nodeId)\r\n  if nodeId == nil or not (type(nodeId) == \"number\" or type(nodeId) == \"string\") then\r\n    return res\r\n  end\r\n  local treeNode = redis.call(\"HGET\", treeKey, nodeId)\r\n  local nextNodeId = nil\r\n  if treeNode then\r\n    local node = cjson.decode(treeNode)\r\n    table.insert(res, treeNode)\r\n    if node then\r\n      nextNodeId = node.parentId\r\n    end\r\n  end\r\n  return getTreeParent(treeKey, res, nextNodeId)\r\nend\r\n\r\n\r\nif treeKey and nodeId then\r\n  return getTreeParent(treeKey, {}, nodeId)\r\nend\r\n\r\nreturn {}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f4b186051781-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f4b186051781-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f4b186051781-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f4b186051781-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f4b186051781-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f4b186051781-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f4b186051781-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f4b186051781-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f4b186051781-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f4b186051781-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f4b186051781-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f4b186051781-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f4b186051781-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f4b186051781-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f4b186051781-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f4b186051781-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f4b186051781-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f4b186051781-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f4b186051781-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f4b186051781-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f4b186051781-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f4b186051781-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f4b186051781-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f4b186051781-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f4b186051781-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f4b186051781-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b7a21648f4b186051781-1\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KEYS</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f4b186051781-2\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ARGV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f4b186051781-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f4b186051781-4\"><span class=\"crayon-e\">local </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f4b186051781-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f4b186051781-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">res</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f4b186051781-7\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f4b186051781-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f4b186051781-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f4b186051781-10\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f4b186051781-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f4b186051781-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f4b186051781-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f4b186051781-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parentId</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f4b186051781-15\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f4b186051781-16\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f4b186051781-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f4b186051781-18\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f4b186051781-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f4b186051781-20\"> </div><div class=\"crayon-line\" id=\"crayon-59b7a21648f4b186051781-21\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeKey </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nodeId </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f4b186051781-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f4b186051781-23\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f4b186051781-24\"> </div><div class=\"crayon-line\" id=\"crayon-59b7a21648f4b186051781-25\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f4b186051781-26\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p></p>\n<h4>获取所有子节点数目 get-tree-parent-cnt.lua</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b7a21648f51278123469\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocal treeKey = KEYS[1]\r\nlocal nodeId  = ARGV[1]\r\n\r\nlocal function getTreeParentCnt(treeKey, nodeId, res)\r\n  if nodeId == nil or not (type(nodeId) == \"number\" or type(nodeId) == \"string\") then\r\n    return res\r\n  end\r\n  local treeNode = redis.call(\"HGET\", treeKey, nodeId)\r\n  local nextNodeId = nil\r\n  if treeNode then\r\n    local node = cjson.decode(treeNode)\r\n    res = res + 1\r\n    if node then\r\n      nextNodeId = node.parentId\r\n    end\r\n  end\r\n  return getTreeParentCnt(treeKey, nextNodeId, res)\r\nend\r\n\r\n\r\nif treeKey and nodeId then\r\n  return getTreeParentCnt(treeKey, nodeId, 0)\r\nend\r\n\r\nreturn 0\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f51278123469-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f51278123469-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f51278123469-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f51278123469-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f51278123469-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f51278123469-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f51278123469-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f51278123469-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f51278123469-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f51278123469-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f51278123469-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f51278123469-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f51278123469-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f51278123469-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f51278123469-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f51278123469-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f51278123469-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f51278123469-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f51278123469-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f51278123469-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f51278123469-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f51278123469-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f51278123469-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f51278123469-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b7a21648f51278123469-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b7a21648f51278123469-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b7a21648f51278123469-1\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KEYS</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f51278123469-2\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ARGV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f51278123469-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f51278123469-4\"><span class=\"crayon-e\">local </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParentCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f51278123469-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f51278123469-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">res</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f51278123469-7\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f51278123469-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f51278123469-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f51278123469-10\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f51278123469-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f51278123469-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f51278123469-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f51278123469-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parentId</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f51278123469-15\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f51278123469-16\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f51278123469-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParentCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f51278123469-18\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f51278123469-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f51278123469-20\"> </div><div class=\"crayon-line\" id=\"crayon-59b7a21648f51278123469-21\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeKey </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nodeId </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f51278123469-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParentCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b7a21648f51278123469-23\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f51278123469-24\"> </div><div class=\"crayon-line\" id=\"crayon-59b7a21648f51278123469-25\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b7a21648f51278123469-26\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p>以上代码因为使用了“尾调用”，所以变得相对比较复杂</p>\n<h3>总结</h3>\n<p>此方案相对比较灵活，能支持相对比较大量的数据。</p>\n<p>缺点：过于依赖Redis。数据同步会麻烦些，好在操作不是很复杂。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112358\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112358votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112358\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/c766feed221138f7946130756cddfc7e86e388b4.jpg"}
{"url_object_id": "02055325a5e02932f7792960f1ebb630", "title": ["树形结构数据存储方案（四）：左右值编码"], "create_data": "2017/09/02", "url": "http://blog.jobbole.com/112323/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/03/database-logo.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.biaodianfu.com/the-nested-set-model.html\">标点符</a>   </div><p>在基于数据库的一般应用中，查询的需求总要大于删除和修改。为了避免对于树形结构查询时的“<a href=\"http://blog.jobbole.com/112309/\">递归</a>”过程，基于Tree的前序遍历设计一种全新的无递归查询、无限分组的左右值编码方案，来保存该树的数据。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/1e2e2b27dafbace20975589812804590.jpg\" alt=\"Nested-Set\" width=\"383\" height=\"216\"></p>\n<p>第一次看见这种表结构，相信大部分人都不清楚左值（Lft）和右值（Rgt）是如何计算出来的，而且这种表设计似乎并没有保存父子节点的继承关系。但当你用手指指着表中的数字从1数到18，你应该会发现点什么吧。对，你手指移动的顺序就是对这棵树进行前序遍历的顺序，如下图所示。当我们从根节点Food左侧开始，标记为1，并沿前序遍历的方向，依次在遍历的路径上标注数字，最后我们回到了根节点Food，并在右边写上了18。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a3d57449cc2b5c29854f79f0be69725c.jpg\" alt=\"lft-rgt\" width=\"411\" height=\"166\"></p>\n<p>依据此设计，我们可以推断出所有左值大于2，并且右值小于11的节点都是Fruit的后续节点，整棵树的结构通过左值和右值存储了下来。然而，这还不够，我们的目的是能够对树进行CRUD操作，即需要构造出与之配套的相关算法。按照深度优先，由左到右的原则遍历整个树，从1开始给每个节点标注上left值和right值，并将这两个值存入对应的name之中。</p>\n<p><strong>如何查询？</strong></p>\n<p>1、获取某个节点下的所有子孙节点，以Fruit为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaab9c409759755\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM Tree WHERE Lft &gt; 2 AND Lft &lt; 11 ORDER BY Lft ASC</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaab9c409759755-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaab9c409759755-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ORDER </span><span class=\"crayon-e\">BY </span><span class=\"crayon-e\">Lft </span><span class=\"crayon-v\">ASC</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>2、获取子孙节点总数</p>\n<p>子孙总数 = (右值–左值–1)/2，以Fruit为例，其子孙总数为：(11–2–1)/2 = 4</p>\n<p>3、 获取节点在树中所处的层数，以Fruit为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaaba6954247309\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT COUNT(*) FROM Tree WHERE Lft &lt;= 2 AND Rgt &gt;=11</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaaba6954247309-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaaba6954247309-1\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">COUNT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-cn\">11</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>4、 获取当前节点所在路径，以Fruit为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaabaa557316571\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM Tree WHERE Lft &lt;= 2 AND Rgt &gt;=11 ORDER BY Lft ASC</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabaa557316571-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaabaa557316571-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ORDER </span><span class=\"crayon-e\">BY </span><span class=\"crayon-e\">Lft </span><span class=\"crayon-v\">ASC</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>在日常的处理中我们经常还会遇到的需要获取某一个节点的直属上级、同级、直属下级。为了更好的描述层级关系，我们可以为Tree建立一个视图，添加一个层次列，该列数值可以编写一个自定义函数来计算：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaabad832634219\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE FUNCTION `CountLayer`(`_node_id` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE _result INT;\r\n\tDECLARE _lft INT;\r\n\tDECLARE _rgt INT;\r\n\tIF EXISTS(SELECT Node_id FROM Tree WHERE Node_id = _node_id)\r\n\tTHEN\r\n\t\tSELECT Lft,Rgt FROM Tree WHERE Node_id = _node_id INTO _lft,_rgt;\r\n\t\tSET _result = (SELECT COUNT(1) FROM Tree WHERE Lft &lt;= _lft AND Rgt &gt;= _rgt);\t\r\n\t\tRETURN _result;\r\n\tELSE\r\n\t\tRETURN 0;\r\n\tEND IF;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabad832634219-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabad832634219-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabad832634219-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabad832634219-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabad832634219-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabad832634219-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabad832634219-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabad832634219-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabad832634219-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabad832634219-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabad832634219-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabad832634219-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabad832634219-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabad832634219-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabad832634219-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaabad832634219-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">CountLayer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">_node_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabad832634219-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabad832634219-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabad832634219-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_result </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabad832634219-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_lft </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabad832634219-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_rgt </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabad832634219-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EXISTS</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">Node_id </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_node_id</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabad832634219-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabad832634219-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">Rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_node_id </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-v\">_lft</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">_rgt</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabad832634219-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">_result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">COUNT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_lft </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_rgt</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabad832634219-11\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabad832634219-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">ELSE</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabad832634219-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabad832634219-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabad832634219-15\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>在添加完函数以后，我们创建一个a视图，添加新的层次列：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaabb0665548525\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE VIEW `NewView`AS \r\nSELECT Node_id, Name, Lft, Rgt, CountLayer(Node_id) AS Layer FROM Tree ORDER BY Lft ;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabb0665548525-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabb0665548525-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaabb0665548525-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">VIEW</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">NewView</span><span class=\"crayon-sy\">`</span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabb0665548525-2\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">Node_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CountLayer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Node_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Layer </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">ORDER </span><span class=\"crayon-e\">BY </span><span class=\"crayon-i\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>5、 获取当前节点父节点,以Fruit为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaabb4020043830\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM treeview WHERE Lft &lt;= 2 AND Rgt &gt;=11 AND Layer=1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabb4020043830-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaabb4020043830-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">treeview </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Layer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>6、 获取所有直属子节点，以Fruit为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaabb7463022797\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM treeview WHERE Lft BETWEEN 2 AND 11 AND Layer=3</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabb7463022797-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaabb7463022797-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">treeview </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-e\">Lft </span><span class=\"crayon-i\">BETWEEN</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Layer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>7、 获取所有兄弟节点，以Fruit为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaabba798828235\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM treeview WHERE Rgt &gt; 11 AND Rgt &lt; (SELECT Rgt FROM treeview WHERE Lft &lt;= 2 AND Rgt &gt;=11 AND Layer=1) AND Layer=2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabba798828235-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaabba798828235-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">treeview </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">Rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">treeview </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Layer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Layer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>8、 返回所有叶子节点</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaabbd137093326\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM Tree WHERE Rgt = Lft + 1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabbd137093326-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaabbd137093326-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><strong>如何创建树？如何新增数据？</strong></p>\n<p>上面已经介绍了如何检索结果，那么如何才能增加新的节点呢？Nested set 最重要是一定要有一个根节点作为所有节点的起点，而且通常这个节点是不被使用的。为了便于控制查询级别，在建表的时候建议添加parent_id配合之联结列表方式一起使用。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaabc0487649909\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE IF NOT EXISTS `Tree` (\r\n  `node_id` int(11) NOT NULL AUTO_INCREMENT,\r\n  `parent_id` int(10) UNSIGNED NOT NULL DEFAULT '0',\r\n  `name` varchar(255) NOT NULL,\r\n  `lft` int(11) NOT NULL DEFAULT '0',\r\n  `rgt` int(11) NOT NULL DEFAULT '0',\r\n  PRIMARY KEY (`node_id`),\r\n  KEY `idx_left_right` (`lft`,`rgt`)\r\n) DEFAULT CHARSET=utf8;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabc0487649909-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabc0487649909-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabc0487649909-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabc0487649909-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabc0487649909-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabc0487649909-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabc0487649909-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabc0487649909-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabc0487649909-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaabc0487649909-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">EXISTS</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">Tree</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabc0487649909-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabc0487649909-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">UNSIGNED</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabc0487649909-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabc0487649909-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">lft</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabc0487649909-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">rgt</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabc0487649909-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabc0487649909-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">idx_left_right</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">lft</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">rgt</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabc0487649909-9\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">utf8</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaabc4861466323\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nINSERT INTO `Tree` (parent_id,name,lft,rgt) VALUES ( 0,'Food',1,2)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabc4861466323-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaabc4861466323-1\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-i\">INTO</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">Tree</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">lft</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">rgt</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'Food'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>添加子节点（子节点起始处），以在Food下添加子节点Fruit为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaabc7803612400\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nLOCK TABLE Tree WRITE;\r\nSELECT @parent_id := node_id, @myLeft := lft FROM Tree WHERE name = 'Food';\r\nUPDATE Tree SET rgt = rgt + 2 WHERE rgt &gt; @myLeft;\r\nUPDATE Tree SET lft = lft + 2 WHERE lft &gt; @myLeft;\r\nINSERT INTO Tree(parent_id, name, lft, rgt) VALUES(@parent_id, 'Fruit', @myLeft + 1, @myLeft + 2);\r\nUNLOCK TABLES;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabc7803612400-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabc7803612400-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabc7803612400-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabc7803612400-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabc7803612400-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabc7803612400-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaabc7803612400-1\"><span class=\"crayon-e\">LOCK </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-v\">WRITE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabc7803612400-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lft </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Food'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabc7803612400-3\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabc7803612400-4\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabc7803612400-5\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">Tree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabc7803612400-6\"><span class=\"crayon-e\">UNLOCK </span><span class=\"crayon-v\">TABLES</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>如需在末尾追加就需要以下方式进行（以在Red下添加Apple为例）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaabca583603058\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nLOCK TABLE Tree WRITE;\r\nSELECT @parent_id := node_id , @myRight := rgt FROM Tree WHERE name = 'Red';\r\nUPDATE Tree SET rgt = rgt + 2 WHERE rgt &gt;= @myRight;\r\nUPDATE Tree SET lft = lft + 2 WHERE lft &gt; @myRight;\r\nINSERT INTO Tree(parent_id, name, lft, rgt) VALUES(@parent_id, 'Apple', @myRight, @myRight + 1);\r\nUNLOCK TABLES;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabca583603058-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabca583603058-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabca583603058-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabca583603058-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabca583603058-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabca583603058-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaabca583603058-1\"><span class=\"crayon-e\">LOCK </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-v\">WRITE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabca583603058-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">_</span>id<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Red'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabca583603058-3\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabca583603058-4\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabca583603058-5\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">Tree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Apple'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabca583603058-6\"><span class=\"crayon-e\">UNLOCK </span><span class=\"crayon-v\">TABLES</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>在节点A后面添加同级节点（以在Yellow后面添加Green为例）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaabcd312201085\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nLOCK TABLE Tree WRITE;\r\nSELECT @parent_id := parent_id , @myRight := rgt FROM Tree WHERE name = 'Yellow';\r\nUPDATE Tree SET rgt = rgt + 2 WHERE rgt &gt; @myRight;\r\nUPDATE Tree SET lft = lft + 2 WHERE lft &gt; @myRight;\r\nINSERT INTO Tree(parent_id, name, lft, rgt) VALUES(@parent_id, 'Green', @myRight+1, @myRight+2);\r\nUNLOCK TABLES;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabcd312201085-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabcd312201085-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabcd312201085-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabcd312201085-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabcd312201085-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabcd312201085-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaabcd312201085-1\"><span class=\"crayon-e\">LOCK </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-v\">WRITE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabcd312201085-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parent</span><span class=\"crayon-sy\">_</span>id<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Yellow'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabcd312201085-3\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabcd312201085-4\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabcd312201085-5\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">Tree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Green'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabcd312201085-6\"><span class=\"crayon-e\">UNLOCK </span><span class=\"crayon-v\">TABLES</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>以上讨论的添加节点指的都是添加末端节点，即插入的这个节点不是当前已存在节点的父节点。如果需要插入非末端节点要怎么办呢？</p>\n<p>这个过程可以将流程分为2步，首先新增节点，接下里再将需要的节点移到新增的节点下级。节点移动方法(以将Apple移到Yellow中为例)：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaabd1899177948\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nLOCK TABLE Tree WRITE;\r\nSELECT @nodeId := node_id , @myLeft := lft , @myRight := rgt FROM Tree WHERE name = 'Apple';\r\nUPDATE Tree SET lft = lft - (@myRight - @myLeft) - 1 WHERE lft &gt; @myRight;\r\nUPDATE Tree SET rgt = rgt - (@myRight - @myLeft) - 1 WHERE rgt &gt; @myRight;\r\nSELECT @parent_id := node_id , &lt;a href=\"http://www.jobbole.com/members/wx1863158684\"&gt;@Left&lt;/a&gt; := lft , &lt;a href=\"http://www.jobbole.com/members/wx3757768826\"&gt;@Right&lt;/a&gt; := rgt FROM Tree WHERE name = 'Yellow';\r\nUPDATE Tree SET lft = lft + (@myRight - @myLeft) + 1 WHERE lft &gt; @Left;\r\nUPDATE Tree SET rgt = rgt + (@myRight - @myLeft) + 1 WHERE lft &gt; @Left;\r\nUPDATE Tree SET parent_id = @parent_id WHERE name = node_id = @nodeId;\r\nUPDATE Tree SET lft = &lt;a href=\"http://www.jobbole.com/members/wx1863158684\"&gt;@Left&lt;/a&gt; + lft - @myLeft + 1, rgt = &lt;a href=\"http://www.jobbole.com/members/wx1863158684\"&gt;@Left&lt;/a&gt; + lft - @myLeft + 1  + (@myRight - @myLeft) WHERE lft &gt;= @myLeft AND rgt &lt;= @myRight;\r\nUNLOCK TABLES;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabd1899177948-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabd1899177948-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabd1899177948-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabd1899177948-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabd1899177948-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabd1899177948-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabd1899177948-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabd1899177948-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabd1899177948-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabd1899177948-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaabd1899177948-1\"><span class=\"crayon-e\">LOCK </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-v\">WRITE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabd1899177948-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">_</span>id<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Apple'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabd1899177948-3\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabd1899177948-4\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabd1899177948-5\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">_</span>id<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/wx1863158684\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Left</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/wx3757768826\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Right</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Yellow'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabd1899177948-6\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Left</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabd1899177948-7\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Left</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabd1899177948-8\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">parent_id </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabd1899177948-9\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/wx1863158684\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Left</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/wx1863158684\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Left</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">myLeft </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabd1899177948-10\"><span class=\"crayon-e\">UNLOCK </span><span class=\"crayon-v\">TABLES</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0089 seconds] -->\r\n<p><strong>删除节点（包含子节点）</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaabd4769494653\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nLOCK TABLE Tree WRITE;\r\nSELECT @myLeft := lft , @myRight := rgt FROM Tree WHERE name = 'Apple';\r\nDELETE Tree WHERE lft &gt;= @myLeft AND rgt &lt;= @myRight;\r\nUPDATE Tree SET lft = lft - (@myRight - @myLeft) - 1 WHERE lft &gt; @myRight;\r\nUPDATE Tree SET rgt = rgt - (@myRight - @myLeft) - 1 WHERE rgt &gt; @myRight;\r\nUNLOCK TABLES;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabd4769494653-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabd4769494653-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabd4769494653-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabd4769494653-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabd4769494653-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabd4769494653-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaabd4769494653-1\"><span class=\"crayon-e\">LOCK </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-v\">WRITE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabd4769494653-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Apple'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabd4769494653-3\"><span class=\"crayon-e\">DELETE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">myLeft </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabd4769494653-4\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabd4769494653-5\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabd4769494653-6\"><span class=\"crayon-e\">UNLOCK </span><span class=\"crayon-v\">TABLES</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>如果需要只删除该节点，子节点自动上移一级如何处理？</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b75efcaabd8301278356\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nLOCK TABLE Tree WRITE;\r\nSELECT @parent_id := parent_id , @node_id :=node_id , @myLeft := lft , @myRight := rgt FROM Tree WHERE name = 'Red';\r\nUPDATE Tree SET parent_id = @parent_id WHERE  parent_id = @node_id\r\nDELETE Tree WHERE lft = @myLeft;\r\nUPDATE Tree SET lft = lft - 1,rgt = rgt-1 Where lft &gt; @myLeft AND @rgt &lt; @myRight\r\nUPDATE Tree SET lft = lft - 2,rgt = rgt-2 Where lft &gt; @rgt &gt; @myRight\r\nUNLOCK TABLES;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabd8301278356-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabd8301278356-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabd8301278356-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabd8301278356-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabd8301278356-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b75efcaabd8301278356-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b75efcaabd8301278356-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b75efcaabd8301278356-1\"><span class=\"crayon-e\">LOCK </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-v\">WRITE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabd8301278356-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parent</span><span class=\"crayon-sy\">_</span>id<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">_</span>id<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myRight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rgt </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Red'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabd8301278356-3\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">parent_id </span><span class=\"crayon-e\">WHERE  </span><span class=\"crayon-v\">parent_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">node_id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabd8301278356-4\"><span class=\"crayon-e\">DELETE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">myLeft</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabd8301278356-5\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Where </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">myLeft </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">myRight</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b75efcaabd8301278356-6\"><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rgt</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Where </span><span class=\"crayon-v\">lft</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">rgt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">myRight</span></div><div class=\"crayon-line\" id=\"crayon-59b75efcaabd8301278356-7\"><span class=\"crayon-e\">UNLOCK </span><span class=\"crayon-v\">TABLES</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>以上为Nested Set的CURD操作，具体在使用时建议结合事务和存储过程一起使用。本方案的优点时查询非常的方便，缺点就是每次插入删除数据涉及到的更新内容太多，如果树非常大，插入一条数据可能花很长的时间。</p>\n<p>参考链接：</p>\n<ul>\n<li><a href=\"https://www.sitepoint.com/hierarchical-data-database/\">https://www.sitepoint.com/hierarchical-data-database/</a></li>\n<li><a href=\"https://packagist.org/search/?q=Nested+Set\">https://packagist.org/search/?q=Nested+Set</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112323\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112323votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112323\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/f42d1238aa0f889b8988c70dd7481c7a4bd3b456.jpg"}
{"url_object_id": "b225ce0ceb9f61bf1bed8b5e01b2f2f2", "title": ["编程趋势：21 个热门和 21 个要降温的"], "create_data": "2017/09/02", "url": "http://blog.jobbole.com/112238/", "front_image_url": ["http://wx4.sinaimg.cn/large/7cc829d3gy1fj44vfij7hj20g40c3wfr.jpg"], "praise_nums": "4", "comment_nums": 1, "fav_nums": 7, "tags": "IT技术,编程,职业", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/wx232824506\">努力学python</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.infoworld.com/article/3188464/application-development/21-hot-programming-trends-and-21-going-cold.html\">Peter Wayner</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>InfoWorld 作者总结的 21 个热门编程趋势和 21 个要变冷的趋势，包含 Web 开发，移动开发，大数据，教育等方面。</p>\n<hr>\n<p>热门还是冷门？无论 Web 开发、主板开发还是培训教育，都需要了解应用开发过程中哪些技术正在兴起，哪些技术要过时了。</p>\n<p>程序员们喜欢嘲笑时尚界的潮流说变就变，像风一样捉摸不定。裙子时而短时而长，流行色频繁更替，领带越来越窄，越来越薄。但是在技术的世界中，严谨、科学、数学和精准原则却一直流行。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fj44vfij7hj20g40c3wfr.jpg\"></p>\n<p><strong>这并不是说编程没有趋势。区别在于编程的潮流由更高的效率、更多的自定义和更便于使用来驱动。具备这些特点的新技术取代旧技术，这是一种精益求精的过程，而不是朝令夕改的奇思妙想。</strong></p>\n<p>下面是现代程序世界的热门技术和冷门技术列表。可能有人会不同的意见，也可能会有遗漏，而这正是编程的迷人之处：快速变化、激烈辩论、峰回路转。</p>\n<h3>热门：预处理器</h3>\n<h3>变冷：全语言堆栈</h3>\n<p>不久之前，人们创造一门新的编程语言需要进行许多工作（从源代码到机器代码转换过程的所有工作）。 然后一些人指出他们可以推翻前面的做法。 现在程序员有了想法以后只需要编写一个预处理器，预处理器可以使用丰富的库和 API 将新代码转换成旧版本的代码。</p>\n<p>Python 、JavaScript 这类的脚本语言曾经仅限于小项目，但现在许多重要的工作都开始使用这些语言。不喜欢 JavaScript 的程序员还开发了 CoffeeScript (一种可以再次编码的预处理器)，以避免使用繁琐的标点符号。它有几十种以不同方式预处理语法的方法。</p>\n<p>那些喜欢动态类型的程序员<strong>创建了 Groovy</strong>，Groovy 是 Java 省略掉过多标点符号的简化版本。现在好像有<strong>几十种语言</strong>（如 Scala 或 Clojure）在 JVM 上运行，但只有一个 JVM 。我们可以在 .Net 虚拟机上运行多种语言，为什么还要重新发明轮子？</p>\n<h3>热门：Docker</h3>\n<h3>变冷：Hypervisors（虚拟机）</h3>\n<p>这并不完全正确，hypervisors 也有它们的用武之地，而且许多 Docker容器运行在以 hypevisors 为基础的操作系统中。然而，Docker容器与虚拟机映像相比实在太小了，这使得它们更容易使用和部署。</p>\n<p>当开发人员可以使用 Docker容器时，它们更愿意使用 Docker容器，这要归功于它可以在部署过程中轻松操作。 像 Joyent 这样的聪明公司正在开发可以占用更多资源的技术，以便容器可以在“裸机”上运行。</p>\n<p>在数字商业时代需要足够敏捷来抓住新机会，同时还要有效地维护传统的内部部署系统。</p>\n<h3>热门：JavaScript MV* 框架</h3>\n<h3>变冷：JavaScript文件</h3>\n<p>很久以前，每个人都学习如何使用 JavaScript 弹出警告窗口或如何检查表格中的电子邮件地址是否包含 @符号。 现在，HTML AJAX 应用程序已经如此成熟，以至于很少有人会再从头开始编写这些功能。 采用精心制作的框架，然后编写一些胶水代码来实现业务逻辑要简单得多。</p>\n<p>现在有许多框架可以用来处理 app、网页等的事件和内容，这些<strong>框架包括</strong> Kendo, Sencha, jQuery Mobile, AngularJS, Ember, Backbone, Meteor JS 等。</p>\n<p>这些只是网络应用程序的框架。 还有一些框架旨在为智能手机/平板电脑提供跨平台开发技术。 <strong>NativeScript，PhoneGap</strong> 和 <strong>Ext JS</strong> 都是使用 HTML5 创建 app 的技术。</p>\n<h3>热门：CSS 框架</h3>\n<h3>变冷：通用层叠样式表</h3>\n<p>曾几何时，向网页添加一点格式意味着打开 CSS文件然后写入类似 font-style:italic 这样的命令，然后保存文件，就可以在一上午的紧张忙碌之后去吃午饭了。现在网页如此复杂以至于很难使用如此简单的命令完成一个文件。调整一个颜色可能会导致一切都无法正常运行。这就像他们评价阴谋家和生态学家一样：一切都是互相联系的。</p>\n<p>这就是 SASS 和 Compass 等 CSS框架的用武之地。 它们通过提供编程结构（如实变量，嵌套块和混合）来鼓励规范，可靠的编码。 这在编程层面中可能听起来并没有多新颖，但对于设计层来说这是一个巨大的飞跃。</p>\n<h3>热门：视频标签</h3>\n<h3>变冷：静态标签</h3>\n<p>曾经有段时间， 视频是指 YouTube 或 Vimeo 上观看的视频。它是一种存在于专有页面上的单独内容。然而随着越来越多的网站使用音频来构建区块，其过程与使用 静态 GIFs 或者 JPGs 进行构建区块一样，这种情况正在发生改变。突然之间，屏幕变得生动起来。</p>\n<p>设计师发现，现代视频标签只是另一个矩形，尽管矩形通常需要程序员使用更多的 JavaScript 代码来控制。 我们只是开始明白，在客厅沙发前面的盒子可以不再是我们获取视频的主要来源，而可以仅仅是一个装饰。</p>\n<h3>热门：类大数据(不使用 Hadoop 分析)</h3>\n<h3>变冷：大数据（使用 Hadoop）</h3>\n<p>每个人都希望自己看起来像是圈子里的大人物，如果他们在圈子里有没影响力，那么他们会寻找一个适合他们脱颖而出的圈子。 所以，当“大数据”开始在高管之间开始流行时，这些高管要求最大，最强大的<strong>大数据系统</strong>，就像购买游艇或摩天大楼一样。</p>\n<p>有趣的是，许多问题没有大到要用高级大数据解决方案来解决。当然，像谷歌或雅虎这种跟踪我们浏览的所有网页的公司是需要大数据解决方案的，他们的数据文件很大需要用 petabytes 或 yottabytes 来计量。但大多数公司的数据都可以轻松地用一个 PC机内存进行处理。我是用一台在 16GB 内存的 PC 机来写这篇文章的，这台 PC 足够处理十亿件几个字节的事件。在大多数算法中，数据不需要读入内存，因为直接从 SSD 获取就可以了。</p>\n<p>可能存在需要 Hadoop云几十台机器并行运算来实现快速响应的需求，但是许多需求在单台机器上处理即可，这样还可以避免产生麻烦的协调或通信问题。</p>\n<h3>热门：Spark</h3>\n<h3>变冷：Hadoop</h3>\n<p>可能并不是 Hadoop 不流行了，而是 Spark 太热门了，这使得 Hadoop 模型看起来有些老。Spark 借鉴了Hadoop 从大量数据中提取语义的做法的最佳思路，并通过一些改进使代码运行的更快。Spark 最大的优势在于它将数据保存在快速内存中而不是需要所有内容都写入分布式文件系统。</p>\n<p>当然，许多人正在通过使用 Spark 的处理速度对存储在 Hadoop 分布式文件系统的数据进行处理，因此，Spark 和 Hadoop 更像是合作伙伴而不是竞争对手。</p>\n<h3>热门：人工智能/机器学习</h3>\n<h3>变冷：大数据</h3>\n<p>没有人知道 “人工智能”的真正含义，它们对营销人员很有利，特别是在“大数据”广泛应用的今天。他们从人工智能中提取术语并且升级数字处理算法的复杂度来处理我们的 log 文件和点击流。通过从具有 50年历史的 AI研究中借鉴更复杂算法，我们比以往任何时候都更有可能从噪音中发现信号。从机器学习框架到认知计算的工具，再到 IBM 的沃森，总能解决你的问题。它们每个都提供自己机器的智能水平，我们可以使用它们进行更多的数据分析和取证。</p>\n<h3>热门：机器人</h3>\n<h3>变冷：虚拟现实</h3>\n<p>就在几分钟之前，我们还都将梦想寄托在虚拟现实中，虚拟现实可以通过一些视频卡在我们视网膜上绘制图形。这种情况仍然可能发生，但与此同时，机器人的世界也将迅速发展。每个学校都有一个机器人团队，家庭的每个角落充斥着机器人，机器人吸尘器已经是旧新闻了，无人机正在自由翱翔。</p>\n<p>这意味着程序要开始考虑如何写代码来控制新机器。目前，这意味着为 Raspberry Pi 这样的轻量级控制器写脚本，但是随着库文件发展的越来越复杂，必然会发生变化。比如，许多机器人专家喜欢研究 C语言实现的机器视觉平台OpenCV 中的代码。这意味着需要考虑新的规则，新的类库，新的协议，和许多其他新的主题。</p>\n<h3>热门：单页Web应用</h3>\n<h3>变冷：网站</h3>\n<p>还记得 URLs 指向满是静态文本和图片的网页的时代吗？把所有信息都放在被称为网站的单独网页中是多么地简单和古雅。设计团队在网站地图上花费几个小时的时间来使网站更易于导航。</p>\n<p>新的 web 应用通过数据库填充内容。当 web应用需要信息时，它从数据库获取信息并将其放入本地模板中。我们不需要使用构建 web页面的所有 web附加组件来标记数据。数据层与展示和格式化层完全分离。移动计算的兴起是另一个原因在于：单个响应式页面工作机制与app类似，可以减少从鱼龙混杂的应用商店中寻找想要的内容所浪费的时间。</p>\n<h3>热门：移动Web app</h3>\n<h3>变冷：原生移动 App</h3>\n<p>假如你有一个移动内容的好主意，那么需要为 IOS、Android、Windows 8甚至黑莓OS 或者其他的系统开发不同的版本。每个版本都需要一个独立的团队使用不同的编程语言实现。然后每个平台应用商店都需要使用自己的版本，才能把 app 分发给用户。</p>\n<p>或者，我们可以创建一个 HTML 应用，然后把它放到各个平台都可以运行的网站上。如果有变化，也不需要到应用商店去请求快速审核错误修复。 现在 HTML层速度越来越快，并且运行在速度越来越快的芯片上，以便于它可以在更复杂和互动性更高的应用程序上更好地与本地应用程序竞争。</p>\n<h3>热门：Android</h3>\n<h3>变冷：iOS</h3>\n<p>是不是几年前苹果专卖店门前还要排蜿蜒的长队？ 现在时代变了。 虽然 iPhone 和 iPad 还拥有大量热爱它们丰富而复杂的界面的铁杆粉丝，但从原始销售数量来看，Android更具优势 。 有报道甚至说 80％ 以上的手机都是 Android系统。</p>\n<p>原因可能就在于成本。 即使 iOS设备只需要花费很少的前，Android世界充斥的大量竞争也可以将产品的价格压缩到 iOS设备的五分之一。 省钱总是很有诱惑力的。</p>\n<p>但另一方面，也可能与开源有关。每个人都可以在市场上竞争，他们也是这样做的。我们有大大小小的安卓平板，安卓相机甚至安卓冰箱。没有人需要在创新之前先请示“妈妈，我可以吗?”。如果他们有一个好点子，做就可以了。</p>\n<p>不过，Apple 也在向安卓学习。iPhone 6 有了不同尺寸的屏幕，或许机会就在眼前。</p>\n<h3>热门：GPU</h3>\n<h3>变冷：CPU</h3>\n<p>当软件非常简单，可以很好的安排一系列指令时，CPU 是计算机的王者，因为它承担了所有的工作。 现在，视频游戏充满了可以并行运行的大量图形程序，显卡可以运行这些图形。 我们很容易花费 500美元、600美元甚至更多来购买各种显卡，一些重度的游戏玩家可能拥有不止一两个显卡。 这些显卡的价格是许多基本台式机显卡价格的两倍。 游戏玩家并不是唯一吹嘘他们的 GPU 的人。 计算机科学家现在将许多并行应用程序转换到 GPU 上运行，这样速度可以提高数百倍。</p>\n<h3>热门：GitHub主页</h3>\n<h3>变冷：个人简历</h3>\n<p>当然，我们可以通过阅读包括初中棋牌俱乐部副总裁的成就清单来了解候选人。 但阅读某人的实际代码则更加丰富和具有启发性。 他们注释写的清楚吗？ 他们把很多时间浪费在把内容写到作用寥寥的类里吗？他的架构真的有扩展空间吗？ 所有这些问题都可以从他们的代码的发现答案。</p>\n<p>这就是为什么参与开源项目对找工作越来越重要。 从专有项目共享代码是很难的，但开源代码可以随处可见。</p>\n<h3>热门：租用</h3>\n<h3>变冷：购买</h3>\n<p>当亚马逊在黑色星期五卖力推销电脑和其他电子产品时，却忘记了推销他们的云服务。在不久的将来，它很可能会这么做。以前，公司设立自己的数据中心并且聘请员工来维护购买的电脑。 现在，他们租赁电脑、数据中心、工作人员、甚至按小时租用软件。 任何人都不想处理购买带来的麻烦。这一切都是好主意，至少在网站发生病毒事件（你的点击将为所有物品支付费用）之前是这样的。尽管现在只有亚马逊发现了自动提供云的方法，趋势将会趋同。</p>\n<h3>热门：复杂云</h3>\n<h3>变冷：简约云</h3>\n<p>云计算早期阶段，供应商强调一键获得正在运行的机器是多么地容易。那时，简约是王道。</p>\n<p>现在选择正确的机器并找出合适的折扣方案可能比编写代码要花费更多的时间。 我们可以获得几十种机器配置文件，大多数云提供商都提供一些老型号的电脑。 所有供应商都提供不同性能水平的机器，因此我们需要对它们进行基准测试，以确定哪种性价比最高。 少用一些 RAM 来每小时节省 12美分有意义吗？ 如果需要几个月连续运行 100台机器，那么这很重要。</p>\n<p>更复杂的情况在于，云公司还会为提前付款或批量购买提供不同的折扣方案， 我们也必须把它们考虑在内。 购买一个云成本工程的在线课程就可以了解这些内容了。</p>\n<h3>热门：数据移动专家</h3>\n<h3>变冷：备份磁带</h3>\n<p>当数据很少时，我们不需要考虑如何移动它。 我们可以将其备份到磁带或者安装 RAID硬盘。 但是现在数据如此之大，以至于我们不得不考虑我们在哪里使用它们。这变得越来越重要，因为更多的服务发生在云端的某个地方，而不是 RAID阵列所在的机架。</p>\n<p>让我们来看看亚马逊的新款 Snowmobile ，这是一个可爱的内部名称，它是用于装载可容纳 100PB 数据硬盘的移动容器。 他们还制作了一个叫做 Snowball 的小盒子，可以容纳 80TB 。 两者都将像运送货物一样运送数据，而不是采用光纤信号。 一项估计表明，通过 1Gbps 的光纤线路下载 100PB 的数据需要 28 年，而货运卡车可能会在几天内将集装箱运送到全国各地。</p>\n<p>所有这一切说明，开发人员需要开始考虑从哪里采集数据、在哪里使用数据。我们采集了比以前更多的数据，把它们移动到正确的地方也比以前也更加重要。正如 Wayne Gretzky 所说，他的成功在于提前计划并且通过分析对趋势进行预测，而不是仅仅把注意力放在正在发生的事情上。</p>\n<h3>热门：语音</h3>\n<h3>变冷：网站</h3>\n<p>网站并没有真正死亡，只是新的音频接口方兴未艾。亚马逊、谷歌和苹果都在主推用语音来解决问题来替代通过敲打电脑键盘输入内容来解决。</p>\n<p>这对于程序员来说意味着更多的工作，因为所有这些机制都有新的 API ，比如 Alexa 控制灯光的新开关。 如果您的公司想要连接这些音频接口，您最好现在就开始了解。毕竟，键盘和 URL 已经是上个世纪的发明了。</p>\n<h3>热门：Node.js</h3>\n<h3>变冷：JavaEE，Ruby on Rails</h3>\n<p>服务器领域一直在线程模式上蓬勃发展，这使得操作系统允许开发人员各种任性、低效、放纵的行为。 无论采用愚蠢的循环还是更多的程序编码，操作系统将通过线程之间的切换平衡性能。</p>\n<p>然后Node.js 与 JavaScript 回调模型出现，这些代码运行速度非常快–比任何人期望JavaScript达到的速度都要快。突然间，创建新线程的开销变得明显，Node.js 繁荣起来。 使用 node.js 时，如果程序员的表现不好会出现问题，但这在很大程度上是对他们是很有好处的。约束程序员的可用资源会促使程序员开发出更快的代码。</p>\n<p>Node.js 还得益于它可以使前后台保持一致。两者运行相同的代码，这使得开发人员更容易迁移和重用函数。 因此，Node.js 已经成为互联网上最热门的堆栈。</p>\n<h3>热门：PHP7</h3>\n<h3>变冷：旧版PHP</h3>\n<p>过去，PHP 是实现动态网页的简单方法。 我们可以通过在HTML 标签之间嵌入简单的代码来实现一些变化。为了便于 Web 开发人员使用，它是如此的基础，但速度也慢得足以让硬件程序员嘲笑。</p>\n<p>这已成为过去，WordPress 和 Facebook 这样的 PHP 爱好者通过引入即时编译器技术(该技术使 Java 成为高性能解决方案)使得PHP代码比以往任何时候都快。 现在，像 HipHop虚拟机和 PHP 7.0 这样的工具的传输速度可能达到旧版本的两倍。Node.js 和 Java，准备接招吧。</p>\n<h3>热门：即时教育</h3>\n<h3>变冷：四年全日制</h3>\n<p>计算机辅助课程不再新鲜，每个人都可以观看视频讲座，并且可以加快或者放慢视频播放速度或者要求教授重复最后一点。在线论坛也改变了以前一个人主导讨论的旧形式。</p>\n<p>在线课程的本质和技术不仅颠覆了教育产业结构，还实现了随时随地学习的灵活性。这正在改变人们的观念，人们不再需要为与他们有关或无关的大量课程而投入四年高昂的学费。在你不知道自己是否需要在编译器上工作时，为什么要学习编译器课程？如果老板想从关系数据库切换到NoSQL引擎，那么我们可以将时间用于现代数据存储的课程上。只有在需要的时候才获得新信息，不要用快要腐烂的方法来扰乱思维。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/11eefac5bf4ae36c73b7b40eb087be7b.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/02a9f7817f8dd0012ff1327fde5bdc94.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112238\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112238votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112238\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx232824506\">努力学python</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx232824506\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            应用软件开发，主要用python、sql        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/wx232824506\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/wx232824506/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/wx232824506/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 19</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/0341d03d14d3de38ff2983a92d11b39e71e6c1aa.jpg"}
{"url_object_id": "132543f366021bfbe319524538ba0b5d", "title": ["树形结构数据存储方案（五）：区间嵌套"], "create_data": "2017/09/03", "url": "http://blog.jobbole.com/112339/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.biaodianfu.com/nested-intervals.html\">标点符</a>   </div><p>前面的一篇文章介绍了<a href=\"http://blog.jobbole.com/112323/\">左右值编码</a>，不知道大家注意到了没有，如果数据庞大，每次更新都需要更新差不多全表，效率较低没有更好的方式？今天我们就来研究下区间嵌套法。</p>\n<p><strong>区间嵌套法原理</strong></p>\n<p>如果节点区间[clft, crgt]与[plft, prgt]存在如下关系：plft &lt;= clft and crgt &gt;= prgt，则[clft, crgt]区间里的点是[plft, prgt]的子节点。基于此假设我们就可以通过对区间的不断的向下划来获取新的区间。举例：如果在区间[plft, prgt]中存在一个空白区间[lft1, rgt1]，如果要加入一个[plft,lft1]、[rgt1,prgt]同级的区间，只需插入节点：[(2*lft1+rgt1)/3,  (rgt1+2*lft)/3]。在添加完节点后我们还留下[lft1,(2*lft1+rgt1)/3]和 [(rgt1+2*lft)/3,rgt1]两个空余的空间用来添加更多的子节点。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/94d451042cd71b68d4b44369f8ecff49.png\" alt=\"nested-intervals\" width=\"575\" height=\"100\">如果我们把区间放在二位平面上，把rgt当成是x轴，lft当做是y轴，纳闷嵌套的区间数差不多是这样的：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/6e99479d95abda03131d9100ec75ec0f.png\" alt=\"nested-intervals-2\" width=\"500\" height=\"500\"></p>\n<p>每个节点[lft, rgt]拥有的子节点都被包含在y &gt;= lft &amp; x &lt;= rgt中。同时y &gt;= clft &amp; x &lt;= crgt所在的空间也是y &gt;= plft  &amp; x &lt;= prgt的子集。另外由于新增的右区间都小于已有的左区间，所以新增的节点均在y=x这条直线以下。</p>\n<p><strong>区间嵌套法实现</strong></p>\n<p>了解了区间嵌套法的原理后，接下来我们就要考虑如何实现他，原则上初始的区间使用任何区间都是可以的，这里我们使用的是[0,1]作为根区间。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/81fa2963538889e727c4b2e0ba0e9df5.png\" alt=\"nested-intervals-3\" width=\"594\" height=\"594\"></p>\n<p>首先，我们在XY平面上定义2个点。深度优先集合点和广度有限集合点，针对点&lt;x=1,y=1/2&gt;的深度优先集合点为&lt;x=1,y=1&gt;，广度优先集合点为&lt;x=1/2,y=1/2&gt;。接下来我们定义第一个子节点的位置为父节点和深度优先集合点的中间点。兄弟节点则为前一个子节点到广度优先集合点的中间点，如上图所示，节点1.2的位置为&lt;x=3/4, y=5/8&gt;。</p>\n<p>另外仔细看我们可以看到点与点之间的关系。另外如果我们知道x和y的和，我们就能反推出x,y的值（具体的逻辑是什么，我现在也还没有搞懂，有知道的朋友可以帮忙解释下）。</p>\n<p>我们以节点&lt;x=3/4, y=5/8&gt;为例，我们可以得到他的和为11/8。</p>\n<p>我们定义11为分子（numerator），8为分母（denominator），则x点的分子为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b71416b722b211432754\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `x_numer`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE ret_num INT;\r\n\tDECLARE ret_den INT;\r\n\tSET ret_num := numer+1;\r\n\tSET ret_den := denom*2;\r\n\tWHILE floor(ret_num/2) = ret_num/2 DO\r\n\t\tSET ret_num := ret_num/2;\r\n\t\tSET ret_den := ret_den/2;\r\n\tEND WHILE;\r\n\tRETURN ret_num;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b71416b722b211432754-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b722b211432754-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b722b211432754-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b722b211432754-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b722b211432754-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b722b211432754-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b722b211432754-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b722b211432754-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b722b211432754-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b722b211432754-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b722b211432754-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b722b211432754-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b722b211432754-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b71416b722b211432754-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">x_numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b722b211432754-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b722b211432754-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b722b211432754-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b722b211432754-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b722b211432754-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b722b211432754-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">denom*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b722b211432754-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b722b211432754-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b722b211432754-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b722b211432754-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b722b211432754-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b722b211432754-13\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>x点的分母为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b71416b7234844239101\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `x_ denom`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE ret_num INT;\r\n\tDECLARE ret_den INT;\r\n\tSET ret_num := numer+1;\r\n\tSET ret_den := denom*2;\r\n\tWHILE floor(ret_num/2) = ret_num/2 DO\r\n\t\tSET ret_num := ret_num/2;\r\n\t\tSET ret_den := ret_den/2;\r\n\tEND WHILE;\r\n\tRETURN ret_den;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b71416b7234844239101-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7234844239101-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7234844239101-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7234844239101-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7234844239101-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7234844239101-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7234844239101-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7234844239101-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7234844239101-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7234844239101-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7234844239101-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7234844239101-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7234844239101-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b71416b7234844239101-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-e\">x_ </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7234844239101-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7234844239101-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7234844239101-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7234844239101-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7234844239101-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7234844239101-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">denom*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7234844239101-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7234844239101-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7234844239101-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7234844239101-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7234844239101-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7234844239101-13\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>Y点的分子:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b71416b7239086026430\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `y_numer`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE num INT;\r\n\tDECLARE den INT;\r\n\tSET num := x_numer(numer, denom);\r\n\tSET den := x_denom(numer, denom);\r\n\tWHILE den &lt; denom DO\r\n\t\tSET num := num*2;\r\n\t\tSET den := den*2;\r\n\tEND WHILE;\r\n\tSET num := (numer - num);\r\n\tWHILE floor(num/2) = num/2 DO\r\n\t\tSET num := num/2;\r\n\t\tSET den := den/2;\r\n\tEND WHILE;\r\n\tRETURN num;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b71416b7239086026430-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7239086026430-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7239086026430-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7239086026430-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7239086026430-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7239086026430-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7239086026430-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7239086026430-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7239086026430-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7239086026430-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7239086026430-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7239086026430-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7239086026430-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7239086026430-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7239086026430-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7239086026430-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7239086026430-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7239086026430-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b71416b7239086026430-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">y_numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7239086026430-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7239086026430-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7239086026430-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7239086026430-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7239086026430-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">x_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7239086026430-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">x_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7239086026430-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">denom </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7239086026430-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">num*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7239086026430-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">den*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7239086026430-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7239086026430-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7239086026430-13\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7239086026430-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7239086026430-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7239086026430-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7239086026430-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7239086026430-18\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>Y 的分母：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b71416b723c630247168\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `y_denom`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE num INT;\r\n\tDECLARE den INT;\r\n\tSET num := x_numer(numer, denom);\r\n\tSET den := x_denom(numer, denom);\r\n\tWHILE den &lt; denom DO\r\n\t\tSET num := num*2;\r\n\t\tSET den := den*2;\r\n\tEND WHILE;\r\n\tSET num := (numer - num);\r\n\tWHILE floor(num/2) = num/2 DO\r\n\t\tSET num := num/2;\r\n\t\tSET den := den/2;\r\n\tEND WHILE;\r\n\tRETURN den;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b71416b723c630247168-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b723c630247168-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b723c630247168-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b723c630247168-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b723c630247168-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b723c630247168-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b723c630247168-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b723c630247168-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b723c630247168-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b723c630247168-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b723c630247168-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b723c630247168-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b723c630247168-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b723c630247168-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b723c630247168-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b723c630247168-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b723c630247168-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b723c630247168-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b71416b723c630247168-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">y_denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b723c630247168-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b723c630247168-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b723c630247168-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b723c630247168-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b723c630247168-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">x_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b723c630247168-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">x_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b723c630247168-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">denom </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b723c630247168-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">num*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b723c630247168-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">den*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b723c630247168-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b723c630247168-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b723c630247168-13\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b723c630247168-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b723c630247168-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b723c630247168-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b723c630247168-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b723c630247168-18\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p>接下来我们来测试下，X与Y是否能解码出来：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b71416b7240870262459\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT\r\n\tCONCAT(x_numer (11, 8),'/',x_denom (11, 8)) AS X,\r\n\tCONCAT(y_numer (11, 8),'/',y_denom (11, 8)) AS Y</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b71416b7240870262459-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7240870262459-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7240870262459-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b71416b7240870262459-1\"><span class=\"crayon-e\">SELECT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7240870262459-2\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">x_numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">x_denom</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7240870262459-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">y_numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">y_denom</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Y</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/bbeb82483ee93ccefe1247f25950d91a.png\" alt=\"result\" width=\"232\" height=\"83\"></p>\n<p>结果与节点1.2的位置为&lt;x=3/4, y=5/8&gt;完全一致。现在我们知道只需要一个分数即可表示平面上的一个点。</p>\n<p>如有已经有分数11/8如何获取该节点的父节点？(如果分子为3，则代表其为根节点)</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b71416b7243075702090\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `parent_numer`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE ret_num INT;\r\n\tDECLARE ret_den INT;\r\n\tIF numer=3 THEN\r\n\t\tRETURN denom/2;\r\n\tEND IF;\r\n\tSET ret_num := (numer-1)/2;\r\n\tSET ret_den := denom/2;\r\n\tWHILE floor((ret_num-1)/4) = (ret_num-1)/4 DO\r\n\t\tSET ret_num := (ret_num+1)/2;\r\n\t\tSET ret_den := ret_den/2;\r\n\tEND WHILE;\r\n\tRETURN ret_num;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b71416b7243075702090-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7243075702090-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7243075702090-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7243075702090-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7243075702090-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7243075702090-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7243075702090-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7243075702090-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7243075702090-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7243075702090-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7243075702090-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7243075702090-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7243075702090-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7243075702090-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7243075702090-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7243075702090-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b71416b7243075702090-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">parent_numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7243075702090-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7243075702090-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7243075702090-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7243075702090-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7243075702090-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7243075702090-7\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7243075702090-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7243075702090-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7243075702090-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7243075702090-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7243075702090-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7243075702090-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7243075702090-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7243075702090-15\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7243075702090-16\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b71416b7246720822200\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT CONCAT(parent_numer(11,8),'/',parent_denom(11,8)) AS parent</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b71416b7246720822200-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b71416b7246720822200-1\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">parent_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">parent_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">parent</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>计算当前节点在同级所在的位置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b71416b724a756097528\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `parent_denom`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE ret_num INT;\r\n\tDECLARE ret_den INT;\r\n\tIF numer=3 THEN\r\n\t\tRETURN NULL;\r\n\tEND IF;\r\n\tSET ret_num := (numer-1)/2;\r\n\tSET ret_den := denom/2;\r\n\tWHILE floor((ret_num-1)/4) = (ret_num-1)/4 DO\r\n\t\tSET ret_num := (ret_num+1)/2;\r\n\t\tSET ret_den := ret_den/2;\r\n\tEND WHILE;\r\n\tRETURN ret_den;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b71416b724a756097528-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b724a756097528-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b724a756097528-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b724a756097528-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b724a756097528-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b724a756097528-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b724a756097528-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b724a756097528-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b724a756097528-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b724a756097528-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b724a756097528-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b724a756097528-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b724a756097528-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b724a756097528-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b724a756097528-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b724a756097528-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b71416b724a756097528-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">parent_denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b724a756097528-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b724a756097528-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b724a756097528-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b724a756097528-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b724a756097528-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b724a756097528-7\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b724a756097528-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b724a756097528-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b724a756097528-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b724a756097528-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b724a756097528-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b724a756097528-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b724a756097528-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b724a756097528-15\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b724a756097528-16\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>有了查询父节点的方法及当前节点所在同级中的位置的方法，即可通过这两个的组合，将节点的路径给计算出来。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b71416b724d917508662\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `path`(`numer` int,`denom` int)\r\n RETURNS varchar(255)\r\nBEGIN\r\n\tIF numer is NULL THEN\r\n\t\tRETURN '';\r\n\tEND IF;\r\n\tRETURN path(parent_numer(numer, denom),parent_denom(numer, denom))|| ‘.’ || sibling_number(numer, denom);\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b71416b724d917508662-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b724d917508662-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b724d917508662-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b724d917508662-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b724d917508662-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b724d917508662-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b724d917508662-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b724d917508662-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b71416b724d917508662-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b724d917508662-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b724d917508662-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b724d917508662-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numer </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b724d917508662-5\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b724d917508662-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b724d917508662-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">parent_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">parent_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span>‘<span class=\"crayon-sy\">.</span>’<span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sibling_number</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b724d917508662-8\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>按照以上方法添加后进行测试，返回[Err] 1424 – Recursive stored functions and triggers are not allowed. 即MySQL的自定义函数不支持递归查询。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b71416b7250356031788\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `path`(`numer` int,`denom` int)\r\n RETURNS varchar(255)\r\nBEGIN\r\n\tDECLARE numer_temp INT;\r\n\tDECLARE denom_temp INT;\r\n\tDECLARE path_result VARCHAR(255);\r\n\tDECLARE path_temp VARCHAR(255);\r\n\tDECLARE sn VARCHAR(255);\r\n\tSET path_temp := '';\r\n\tWHILE numer IS NOT NULL DO\r\n\t\tIF path_temp = ''\r\n\t\tTHEN\r\n\t\t\tSET path_result := sibling_number(numer, denom);\r\n\t\tELSE\r\n\t\t\tSET path_result := CONCAT(sibling_number(numer, denom),'.',path_temp);\r\n\t\tEND IF;\r\n\t\tSET path_temp := path_result;\r\n\t\tSET numer_temp := parent_numer(numer, denom);\r\n\t\tSET denom_temp := parent_denom(numer, denom);\r\n\t\tSET numer := numer_temp;\r\n\t\tSET denom := denom_temp;\r\n\tEND WHILE;\r\n\tRETURN path_result;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b71416b7250356031788-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7250356031788-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7250356031788-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7250356031788-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7250356031788-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7250356031788-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7250356031788-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7250356031788-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7250356031788-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7250356031788-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7250356031788-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7250356031788-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7250356031788-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7250356031788-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7250356031788-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7250356031788-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7250356031788-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7250356031788-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7250356031788-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7250356031788-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7250356031788-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7250356031788-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7250356031788-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7250356031788-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b71416b7250356031788-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7250356031788-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7250356031788-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7250356031788-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numer_temp </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7250356031788-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">denom_temp </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7250356031788-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">path_result </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7250356031788-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">path_temp </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7250356031788-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sn </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7250356031788-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">path_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7250356031788-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numer </span><span class=\"crayon-st\">IS</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7250356031788-11\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7250356031788-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7250356031788-13\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">path_result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sibling_number</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7250356031788-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">ELSE</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7250356031788-15\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">path_result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sibling_number</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">path_temp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7250356031788-16\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7250356031788-17\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">path_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path_result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7250356031788-18\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">numer_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parent_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7250356031788-19\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">denom_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parent_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7250356031788-20\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer_temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7250356031788-21\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">denom</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom_temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7250356031788-22\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7250356031788-23\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path_result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7250356031788-24\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p>SELECT path (11, 8) 的结果为 1.2</p>\n<p>计算节点层级的方法：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b71416b7254706944350\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `node_level`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE ret_num INT;\r\n\tDECLARE ret_den INT;\r\n\tDECLARE ret INT;\r\n\tSET ret =1;\r\n\tIF numer=3 THEN\r\n\t\treturn 1;\r\n\tEND IF;\r\n\tWHILE numer!=3 DO\r\n\t\tSET ret_num := parent_numer(numer, denom);\r\n\t\tSET ret_den := parent_denom(numer, denom);\r\n\t\tSET numer := ret_num;\r\n\t\tSET denom := ret_den;\r\n\t\tSET ret := ret + 1;\r\n\tEND WHILE;\r\n\tRETURN ret;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b71416b7254706944350-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7254706944350-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7254706944350-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7254706944350-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7254706944350-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7254706944350-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7254706944350-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7254706944350-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7254706944350-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7254706944350-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7254706944350-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7254706944350-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7254706944350-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7254706944350-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7254706944350-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7254706944350-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7254706944350-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7254706944350-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7254706944350-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b71416b7254706944350-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">node_level</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7254706944350-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7254706944350-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7254706944350-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7254706944350-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7254706944350-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7254706944350-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7254706944350-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7254706944350-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7254706944350-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7254706944350-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">!=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7254706944350-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parent_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7254706944350-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parent_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7254706944350-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7254706944350-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">denom</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7254706944350-16\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7254706944350-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7254706944350-18\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7254706944350-19\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>我们知道了如何将编码过的节点转成目录形式，如何逆转呢？以下是方法：</p>\n<p>先添加2个辅助函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b71416b7257757681014\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `child_numer`(`num` int,`den` int,`child` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tRETURN num * power(2, child) + 3 - power(2, child);\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b71416b7257757681014-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7257757681014-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7257757681014-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7257757681014-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7257757681014-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b71416b7257757681014-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">child_numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7257757681014-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7257757681014-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7257757681014-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">num *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">power</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">power</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7257757681014-5\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b71416b725a818151303\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `child_denom`(`num` int,`den` int,`child` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tRETURN den*power(2, child);\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b71416b725a818151303-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b725a818151303-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b725a818151303-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b725a818151303-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b725a818151303-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b71416b725a818151303-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">child_denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b725a818151303-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b725a818151303-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b725a818151303-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">den*</span><span class=\"crayon-e\">power</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b725a818151303-5\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>再来编写逆转函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b71416b725d363227425\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `path_numer`(`path` varchar(255))\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE num INT;\r\n\tDECLARE den INT;\r\n\tDECLARE postfix VARCHAR(255);\r\n\tDECLARE sibling VARCHAR(255);\r\n\tSET num := 1;\r\n\tSET den := 1;\r\n\tSET postfix := CONCAT(path,'.');\r\n\tWHILE length(postfix) &gt; 1 DO\r\n\t\tSET sibling := SUBSTR(postfix, 1, instr(postfix,'.')-1);\r\n\t\tSET postfix := SUBSTR(postfix, instr(postfix,'.')+1);\r\n\t\tSET num := child_numer(num,den,sibling+0);\r\n\t\tSET den := child_denom(num,den,sibling+0);\r\n\tEND WHILE;\r\n\tRETURN num;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b71416b725d363227425-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b725d363227425-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b725d363227425-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b725d363227425-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b725d363227425-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b725d363227425-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b725d363227425-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b725d363227425-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b725d363227425-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b725d363227425-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b725d363227425-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b725d363227425-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b725d363227425-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b725d363227425-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b725d363227425-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b725d363227425-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b725d363227425-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b725d363227425-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b71416b725d363227425-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path_numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b725d363227425-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b725d363227425-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b725d363227425-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b725d363227425-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b725d363227425-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">postfix </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b725d363227425-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sibling </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b725d363227425-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b725d363227425-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b725d363227425-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">postfix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b725d363227425-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b725d363227425-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">sibling</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SUBSTR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">instr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b725d363227425-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">postfix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SUBSTR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">instr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b725d363227425-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sibling</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b725d363227425-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sibling</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b725d363227425-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b725d363227425-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b725d363227425-18\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b71416b7260326317531\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `path_denom`(`path` varchar(255))\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE num INT;\r\n\tDECLARE den INT;\r\n\tDECLARE postfix VARCHAR(255);\r\n\tDECLARE sibling VARCHAR(255);\r\n\tSET num := 1;\r\n\tSET den := 1;\r\n\tSET postfix := CONCAT(path,'.');\r\n\tWHILE length(postfix) &gt; 1 DO\r\n\t\tSET sibling := SUBSTR(postfix, 1, instr(postfix,'.')-1);\r\n\t\tSET postfix := SUBSTR(postfix, instr(postfix,'.')+1);\r\n\t\tSET num := child_numer(num,den,sibling+0);\r\n\t\tSET den := child_denom(num,den,sibling+0);\r\n\tEND WHILE;\r\n\tRETURN den;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b71416b7260326317531-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7260326317531-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7260326317531-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7260326317531-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7260326317531-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7260326317531-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7260326317531-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7260326317531-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7260326317531-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7260326317531-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7260326317531-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7260326317531-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7260326317531-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7260326317531-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7260326317531-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7260326317531-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b71416b7260326317531-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b71416b7260326317531-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b71416b7260326317531-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path_denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7260326317531-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7260326317531-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7260326317531-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7260326317531-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7260326317531-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">postfix </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7260326317531-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sibling </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7260326317531-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7260326317531-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7260326317531-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">postfix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7260326317531-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7260326317531-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">sibling</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SUBSTR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">instr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7260326317531-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">postfix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SUBSTR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">instr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7260326317531-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sibling</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7260326317531-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sibling</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7260326317531-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b71416b7260326317531-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b71416b7260326317531-18\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p>select CONCAT(path_numer(‘2.1.3′),’/’,path_denom(‘2.1.3’)) 结果为51/64</p>\n<p>参考资料：</p>\n<ul>\n<li>http://www.rampant-books.com/art_vadim_nested_sets_sql_trees.htm</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112339\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112339votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112339\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg"}
{"url_object_id": "6066e9414921b467dc9895b140263fb2", "title": ["树形结构数据存储方案（三）：闭包表"], "create_data": "2017/09/01", "url": "http://blog.jobbole.com/112315/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.biaodianfu.com/closure-table.html\">标点符</a>   </div><p>将Closure Table翻译成闭包表不知道是否合适，闭包表的思路和<a href=\"http://blog.jobbole.com/112312/\">物化路径</a>差不多，都是空间换时间，Closure Table，一种更为彻底的全路径结构，分别记录路径上相关结点的全展开形式。能明晰任意两结点关系而无须多余查询，级联删除和结点移动也很方便。但是它的存储开销会大一些，除了表示结点的Meta信息，还需要一张专用的关系表。</p>\n<p>以下图举例数据举例：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/72dbc716e80c6f5d62a90ddf0cf49901.jpg\" alt=\"tree\" width=\"231\" height=\"259\"></p>\n<p>创建主表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b728131ec0e900867796\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE nodeInfo (\r\n\tnode_id INT NOT NULL AUTO_INCREMENT,\r\n\tnode_name VARCHAR (255),\r\n\tPRIMARY KEY (`node_id`)\r\n) DEFAULT CHARSET = utf8;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b728131ec0e900867796-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec0e900867796-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec0e900867796-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec0e900867796-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec0e900867796-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b728131ec0e900867796-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">nodeInfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec0e900867796-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">node_id </span><span class=\"crayon-t\">INT</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec0e900867796-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">node_name </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec0e900867796-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec0e900867796-5\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">utf8</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>创建关系表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b728131ec1d541020450\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE nodeRelationship (\r\n\tancestor INT NOT NULL,\r\n\tdescendant INT NOT NULL,\r\n\tdistance INT NOT NULL,\r\n\tPRIMARY KEY (ancestor, descendant)\r\n) DEFAULT CHARSET = utf8;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b728131ec1d541020450-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec1d541020450-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec1d541020450-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec1d541020450-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec1d541020450-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec1d541020450-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b728131ec1d541020450-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">nodeRelationship</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec1d541020450-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">ancestor </span><span class=\"crayon-t\">INT</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec1d541020450-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">descendant </span><span class=\"crayon-t\">INT</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec1d541020450-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">distance </span><span class=\"crayon-t\">INT</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec1d541020450-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">descendant</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec1d541020450-6\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">utf8</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>其中</p>\n<ul>\n<li>Ancestor代表祖先节点</li>\n<li>Descendant代表后代节点</li>\n<li>Distance 祖先距离后代的距离</li>\n</ul>\n<p>添加数据（创建存储过程）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b728131ec23325070345\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` PROCEDURE `AddNode`(`_parent_name` varchar(255),`_node_name` varchar(255))\r\nBEGIN\r\n\tDECLARE _ancestor INT;\r\n\tDECLARE _descendant INT;\r\n\tDECLARE _parent INT;\r\n\tIF NOT EXISTS(SELECT node_id From nodeinfo WHERE node_name = _node_name)\r\n\tTHEN\r\n\t\tINSERT INTO nodeinfo (node_name) VALUES(_node_name);\r\n\t\tSET _descendant = (SELECT node_id FROM nodeinfo WHERE node_name = _node_name);\r\n\t\tINSERT INTO noderelationship (ancestor,descendant,distance) VALUES(_descendant,_descendant,0);\r\n\t\tIF EXISTS (SELECT node_id FROM nodeinfo WHERE node_name = _parent_name)\r\n\t\tTHEN\r\n\t\t\tSET _parent = (SELECT node_id FROM nodeinfo WHERE node_name = _parent_name);\r\n\t\t\tINSERT INTO noderelationship (ancestor,descendant,distance) SELECT ancestor,_descendant,distance+1 from noderelationship where descendant = _parent;\r\n\t\tEND IF;\r\n\tEND IF;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b728131ec23325070345-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec23325070345-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec23325070345-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec23325070345-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec23325070345-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec23325070345-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec23325070345-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec23325070345-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec23325070345-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec23325070345-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec23325070345-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec23325070345-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec23325070345-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec23325070345-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec23325070345-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec23325070345-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec23325070345-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b728131ec23325070345-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">PROCEDURE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">AddNode</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">_parent_name</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">_node_name</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec23325070345-2\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec23325070345-3\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_ancestor </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec23325070345-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_descendant </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec23325070345-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_parent </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec23325070345-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EXISTS</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">node_id </span><span class=\"crayon-e\">From </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_node_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec23325070345-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec23325070345-8\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">nodeinfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">_node_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec23325070345-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">_descendant</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">node_id </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_node_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec23325070345-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">noderelationship</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">descendant</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">distance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">_descendant</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">_descendant</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec23325070345-11\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EXISTS</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">node_id </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_parent_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec23325070345-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec23325070345-13\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">_parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">node_id </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_parent_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec23325070345-14\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">noderelationship</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">descendant</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">distance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">_descendant</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">distance</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">noderelationship </span><span class=\"crayon-e\">where </span><span class=\"crayon-v\">descendant</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_parent</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec23325070345-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec23325070345-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec23325070345-17\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p>完成后2张表的数据大致是这样的：（注意：每个节点都有一条到其本身的记录。）</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/97f89f232ea959cd8c01536308049baf.png\" alt=\"Closure-Table-1\" width=\"178\" height=\"224\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/5842ea4fa2e0b6f0bdc31ed02131df05.png\" alt=\"Closure-Table-2\" width=\"261\" height=\"451\"></p>\n<p>查询Fruit下所有的子节点：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b728131ec2a561604541\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT\r\n\tn3.node_name\r\nFROM\r\n\tnodeinfo n1\r\nINNER JOIN noderelationship n2 ON n1.node_id = n2.ancestor\r\nINNER JOIN nodeinfo n3 ON n2.descendant = n3.node_id\r\nWHERE\r\n\tn1.node_name = 'Fruit'\r\nAND n2.distance != 0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b728131ec2a561604541-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec2a561604541-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec2a561604541-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec2a561604541-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec2a561604541-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec2a561604541-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec2a561604541-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec2a561604541-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec2a561604541-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b728131ec2a561604541-1\"><span class=\"crayon-e\">SELECT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec2a561604541-2\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_name</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec2a561604541-3\"><span class=\"crayon-e\">FROM</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec2a561604541-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n1</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec2a561604541-5\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">noderelationship </span><span class=\"crayon-e\">n2 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ancestor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec2a561604541-6\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n3 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">descendant</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_id</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec2a561604541-7\"><span class=\"crayon-e\">WHERE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec2a561604541-8\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec2a561604541-9\"><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>查询Fruit下直属子节点：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b728131ec2f078789214\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT\r\n\tn3.node_name\r\nFROM\r\n\tnodeinfo n1\r\nINNER JOIN noderelationship n2 ON n1.node_id = n2.ancestor\r\nINNER JOIN nodeinfo n3 ON n2.descendant = n3.node_id\r\nWHERE\r\n\tn1.node_name = 'Fruit'\r\nAND n2.distance = 1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b728131ec2f078789214-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec2f078789214-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec2f078789214-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec2f078789214-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec2f078789214-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec2f078789214-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec2f078789214-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec2f078789214-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec2f078789214-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b728131ec2f078789214-1\"><span class=\"crayon-e\">SELECT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec2f078789214-2\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_name</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec2f078789214-3\"><span class=\"crayon-e\">FROM</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec2f078789214-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n1</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec2f078789214-5\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">noderelationship </span><span class=\"crayon-e\">n2 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ancestor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec2f078789214-6\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n3 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">descendant</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_id</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec2f078789214-7\"><span class=\"crayon-e\">WHERE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec2f078789214-8\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec2f078789214-9\"><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>查询Fruit所处的层级：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b728131ec35813226945\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT\r\n\tn2.*, n3.node_name\r\nFROM\r\n\tnodeinfo n1\r\nINNER JOIN noderelationship n2 ON n1.node_id = n2.descendant\r\nINNER JOIN nodeinfo n3 ON n2.ancestor = n3.node_id\r\nWHERE\r\n\tn1.node_name = 'Fruit'\r\nORDER BY\r\n\tn2.distance DESC</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b728131ec35813226945-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec35813226945-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec35813226945-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec35813226945-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec35813226945-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec35813226945-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec35813226945-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec35813226945-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b728131ec35813226945-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b728131ec35813226945-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b728131ec35813226945-1\"><span class=\"crayon-e\">SELECT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec35813226945-2\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_name</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec35813226945-3\"><span class=\"crayon-e\">FROM</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec35813226945-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n1</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec35813226945-5\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">noderelationship </span><span class=\"crayon-e\">n2 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">descendant</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec35813226945-6\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n3 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_id</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec35813226945-7\"><span class=\"crayon-e\">WHERE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec35813226945-8\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span></div><div class=\"crayon-line\" id=\"crayon-59b728131ec35813226945-9\"><span class=\"crayon-e\">ORDER </span><span class=\"crayon-e\">BY</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b728131ec35813226945-10\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">distance </span><span class=\"crayon-v\">DESC</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>另外要删除节点也非常的简单，这里就不再做过多的阐述。</p>\n<p>参考链接：</p>\n<ul>\n<li>https://coderwall.com/p/lixing/closure-tables-for-browsing-trees-in-sql</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112315\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112315votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112315\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg"}
{"url_object_id": "131eed081b813e1db0e388ed019752d2", "title": ["程序员的技术选择：发达国家和发展中国家有这些差异"], "create_data": "2017/09/04", "url": "http://blog.jobbole.com/112351/", "front_image_url": ["http://wx4.sinaimg.cn/large/7cc829d3gy1fj7ulu5ctdj20sg0sgwmd.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "开发,编程语言,薪资", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/huangxiaofei\">黄小非</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://stackoverflow.blog/2017/08/29/tale-two-industries-programming-languages-differ-wealthy-developing-countries/\">stackoverflow</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：Stack Overflow 工程师最近 David Robinson 做了一次数据分析，总结了程序员的技术选择和所在国家收入之间的关系。<b></b></p>\n<p>Stack Overflow 非常热衷于利用数据来和用户分享对全世界开发者社区的认知。比如这篇<a href=\"https://stackoverflow.blog/2017/08/22/world-mobile-development/\">关于 Android 开发者分布的文章</a>就是个很好的例子，它通过对全球开发者在 Stack Overflow 上询问 Andorid 相关问题统计，得出了结论：收入较低国家的开发者询问 Android 问题的数量要高于高收入国家的开发者。</p>\n<p>这个问题引发了我们的联想：<span style=\"color: #800000;\"><strong>高收入国家和低收入国家之间，开发人员在技术选择方面有什么不同呢？</strong></span>这种不同又会如何影响全球的软件开发产业呢？在本文中，我们就探索了上述的问题，并且发现通过收入来区分软件工业的发展，是一种很有效的办法。</p>\n<p>本文中的所有分析结论都是基于 2017 年 1 月 到 8 月的数据，并挑选在这段时间内出现频率 Top 250 标签进行统计的。为了减少数据样本过大可能造成的偏差，我们集中选取了相应时间段内来自 64 个国家的超过 500 万个问题进行分析。需要说明的是，这些数据很大程度上只反应了英语开发者们的行为模式（当然通过对西班牙语和葡萄牙语站点的分析，发现在墨西哥，西班牙这些国家，得到的分析结论和英语国家差不多）。</p>\n<h3>技术和人均 GDP 的相关性</h3>\n<p>在最近的一篇文章中，我们通过计算 Android 相关问题的比例（就是某个国家Android相关的问题的数量占该国整体Stack Overflow问题数据量的百分比），发现这个比例和这个国家的人均GPD是成反比的。所以我们也想知道，其他种类的技术和人均GDP的关系。</p>\n<p>因此我们调查了主流的编程语言和平台，包括PHP、Python、R 等等。<a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/b0e581c125a2252f8e54bfbe6db1f064.png\"><img class=\"aligncenter size-full wp-image-65858\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fj7ulu5ctdj20sg0sgwmd.jpg\" alt=\"tag_gdp_compare-1-2-1024x1024\" width=\"1024\" height=\"1024\"></a></p>\n<p>统计发现，来自某个国家 Android 相关问题和 PHP 相关问题的数量是和国家的收入情况成反比的，而同 Python、R 语言相关问题的数量则是正比。当然，在每一个统计案例里都会有例外的情况（例如，来自人均收入较高的韩国的 Android 问题数量要远超我们的预期，来自中国的 Python 问题的数量相对较低），但是总体来看，这种正反比关系还是很有说服力的。（多重假设检验调整后，每一种语言案例统计的决定系数都在 0.5 到 0.6 之间，P 值为 10 的负六次方）。</p>\n<p><span style=\"color: #800000;\">必须要说明一下，我们得出这些结论不是要说明什么因果性。我们并不是说，如果你选择了那些富有国家的开发者使用的编程语言，那么你所在的国家就能变成富有的国家。并且我们也不是说，国家的经济会直接影响到某种计算机技术的使用。我们只是发现，把经济和社会因素（例如教育程度，软件工业发展的年限，外包的水平等）看成一个整体，从总体上会与这个国家的财富多寡相关。</span></p>\n<h3>软件开发产业是按什么标准一分为二的？</h3>\n<p>在我们调查软件技术趋势时，通常只会把全世界的国家分成两组（即高收入国家和非高收入国家）来统计。我们不会把各国分成许多组来把相关性问题复杂化。因为在这方面已经有了很成熟的划分标准，我们就直接用<a href=\"https://datahelpdesk.worldbank.org/knowledgebase/articles/906519-world-bank-country-and-lending-groups\">世界银行收入分级标准</a>就可以了，这种分级法是以人均国民总收入（GNI）为基准的（具体的分类方法可以看<a href=\"https://datahelpdesk.worldbank.org/knowledgebase/articles/378831-why-use-gni-per-capita-to-classify-economies-into\">这里</a>）</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/4a90e3ee6a488ad0181fb4853f82f968.png\"><img class=\"aligncenter size-large wp-image-65861\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fj7uluvb7ej20sg0h243t.jpg\" alt=\"worldbank_map-1-1024x614\" width=\"1024\" height=\"614\"></a></p>\n<p>上图显示，全球一共有 78 个国家属于高收入国家，这些国家多半由美国、加拿大、西欧、部分中东和东亚国家，以及澳大利亚/新西兰构成。通过统计学的手段可以证明，这种划分方法是有足够依据的，而且这种划分方法比其他的方法更有意义，比如很多时候人们喜欢按照东西半球来划分国家，可实际上澳大利亚的技术分布情况却更接近美国和欧洲，而不是同属东半球的中国和印度尼西亚。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/bc8880913bdcd9e2cdba976f19f6e47a.png\"><img class=\"aligncenter size-large wp-image-65860\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fj7ulvf42zj20sg0izdip.jpg\" alt=\"top_countries-1-2-1024x683\" width=\"1024\" height=\"683\"></a></p>\n<p>这种分类方法同时也把 Stack Overflow 的访问量分成了两组，其中高收入国家访问量超过 2/3，剩余的国家占了访问量的不到 1/3。（得到这样的结果是和被调查国家软件开发人员的数量、互联网的基础设施的情况、以及说英语人数的情况严重相关的）。其中非高收入国家的访问量的排名分别为：印度、巴西、俄罗斯和中国。</p>\n<h3>高低收入国家使用的技术有什么不同？</h3>\n<p>我们已经把软件开发的世界分成了两个区域了。那么高收入国家和非高收入国家在使用的技术上有什么不同呢？</p>\n<p>我们从中可以看到一些有趣的结论：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/b605e4100f6835b922f7fe48534c2d6f.png\"><img class=\"aligncenter size-large wp-image-65859\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fj7ulw4j26j20sg0kbjxu.jpg\" alt=\"tech_difference_graph-1-1-1024x731\" width=\"1024\" height=\"731\"></a></p>\n<p><strong>数据科学技术的不同：</strong>我们之前已经看到，Python 和 R 语言的使用情况和国家的富有程度是相关的。Python 在高收入国家使用的规模大约是其余国家的两倍之多，而 R 语言的使用规模差达到了 3 倍多。我们还注意到，通过对内容更具体的标签（tags）的统计，发现在Python和R科学计算领域，使用不同的计算包的人收入跳度很明显，例如 pandas、numpy,、matplotlib 和 ggplot2。这说明了在数据科学研究方面，不同的技术角色之间存在收入鸿沟。当然在越富有，工业化程度越高的国家，数据科学研究的占国家经济的比例越大，程序员的学历也越高，这个结论是符合逻辑的。</p>\n<p><strong>C/C++：</strong>在 Stack Overflow 上还有两个值得一提的语言就是 C 和 C++，高收入国家的程序员访问这两种语言的次数比低收入国家程序员多。对这个现象，有一种猜测是，它和教育机构有关：因为在之前的一篇<a href=\"https://stackoverflow.blog/2017/02/15/how-do-students-use-stack-overflow/\">《学生如何使用Stack Overflow》</a>的帖子里，我们发现美国的大学对 C/C++ 的访问频率是非常高的。当然这个现象也可能和电器制造商的地理分布情况有关。</p>\n<p><strong>PHP </strong><strong>和 </strong><strong>Android</strong>：我们在以前的一篇<a href=\"https://stackoverflow.blog/2017/08/22/world-mobile-development/?utm_source=so-owned&amp;utm_medium=blog&amp;utm_campaign=gen-blog&amp;utm_content=blog-link&amp;utm_term=income-countries\">《全球移动开发调查》</a>的帖子中讨论了 Android 开发的情况，除此之外，还有一种技术和低收入国家息息相关，那就是 PHP。在Stack Overflow上，来自低收入国家的对 CodeIgniter(一个PHP开源框架)的问题非常的多，而高收入国家队这个框架的提问几乎没有，这么大悬殊实在是一个很有趣的现象。经过进一步的调查，发现对 CodeIgniter 的重度访问来自于南亚，东南亚（尤其是印度、印度尼西亚、巴基斯坦和菲律宾），来自美国或者都周的访问几乎没有。所以可以推断，这个框架主要是这些外包公司用来开发门户网站用的。</p>\n<h3>结论：统计这些有什么用？</h3>\n<p>我们做这些统计当然是因为对编程语言生态系统的兴趣。而且这对我们日后要做的数据探索有很大的启发。</p>\n<p>我们在说软件开发工业方面的问题时，要意识到我们的问题都是由两个单独的问题混合起来的，这很重要，因为这种混合会给我们带来更多的信息。</p>\n<p>比如，我们想找到是哪些技术给Stack Overflow带来最大的流量，例如：《<a href=\"https://stackoverflow.blog/2017/08/01/flash-dead-technologies-might-next/\">探寻Flash技术不不断缩水的原因</a>》。如果我们把访问量最多的技术列出一张表，你会发现高收入和低收入的国家的分布是完全不一样的。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/81bc32fb2d22b73b61614c4362fedb0a.png\"><img class=\"aligncenter size-full wp-image-65857\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fj7ulxy4z8j20sg0sg7ap.jpg\" width=\"1024\" height=\"1024\"></a></p>\n<p>例如，2017 年以来，Python 是来自高收入国家被访问第二多的话题，但是在非高收入国家，Python 只能排到第 8 位。而本文作者自己使用的 R 语言，在高收入国家访问数量的排名是第 15，但是在非高收入国家排名却在 50 开外。</p>\n<p>这些数据对 Stack Overflow 了解全球的开发者生态来说都是很重要的数据。而对于美国的技术招聘者来说，他们需要掌握未来的动向，所以他们需要了解更多的方面的数据，而不仅是“来自印度的学生要学习什么样的计算机语言”、“技术投资人在肯尼亚寻找合适的技术公司”这类话题。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://www.jobbole.com/wp-content/uploads/2016/04/78805a221a988e79ef3f42d7c5bfd4187.jpeg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112351\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112351votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112351\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei\">黄小非</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/avatars/5423/Corbis-42-221258652.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            黄小非：毕业于重庆大学计算机系，南开大学软件工程硕士，SCJP。 目前在一家国企信息中心任职软件开发工程师。主要技术兴趣为Java平台相关技术、系统构架、C/C++、计算机图形学等。（新浪微博：@黄小非）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/huangxiaofei\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/huangxiaofei/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 65</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/huangxiaofei2002\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/5ef5deea05baf6e946764ea6c6a4efa4c5eb9840.jpg"}
{"url_object_id": "686dfefb107681a80169eabfd8e284a0", "title": ["给中级 Meld 用户的实用技巧"], "create_data": "2017/09/03", "url": "http://blog.jobbole.com/112348/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/04/e260ae4f5d153b25be87819b25ff0577.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.howtoforge.com/tutorial/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/\">Ansh</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8808-1.html\">Linux中国/geekpi</a>   </div><p>Meld 是 Linux 上功能丰富的可视化比较和合并工具。如果你是第一次接触，你可以进入我们的<a href=\"http://blog.jobbole.com/112344/\">初学者指南</a>，了解该程序的工作原理，如果你已经阅读过或正在使用 Meld 进行基本的比较/合并任务，你将很高兴了解本教程的东西，在本教程中，我们将讨论一些非常有用的技巧，这将让你使用工具的体验更好。</p>\n<p><em>但在我们跳到安装和解释部分之前，值得一提的是，本教程中介绍的所有说明和示例已在 Ubuntu 14.04 上进行了测试，而我们使用的 Meld 版本为 3.14.2</em>。</p>\n<h3 id=\"toc_1\">1、 跳转</h3>\n<p>你可能已经知道（我们也在初学者指南中也提到过这一点），标准滚动不是在使用 Meld 时在更改之间跳转的唯一方法 – 你可以使用向上和向下箭头键轻松地从一个更改跳转到另一个更改位于编辑区域上方的窗格中：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-go-next-prev-9.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/ffe53b7d64bad7dac95f36ba889bc13d.png\" alt=\"Navigating in Meld\"></a></p>\n<p>但是，这需要你将鼠标指针移动到这些箭头，然后再次单击其中一个（取决于你要去哪里 – 向上或向下）。你会很高兴知道，存在另一种更简单的方式来跳转：只需使用鼠标的滚轮即可在鼠标指针位于中央更改栏上时进行滚动。</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-center-area-scrolling.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/84810b35573d599d2a5a3ef2d2ee916e.png\" alt=\"The change bar\"></a></p>\n<p>这样，你就可以在视线不离开或者分心的情况下进行跳转，</p>\n<h3 id=\"toc_2\">2、 可以对更改进行的操作</h3>\n<p>看下上一节的最后一个屏幕截图。你知道那些黑箭头做什么吧？默认情况下，它们允许你执行合并/更改操作 – 当没有冲突时进行合并，并在同一行发生冲突时进行更改。</p>\n<p>但是你知道你可以根据需要删除个别的更改么？是的，这是可能的。为此，你需要做的是在处理更改时按下 Shift 键。你会观察到箭头被变成了十字架。</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-delete-changes.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/c867a5a2a0153b0a72912ff16ef19151.png\" alt=\"Things you can do with changes\"></a></p>\n<p>只需点击其中任何一个，相应的更改将被删除。</p>\n<p>不仅是删除，你还可以确保冲突的更改不会在合并时更改行。例如，以下是一个冲突变化的例子：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-conflicting-change.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/746a354faaf438fa66001862e1956e1b.png\" alt=\"Delete changes in Meld\"></a></p>\n<p>现在，如果你点击任意两个黑色箭头，箭头指向的行将被改变，并且将变得与其他文件的相应行相似。只要你想这样做，这是没问题的。但是，如果你不想要更改任何行呢？相反，目的是将更改的行在相应行的上方或下方插入到其他文件中。</p>\n<p>我想说的是，例如，在上面的截图中，需要在 “test23” 之上或之下添加 “test 2”，而不是将 “test23” 更改为 “test2”。你会很高兴知道在 Meld 中这是可能的。就像你按下 Shift 键删除注释一样，在这种情况下，你必须按下 Ctrl 键。</p>\n<p>你会观察到当前操作将被更改为插入 – 双箭头图标将确认这一点 。</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-ctrl-insert.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d48a91909a13070aadaac9d3377057ba.png\" alt=\"Change actions\"></a></p>\n<p>从箭头的方向看，此操作可帮助用户将当前更改插入到其他文件中的相应更改 (如所选择的)。</p>\n<h3 id=\"toc_3\">3、 自定义文件在 Meld 的编辑器区域中显示的方式</h3>\n<p>有时候，你希望 Meld 的编辑区域中的文字大小变大（为了更好或更舒适的浏览），或者你希望文本行被包含而不是脱离视觉区域（意味着你不要想使用底部的水平滚动条）。</p>\n<p>Meld 在 <em>Editor</em> 选项卡（<em>Edit-&gt;Preferences-&gt;Editor</em>）的 <em>Preferences</em> 菜单中提供了一些显示和字体相关的自定义选项，你可以进行这些调整：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-editor-tab.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/e338b0cbc7bfbabd22b4ee2d44ff46d7.png\" alt=\"Meld preferences\"></a></p>\n<p>在这里你可以看到，默认情况下，Meld 使用系统定义的字体宽度。只需取消选中 <em>Font</em> 类别下的框，你将有大量的字体类型和大小选项可供选择。</p>\n<p>然后在 <em>Display</em> 部分，你将看到我们正在讨论的所有自定义选项：你可以设置 Tab 宽度、告诉工具是否插入空格而不是 tab、启用/禁用文本换行、使Meld显示行号和空白（在某些情况下非常有用）以及使用语法突出显示。</p>\n<h3 id=\"toc_4\">4、 过滤文本</h3>\n<p>有时候，并不是所有的修改都是对你很重要的。例如，在比较两个 C 编程文件时，你可能不希望 Meld 显示注释中的更改，因为你只想专注于与代码相关的更改。因此，在这种情况下，你可以告诉 Meld 过滤（或忽略）与注释相关的更改。</p>\n<p>例如，这里是 Meld 中的一个比较，其中由工具高亮了注释相关更改：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-changes-with-comments.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fb371296bbb42b3f6f915ac9b972510b.png\" alt=\"Filter Text in Meld\"></a></p>\n<p>而在这种情况下，Meld 忽略了相同的变化，仅关注与代码相关的变更：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-changes-without-comments.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/90750b2dd9bb246c780ae1b82fced95e.png\" alt=\"Ignore Changes in Meld\"></a></p>\n<p>很酷，不是吗？那么这是怎么回事？为此，我是在 “<em>Edit-&gt;Preferences-&gt;Text Filters</em>” 标签中启用了 “C comments” 文本过滤器：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-text-filters.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/411274b89687a5a801c83b74a4310ac3.png\" alt=\"C-Comments in Meld\"></a></p>\n<p>如你所见，除了 “C comments” 之外，你还可以过滤掉 C++ 注释、脚本注释、引导或所有的空格等。此外，你还可以为你处理的任何特定情况定义自定义文本过滤器。例如，如果你正在处理日志文件，并且不希望 Meld 高亮显示特定模式开头的行中的更改，则可以为该情况定义自定义文本过滤器。</p>\n<p>但是，请记住，要定义一个新的文本过滤器，你需要了解 Python 语言以及如何使用该语言创建正则表达式。</p>\n<h3 id=\"toc_5\">总结</h3>\n<p>这里讨论的所有四个技巧都不是很难理解和使用（当然，除了你想立即创建自定义文本过滤器），一旦你开始使用它们，你会认为他们是真的有好处。这里的关键是要继续练习，否则你学到的任何技巧不久后都会忘记。</p>\n<p>你还知道或者使用其他任何中级 Meld 的贴士和技巧么？如果有的话，欢迎你在下面的评论中分享。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112348\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112348votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112348\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/6085acc0af4696f5d49164561c6bc4f9b590fc26.jpg"}
{"url_object_id": "fc306e48d67be0a615adc28402f72695", "title": ["颜值即正义，超好用的 Linux 桌面个性化工具推荐"], "create_data": "2017/09/01", "url": "http://blog.jobbole.com/112327/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/editorial-story/blog/1527138\">开源中国编辑部</a>   </div><p>对于系统桌面，有人追求美观，有人追求简洁，有人追求实用，也有人就是喜欢默认的设置效果。接下来，推荐几款适用于 Linux 的开源桌面个性化工具，代码敲累了的时候，换换主题，说不定也能让你更放松。</p>\n<h3><a href=\"https://github.com/horst3180/arc-theme\" target=\"_blank\" rel=\"nofollow\">1、Arc</a></h3>\n<p>一款主打透明元素的扁平化主题，支持基于 GTK 3 和 GTK 2 的桌面环境，如 GNOME、Unity、Budgie、Pantheon、Xfce、MATE 等，内含 3 种不同的风格可供选择。</p>\n<p>Arc</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/e41e73992d65b40d4d856f068e9d8d62.png\" width=\"728\" height=\"155\"></p>\n<p>Arc-Darker</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fbc7c1532ebf62c705c2e98744257133.png\" width=\"728\" height=\"155\"></p>\n<p>Arc-Dark</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/5abc27be17959c64e32449fcaa25b5c6.png\" width=\"728\" height=\"155\"></p>\n<h3><a href=\"http://github.com/anmoljagetia/Flatabulous\" target=\"_blank\" rel=\"nofollow\">2、<strong>Flatabulous</strong></a></h3>\n<p>一款扁平化主题，适用于 Ubuntu 以及其它基于 Gnome 的 Linux 系统。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/6522206a9c1be1c6ef3506fbe28c85cc.png\" width=\"1366\" height=\"768\"></p>\n<h3><a href=\"https://github.com/adapta-project/adapta-gtk-theme\" target=\"_blank\" rel=\"nofollow\">3、Adapta</a></h3>\n<p>一款自适应的 Gtk+ 主题，遵循当前比较流行的 Material Design 设计风格。支持 GNOME、Budgie、Cinnamon、Unity、XFce4、Mate、LXDE 等桌面环境。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/1874fddce2d1634263d80adbfa498f14.png\" width=\"800\" height=\"800\"></p>\n<h3><a href=\"https://github.com/numixproject/numix-gtk-theme\" target=\"_blank\" rel=\"nofollow\">4、Numix</a></h3>\n<p>一款结合了明暗元素的现代化平面主题，支持 Gnome、Unity、XFCE 和 Openbox 。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/9ec4cee40a68985bdd7163f64eefcfe7.png\" width=\"1406\" height=\"1600\"></p>\n<h3><a href=\"https://krourke.org/projects/art/la-capitaine-icon-theme\" target=\"_blank\" rel=\"nofollow\">5、La Capitaine</a></h3>\n<p>这是一个图标主题，目标是适配大部分桌面环境。里面的图标受 macOS 和 Material Design 启发，主要是使用视觉上容易吸引眼球的渐变、阴影和简单的几何形式元素。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/4700d547b2265628ab762d53a2d5a658.png\" width=\"1500\" height=\"2000\"></p>\n<h3><a href=\"https://github.com/PapirusDevelopmentTeam/papirus-icon-theme\" target=\"_blank\" rel=\"nofollow\">6、Papirus</a></h3>\n<p>基于非开源的 <a href=\"https://snwh.org/paper\" target=\"_blank\" rel=\"nofollow\">Paper</a> 主题，并有一些额外的特性（如硬编码托盘支持，kde 颜色方案支持，libreoffice 图标主题，filezilla 主题，smplayer 主题…）以及其它的修改的 SVG 图标主题。有 Papirus 、Papirus Dark、Papirus Light、ePapirus 四种风格可供选择。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/6bd12b2013111e5a71af592a691fba2c.png\" width=\"370\" height=\"364\"></p>\n<h3><a href=\"https://github.com/bil-elmoussaoui/Hardcode-Tray\" target=\"_blank\" rel=\"nofollow\">7、Hardcode Tray</a></h3>\n<p>这是一个托盘脚本，通过在 Linux 中自动探测你的默认主题，正确的图标尺寸，硬编码内嵌图标应用，以及正确的状态图标，来修正硬编码的托盘图标。它还支持上面提到的 Numix 和 Papirus 。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/c5ddb413c4c4f2777d2a8a12475a112a.png\" width=\"727\" height=\"87\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/e1c69452a123294ca53f1fa4f690b46e.png\" width=\"718\" height=\"195\"></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112327\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112327votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112327\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg"}
{"url_object_id": "382269592e7d5f328aeab89feab6e845", "title": ["Linux 系统上的可视化比较与合并工具 Meld"], "create_data": "2017/09/02", "url": "http://blog.jobbole.com/112344/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/dbde9a54537cff686561f4ea367befd3.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 3, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.howtoforge.com/tutorial/beginners-guide-to-visual-merge-tool-meld-on-linux/\">Ansh</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8402-1.html\">Linux中国/GitFuture</a>   </div><p>我们已经<a href=\"https://www.howtoforge.com/tutorial/linux-diff-command-file-comparison/\">讲过</a> Linux 中<a href=\"https://www.howtoforge.com/tutorial/how-to-compare-three-files-in-linux-using-diff3-tool/\">一些</a>基于命令行的比较和合并工具，再来讲解该系统的一些可视化的比较与合并工具也很合理。首要的原因是，不是每个人都习惯使用命令行，而且对于某些人来说，基于命令行的比较工具可能很难学习和理解。</p>\n<p>因此，我们将会推出关于可视化工具 <strong>Meld</strong> 的系列文章。</p>\n<p>在跳到安装和介绍部分前，我需要说明这篇教程里所有的指令和用例是都是可用的，而且它们已经在 Ubuntu 14.04 中测试过了，我们使用的 Meld 版本是 3.14.2。</p>\n<h3 id=\"toc_1\">关于 Meld</h3>\n<p><a href=\"http://meldmerge.org/\">Meld</a> 主要是一个可视化的比较和合并的工具，目标人群是开发者（当然，我们将要讲到的其它部分也会考虑到最终用户）。这个工具同时支持双向和三向的比较，不仅仅是比较文件，还可以比较目录，以及版本控制的项目。</p>\n<p>“Meld 可以帮你回顾代码改动，理解补丁，”其官网如是说。“它甚至可以告知你如果你不进行合并将会发生什么事情。”该工具使用 GPL v2 协议进行授权。</p>\n<h3 id=\"toc_2\">安装 Meld</h3>\n<p>如果你用的是 Ubuntu 或者其它基于 Debian 的 Linux 分支，你可以用以下命令下载安装 Meld：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79a572a9bb005047974\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo apt-get install meld\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79a572a9bb005047974-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79a572a9bb005047974-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79a572a9bb005047974-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">meld</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79a572a9bb005047974-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者你也可以用系统自带的包管理软件下载这个工具。比如在 Ubuntu 上，你可以用 Ubuntu 软件中心（Ubuntu Software Center），或者用 <a href=\"https://www.howtoforge.com/tutorial/ubuntu-16-04-lts-overview/\">Ubuntu 软件</a>，它从 Ubuntu 16.04 版本开始取代了 Ubuntu 软件中心。</p>\n<p>当然，Ubuntu 官方仓库里的 Meld 版本很有可能比较陈旧。因此如果你想要用更新的版本，你可以在<a href=\"https://git.gnome.org/browse/meld/refs/tags\">这里</a>下载软件包。如果你要用这个方法，你要做的就是解压下载好的软件包，然后运行 <code>bin</code> 目录下的 <code>meld</code> 程序。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b79a572a9c6897661775\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n~/Downloads/meld-3.14.2/bin$ ./meld \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b79a572a9c6897661775-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b79a572a9c6897661775-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b79a572a9c6897661775-1\"><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Downloads</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">meld</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3.14.2</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-sy\">$</span> <span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">meld</span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b79a572a9c6897661775-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>以下是 Meld 依赖的软件，仅供参考：</p>\n<ul>\n<li>Python 2.7 (Python 3.3 开发版)</li>\n<li>GTK+ 3.14</li>\n<li>GLib 2.36</li>\n<li>PyGObject 3.14</li>\n<li>GtkSourceView 3.14</li>\n<li>pycairo</li>\n</ul>\n<h3 id=\"toc_3\">使用 Meld</h3>\n<p>装好了软件，就可以看到类似这样的画面：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/dbde9a54537cff686561f4ea367befd3.png\" alt=\"Meld started\"></p>\n<p>有三个选项：比较文件（File comparison），比较目录（Directory comparison）以及版本控制视图（Version control view）。</p>\n<p>点击“比较文件”选项，就可以选择需要比较的文件：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/060bead6118e149e3a57c576d37d1376.png\" alt=\"Meld file comparison\"></p>\n<p>就像上面的截图那样明白，Meld 也可以进行三向比较，但是在这一系列文章的第一部分，我们只会讲更常用的双向比较。</p>\n<p>接着，选择你想要比较的文件，点击“比较”（Compare）按钮。软件会在两边分别打开两个文件，高亮不同的行（以及不同的部分）。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/7eb08063baf7cb031a6a6f4b445926c3.png\" alt=\"Compare files in Meld\"></p>\n<p>两个文件的不同之处在第二行，差别在于 <code>file2</code> 文件的第二行多了一个 <code>3</code>。你看到的黑色箭头是用来进行合并或修改的操作的。该例中，向右的箭头将会把 <code>file2</code> 文件的第二行改成文件 <code>file1</code> 中对应行的内容。左向箭头做的事情相反。</p>\n<p>做完修改后，按下 <code>Ctrl+s</code> 来保存。</p>\n<p>这个简单的例子，让你知道 Meld 的基本用法。让我们看一看稍微复杂一点的比较：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/3a1b7484b6c3766fda278db4b7d7f970.png\" alt=\"Meld advanced file comparison\"></p>\n<p>在讨论这些变化前，这里提一下， Meld 的界面中有几个区域，可以给出文件之间的差异，让概况变得直观。这里特别需要注意窗口的左右两边垂直的栏。比如下面这个截图：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/4ea9541f9c58840d7e096fa4bebd7813.png\" alt=\"Visual Comparison\"></p>\n<p>仔细观察，图中的这个栏包含几个不同颜色的区块。这些区块是用来让你对文件之间的差异有个大概的了解。“每一个着色的区块表示一个部分，这个部分可能是插入、删除、修改或者有差别的，取决于区块所用的颜色。”官方文档是这样说的。</p>\n<p>现在，让我们回到我们之前讨论的例子中。接下来的截图展示了用 Meld 理解文件的改动是很简单的（以及合并这些改动）：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d58833eab9d7ba00aabab813c6e0969b.png\" alt=\"File changes visualized in Meld\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/6f8a5ac900f6e386e0f4982445ee0da8.png\" alt=\"Meld Example 2\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/92013c7ba1d58181b101d6d566b01afb.png\" alt=\"Meld Example 3\"></p>\n<p>接着，我们滑动文件，从一个改动跳到另一个。但是，当要比较的文件很大时，这会耗一点时间，当你想要滑动文件跳到一个改动的位置时，也会变得很困难。如果是这种情况的话，你可以用工具栏的橙色箭头，就在编辑区域的上方：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/98ecd8d98e47b079342b86dd9b0867b3.png\" alt=\"Go to next change in Meld\"></p>\n<p>这些是你使用 Meld 时做的一般性的事情：可以用标准的 <code>Ctrl+f</code> 组合键在编辑区域内进行查找，按 <code>F11</code> 键让软件进入全屏模式，再按 <code>Ctrl+r</code> 来刷新（通常在所有要比较的文件改变的时候使用）。</p>\n<p>以下是 Meld 官方网站宣传的重要特性：</p>\n<ul>\n<li>文件和目录的双向及三向比较</li>\n<li>输入即更新文件的比较</li>\n<li>自动合并模式，按块改动的动作让合并更加简单</li>\n<li>可视化让比较文件更简单</li>\n<li>支持 Git，Bazaar，Mercurial，Subversion 等等</li>\n</ul>\n<p>注意还不仅仅只有以上所列的。网站上有个专门的<a href=\"http://meldmerge.org/features.html\">特性页面</a>，里面提到了 Meld 提供的所有特性。这个页面列出的所有特性分为几个部分，以该软件是用来做文件比较、目录比较、版本控制还是处于合并模式下为基础进行划分。</p>\n<p>和其它软件相似，有些事情 Meld 做不到。官方网站上列出了其中的一部分：“当 Meld 展示文件之间的差异时，它同时显示两个文件，看起来就像在普通的文本编辑器中。它不会添加额外的行，让左右两边文件的特殊改动处于同样的行数。没有做这个事情的选项。”</p>\n<h3 id=\"toc_4\">总结</h3>\n<p>我们刚刚了解到的不过是皮毛，因为 Meld 还能做很多事情。考虑到这是教程系列的第一部分，这也挺不错的。这仅仅是让你了解 Meld 的作用，你可以配置它，忽略一些特定类型的改动，让它移动，复制或者删除文件之间的个别差异，也可以从命令行启动它。在即将推出的系列教程中，我们将会讲述所有这些重要功能。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112344\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112344votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112344\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/fe1d173df391bea51437d0e7fa21c5de4375111c.jpg"}
{"url_object_id": "39e9518a9d5fa1c6e5ff1afda070376e", "title": ["如何向 6 岁的孩子解释何为编程"], "create_data": "2017/09/07", "url": "http://blog.jobbole.com/112375/", "front_image_url": ["http://wx3.sinaimg.cn/mw690/6941baebly1fjb5w7x6khj208406imx4.jpg"], "praise_nums": "5", "comment_nums": 0, "fav_nums": 2, "tags": "趣文小说,儿童,编程,趣文", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译，<a href=\"http://www.jobbole.com/members/young605867996\">Lada</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://dev.to/tkaczanowski/explaining-programming-to-6-years-old-kids\">Tomek Kaczanowski</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>任务：<strong>向一组六岁的孩子解释你的工作（我自己的女儿也在其中）。</strong></p>\n<p>难度等级：高。</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fjb5w7x6khj208406imx4.jpg\"></p>\n<p>关于这个任务/主题，之前网上已有许多人分享了他们对这种“讲座”的想法，你可以在 Stack Overflow 上找到一些非常有趣的例子（例如<a href=\"http://stackoverflow.com/questions/2455786/career-day-in-kindergarten-how-to-demonstrate-programming-in-20-minutes\">这里</a>）。其中许多人的想法是关于<strong>计算机是多么愚蠢</strong>，因为要取得成功，你需要非常准确地告诉它做事的方法和规律。我保证这样很有趣，但我也很怀疑，过后孩子们能对编程有什么了解。</p>\n<p>一个成功的演讲在我心里应该是这样的：</p>\n<ul>\n<li><strong>让他们通过提问和画画来持续参与其中。</strong>我在谈话期间画下的原画（白板纸）相当大。顺便一提，画画是一个能让年轻观众参与进来的好方法（他们玩得很开心，嘲笑代表程序员的稻草人，或者指出<span id=\"0KSFindDIV\" class=\"KSFIND_CLASS\">粉红猪小妹</span>（Peppa Pig）长得不是这样的等等）。我没有原始图纸（忘了拍照），但我又画了一次，让你看到这个想法。</li>\n<li><strong>所有演讲的内容要基于他们已知的事物</strong>（比如：YouTube、笔记本、平板、DVD）。现在每个孩子都在 YouTube 上观看卡通片，在平板上玩游戏，看到爸妈在笔记本上工作。他们也知道电影是保存在 CD/DVD 上的，以及（在涉及游戏和电影时）智能手机和平板非常相似。</li>\n</ul>\n<p>我从一个最基本的问题开始，“<strong>谁知道程序员是做什么的？</strong>”我知道他们昨天讨论过这个问题，所以对他们提出的一些想法，我并不感到惊讶。我给了他们我自己的定义：“程序员是编写计算机程序的人，他们掌握和计算机交流的语言，而且对计算机懂得很多。“</p>\n<p>然后我画了一个工作中的程序员。</p>\n<p><img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fjb5w8duw2j20dw089glp.jpg\"></p>\n<p>下一步是讨论<strong>计算机</strong>。所有的孩子都开始谈论他们父母的笔记本（他们反复提到同样的东西，这样真的很可爱）。讨论了一段时间后，我打断他们并指出，<strong>在不同地方还有很多计算机</strong>，比如智能手机或手表，还包括汽车和电梯。我把上面提到的每一项都画了出来，并用几个字简单地概述每一种情况下计算机的用途。我还问他们他们如何看待天气预报的工作（这时一个聪明的孩子回答：“卫星知道第二天的天气”），并告诉他们计算机得出的预测，基于上千的测量设备给出的测量结果。</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fjb5w8s86gj20dw0dfaag.jpg\"></p>\n<p>为了转到下一个话题<strong>计算机程序</strong>，我提到计算机之所以能做很多事，要归功于指导它们做这些事情的程序。</p>\n<p>话题随之转向 YouTube，我知道他们很了解它，我从他们熟悉的 UI 开始。</p>\n<p>我问他们 YouTube 上有多少部电影。有些人比较困惑，而有些人高喊“数百万”或“无限”。我问所有的电影是否都可以放在一张光盘上。然后我画出许多光盘，问他们“在给 YouTube 下达观看 《粉红猪小妹》某一集的指令后，你了解它是如何找到那个正确的光盘吗？”他们以沉默回应，所以我画了一个数据库，并快速描述了它的作用。</p>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fjb5w97wn4j20dw0ftmxv.jpg\"></p>\n<p>我想让他们知道，他们所看到的只是冰山一角，<strong>而程序员们还有很多要做的</strong>。我解释了我们必须如何处理以下各种事情：</p>\n<ul>\n<li>保护电影免受坏人的篡改（“如果有人改变了数据库会发生什么事情，你会看到一些足球比赛，而不是<span id=\"2KSFindDIV\" class=\"KSFIND_CLASS\">粉红猪小妹</span>。”，底下的孩子一片死寂 😁 ）</li>\n<li>制作备份（“一个光盘破裂了怎么办？那你永远不会在<span id=\"3KSFindDIV\" class=\"KSFIND_CLASS_SELECT\">粉红猪小妹</span>中，看到猪爸爸设法挂画这一情节了。“，底下又是一片死寂 😁 ）</li>\n<li>使得 YouTube 可以在不同的设备上运行（智能手机、平板、笔记本）</li>\n<li>展示广告</li>\n<li>计算观看每一部电影的人数</li>\n<li>显示相似电影的缩略图，等等</li>\n</ul>\n<p>这是一个提醒他们<strong>编程是团队合作</strong>的好时机。这些项目很大，需要不同领域的知识，所以很多人都参与了创作。在这一点上，我更新了第一张图，添加了另一个程序员，让他们俩坐得很近。</p>\n<p>下一个主题是<strong>计算机的工作原理</strong>，当然我一笔带过，没有详细展开。我是这样告诉他们的：</p>\n<ul>\n<li>鼠标和键盘是供人们发送命令给计算机的</li>\n<li>计算机屏幕是供计算机响应（命令）的</li>\n<li>每台计算机里都有一个处理器（你可以把它当成计算机的大脑）</li>\n<li>还有一些磁盘允许计算机存储信息</li>\n</ul>\n<p><img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fjb5wac6g5j20dw0db74q.jpg\"></p>\n<p>我把注意力集中在处理器上，告诉他们计算机使用<strong>一种只包含 0 和 1 的有趣语言</strong>。当我假装只用 A 和 B 开头的词说话时，我们获得了一点乐趣。然后我解释程序员之所以使用编程语言，是为了更容易与处理器沟通对话。</p>\n<p>然后我使用了一些最简单的<strong>编程语言进行示例</strong>（使用一些伪代码）。我本想再给他们看一些东西，但我觉得他们正在失去注意力，所以我甚至没有提出 for 循环。</p>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fjb5wap1zoj20dw06haa5.jpg\"></p>\n<p>为了完成我的演讲，我再次画出了我们所谈论过的符号。我一个一个地画出来，问他们“这是什么？”、“你还记得什么？”这样的问题。整个过程都非常棒。</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fjb5wb29ncj205k0hcmx8.jpg\"></p>\n<p>额外的说明、注意事项、提示及技巧：</p>\n<ul>\n<li>这比我想象的要<strong>有趣</strong>得多！我认真地对待这件事，进行了很好的准备，结果也得到了回报。孩子们很感兴趣，我想他们可能会记得一些事情。</li>\n<li><strong>画画</strong>是正确的方式。它能抓住他们的注意力。通过指着某一幅画，能让我提醒他们几分钟前我们就此讨论过的事情。</li>\n<li>要做好<strong>一遍遍重复</strong>的准备。当我问他们知道的语言时，一个孩子举起手说：“我知道一点英语”，然后他的同伴也一样，这一个，那一个，然后组里剩下的人一个接一个（或几个同时）举手，但几乎所有人说的都是英语。当你谈到他们喜欢的主题，比如卡通片时，场面会变得更加混乱。</li>\n<li>不管你做什么，有些孩子会变得<strong>无聊</strong>，因为他们的注意力周期实在太短了。</li>\n<li>注意<strong>书写。</strong>举个例子，当你写 1 时，他们会抗议这看起来像 7。</li>\n<li>在这次演讲中，我明白了<strong>纠正他们是毫无意义的</strong>。例如，我认为在他们眼中， YouTube 会将卡通片保存在 DVD 上，当你要求某个卡通片时，计算机会选择正确的光盘并播放。我个人觉得这种想法很好，我想让他们理解的是概念（搜索是怎样的，数据库做什么的），而不是技术细节，这才是我认为正确的方法。</li>\n<li>演讲花了大约 25 分钟，感觉没必要更长了。</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112375\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112375votetotal\">5</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112375\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            我见青山多妩媚，料青山见我应如是        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 36</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/baced409c07eeea2ff08af3899c6a96f6a93a6a5.jpg"}
